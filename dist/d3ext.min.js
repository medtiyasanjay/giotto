!function(a){var b;b="object"==typeof module&&module.exports?module.exports:window,"function"==typeof define&&define.amd?define(["d3"],function(){return a(d3,b)}):"object"==typeof module&&module.exports&&a(d3,b)}(function(a){"use strict";function b(){}var c={version:"0.1.0"};a.ext=c;var d=/xyz/.test(function(){})?/\b_super\b/:/.*/,e=function(a,b,c,e){return"function"==typeof c&&"function"==typeof e[b]&&d.test(c)?a.new_attr(b,function(){var a=this._super;this._super=e[b];var d=c.apply(this,arguments);return this._super=a,d}):a.new_attr(b,c)},f=c.Type=function(a){return a.new_class=function(a,b){var c=this,d=a===c,f=d?a:a.prototype;a.initialising=!0;var g=new a;delete a.initialising;for(var h in b)"Metaclass"!==h&&(g[h]=e.call(a,c,h,b[h],f));if(d){for(h in f)void 0===g[h]&&(g[h]=f[h]);return g}var i=function(){!this.constructor.initialising&&this.init&&this.init.apply(this,arguments)};return i.prototype=g,i.prototype.constructor=i,i.extend=a.extend,i},a.new_attr=function(a,b){return b},a.extend=function(b){return a.new_class(this,b)},a}(function(){}),g=c.Class=function(a){return a.__class__=f,a.extend=function(a){var b=a.Metaclass||this.__class__,c=b.new_class(this,a);return c.__class__=b,c},a}(function(){}),h=c.extend=function(){var a=arguments.length,b=arguments[0];if(!b||2>a)return b;for(var c,d=0;++d<a;)if(c=arguments[d],Object(c)===c)for(var e in c)c.hasOwnProperty(e)&&(b[e]=c[e]);return b},i=function(a){function c(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function d(a){var d=window.console||{},e=d[a]||d.log||b,f=!1;try{f=!!e.apply}catch(g){}return f?function(){var a=[];return forEach(arguments,function(b){a.push(c(b))}),e.apply(d,a)}:function(a,b){e(a,null===b?"":b)}}return{log:d("log"),info:d("info"),warn:d("warn"),error:d("error"),debug:function(){var b=d("debug");return function(){a&&b.apply(self,arguments)}}()}},j=c.Viz=g.extend({init:function(b,c){c=h({},this.defaults,c),b=a.select(b),this.element=b,this.attrs=c,this.$service=$service,this.log=i(c.debug),this.elwidth=null,this.elheight=null,this.d3=null;var d=b.parent();if(c.width?c.width=+c.width:(c.width=b.width(),c.width?this.elwidth=b:(c.width=d.width(),c.width?this.elwidth=d:c.width=400)),c.height?c.height.indexOf("%")===c.height.length-1&&(c.height_percentage=.01*parseFloat(c.height),c.height=c.height_percentage*c.width):(c.height=b.height(),c.height?this.elheight=b:(c.height=d.height(),c.height?this.elheight=d:c.height=400)),c.resize){var e=this;$(window).resize(function(){e.resize()})}},resize:function(a){var b,c;a?(b=a[0],c=a[1]):(b=this.elwidth?this.elwidth.width():this.attrs.width,c=this.attrs.height_percentage?b*this.attrs.height_percentage:this.elheight?this.elheight.height():this.attrs.height),(this.attrs.width!==b||this.attrs.height!==c)&&(this.attrs.width=b,this.attrs.height=c,this.build())},svg:function(){return this.element.empty(),this.d3.select(this.element[0]).append("svg").attr("width",this.attrs.width).attr("height",this.attrs.height)},size:function(){return[this.attrs.width,this.attrs.height]},sy:function(){var a=this.size();return a[1]/a[0]},build:function(a){if(a&&(this.attrs=h(this.attrs,a)),this.d3)this.d3build();else{var b=this;require(["d3"],function(a){b.d3=a,b.d3build()})}},d3build:function(){},loadData:function(){var a=this,b=this.attrs.src;return b&&this.d3?this.d3.json(b,function(b,c){b||a.setData(c)}):void 0},setData:function(a,b){this.attrs.processData&&(a=this.attrs.processData(a)),this.attrs.data=a,b&&b()}});return c.isviz=function(a){return a!==j&&a.prototype&&a.prototype instanceof j},c.C3=j.extend({d3build:function(){var a=this,b=this.attrs;if(!this.c3)return require(["c3"],function(b){a.c3=b,a.d3build()});if(!b.data)return this.loadData(function(){a.d3build()});{var c=h({bindto:this.element[0]},this.attrs.data);this.c3.generate(c)}}}),c.Force=j.extend({d3build:function(){function b(a){var b=a.radius+16,c=a.x-b,d=a.x+b,e=a.y-b,f=a.y+b;return function(b,g,h,i,j){if(b.point&&b.point!==a){var k=a.x-b.point.x,l=a.y-b.point.y,m=Math.sqrt(k*k+l*l),n=a.radius+b.point.radius;n>m&&(m=(m-n)/m*.5,a.x-=k*=m,a.y-=l*=m,b.point.x+=k,b.point.y+=l)}return g>d||c>i||h>f||e>j}}var c=(this.d3,this.svg()),d=this.attrs,e=d.nodes||100,f=d.minRadius||4,g=d.maxRadius||16,h=d.gravity||.05,i=d.charge||-2e3,j=g>f?g-f:0,k=a.range(e).map(function(){return{radius:Math.random()*j+f}}),l=a.scale.category10(),m=a.layout.force().gravity(h).charge(function(a,b){return b?0:i}).nodes(k).size(this.size()),n=k[0];n.radius=0,n.fixed=!0,m.start(),c.selectAll("circle").data(k.slice(1)).enter().append("svg:circle").attr("r",function(a){return a.radius-2}).style("fill",function(a,b){return l(b%3)}),m.on("tick",function(){for(var d=a.geom.quadtree(k),e=0,f=k.length;++e<f;)d.visit(b(k[e]));c.selectAll("circle").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}),c.on("mousemove",function(){var b=a.mouse(this);n.px=b[0],n.py=b[1],m.resume()}).on("touchmove",function(){var b=a.touches(this);n.px=b[0],n.py=b[1],m.resume()})}}),c.Leaflet=j.extend({defaults:{center:[41.898582,12.476801],zoom:4,maxZoom:18},d3build:function(){var a=this.attrs,b=this.element[0];require("leaflet",function(){this.map=new L.Map(b,{center:a.center,zoom:a.zoom}),a.buildMap&&a.buildMap.call(this)})},addLayer:function(a,b){this.map&&L.tileLayer(a,b).addTo(this.map)}}),c.SunBurst=j.extend({defaults:{labels:!0,padding:10,transition:750,scale:"sqrt"},d3build:function(){function a(a){return"log"===j.scale?h.scale.log().range([1,a]):"linear"===j.scale?h.scale.linear().range([0,a]):h.scale.sqrt().range([0,a])}function b(a){w!==a.depth&&(g&&g.transition().attr("opacity",0),w=a.depth,y.transition().duration(m).attrTween("d",e(a)).each("end",function(b){g&&b.depth>=w&&b.x>=a.x&&b.x<a.x+a.dx&&d(h.select(this.parentNode).select("text").transition().duration(m).attr("opacity",1))}))}function c(a){return u(a.x+a.dx/2)}function d(a){return a.attr("x",function(a){return a.depth===w?0:c(a)>Math.PI?-v(a.y):v(a.y)}).attr("dx",function(a){return a.depth===w?0:c(a)>Math.PI?-6:6}).attr("dy",function(a){return a.depth===w?a.depth?40:0:".35em"}).attr("transform",function(a){var b=0;return a.depth!==w&&(b=c(a),b>Math.PI&&(b-=Math.PI),b-=Math.PI/2),"rotate("+b/Math.PI*180+")"}).attr("text-anchor",function(a){return a.depth===w?"middle":c(a)>Math.PI?"end":"start"}).style("font-size",function(a){return a.depth===w?"120%":"100%"})}function e(a){var b=h.interpolate(u.domain(),[a.x,a.x+a.dx]),c=h.interpolate(v.domain(),[a.y,1]),d=h.interpolate(v.range(),[a.y?20:0,p]);return function(a,e){return e?function(){return x(a)}:function(e){return u.domain(b(e)),v.domain(c(e)).range(d(e)),x(a)}}}var f=this;if(!this.attrs.data)return this.loadData(function(){f.d3build()});var g,h=this.d3,i=this.size(),j=this.attrs,k=j.data,l=+j.padding,m=+j.transition,n=i[0]/2,o=i[1]/2,p=Math.min(n,o)-l,q=h.layout.partition().value(function(a){return a.size}).sort(function(a){return void 0===a.order?a.size:a.order}),r=this.svg().append("g").attr("transform","translate("+n+","+o+")"),s=r.selectAll("g").data(q.nodes(k)).enter().append("g").attr("class","sunburst"),t=h.scale.category20c(),u=h.scale.linear().range([0,2*Math.PI]),v=a(p),w=0,x=h.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,u(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,u(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,v(a.y))}).outerRadius(function(a){return Math.max(0,v(a.y+a.dy))}),y=s.append("path").attr("d",x).style("fill",function(a){return t((a.children?a:a.parent).name)}).on("click",b);this.attrs.labels&&(g=d(s.append("text").text(function(a){return void 0!==j.addorder&&void 0!==a.order?a.order+" - "+a.name:a.name})))}}),a});