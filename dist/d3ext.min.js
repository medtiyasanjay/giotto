!function(){"use strict";var a={version:"0.1.0"},b=/xyz/.test(function(){})?/\b_super\b/:/.*/,c=function(a,c,d,e){return"function"==typeof d&&"function"==typeof e[c]&&b.test(d)?a.new_attr(c,function(){var a=this._super;this._super=e[c];var b=d.apply(this,arguments);return this._super=a,b}):a.new_attr(c,d)},d=a.Type=function(a){return a.new_class=function(a,b){var d=this,e=a===d,f=e?a:a.prototype;a.initialising=!0;var g=new a;delete a.initialising;for(var h in b)"Metaclass"!==h&&(g[h]=c.call(a,d,h,b[h],f));if(e){for(h in f)void 0===g[h]&&(g[h]=f[h]);return g}var i=function(){!this.constructor.initialising&&this.init&&this.init.apply(this,arguments)};return i.prototype=g,i.prototype.constructor=i,i.extend=a.extend,i},a.new_attr=function(a,b){return b},a.extend=function(b){return a.new_class(this,b)},a}(function(){}),e=a.Class=function(a){return a.__class__=d,a.extend=function(a){var b=a.Metaclass||this.__class__,c=b.new_class(this,a);return c.__class__=b,c},a}(function(){}),f=a.Viz=e.extend({init:function(a,b,c){a=$(a),this.element=a,this.attrs=b||(b={}),this.$lux=c,this.elwidth=null,this.elheight=null,this.d3=null;var d=this.element.parent();if(b.width?b.width=+b.width:(b.width=a.width(),b.width?this.elwidth=a:(b.width=d.width(),b.width?this.elwidth=d:b.width=400)),b.height?b.height.indexOf("%")===b.height.length-1&&(b.height_percentage=.01*parseFloat(b.height),b.height=b.height_percentage*b.width):(b.height=a.height(),b.height?this.elheight=a:(b.height=d.height(),b.height?this.elheight=d:b.height=400)),b.resize){var e=this;$(window).resize(function(){e.resize()})}this.build()},resize:function(a){var b,c;a?(b=a[0],c=a[1]):(b=this.elwidth?this.elwidth.width():this.attrs.width,c=this.attrs.height_percentage?b*this.attrs.height_percentage:this.elheight?this.elheight.height():this.attrs.height),(this.attrs.width!==b||this.attrs.height!==c)&&(this.attrs.width=b,this.attrs.height=c,this.build())},svg:function(){return this.element.empty(),this.d3.select(this.element[0]).append("svg").attr("width",this.attrs.width).attr("height",this.attrs.height)},size:function(){return[this.attrs.width,this.attrs.height]},sy:function(){var a=this.size();return a[1]/a[0]},build:function(a){if(a&&(this.attrs=$.extend(this.attrs,a)),this.d3)this.d3build();else{var b=this;require(["d3"],function(a){b.d3=a,b.d3build()})}},d3build:function(){},loadData:function(a){var b=this,c=this.attrs.src;return c&&this.d3?this.d3.json(c,function(c,d){c||(b.attrs.data=d||{},a())}):void 0}});a.vizDirectiveFactory=function(a){return[function(){return{restrict:"AE",link:function(b,c,d){new a(c,d)}}}]},a.SunBurst=f.extend({d3build:function(){function a(a){q.transition().duration(750).attrTween("d",b(a))}function b(a){var b=d.interpolate(n.domain(),[a.x,a.x+a.dx]),c=d.interpolate(o.domain(),[a.y,1]),e=d.interpolate(o.range(),[a.y?20:0,j]);return function(a,d){return d?function(){return p(a)}:function(d){return n.domain(b(d)),o.domain(c(d)).range(e(d)),p(a)}}}var c=this;if(!this.attrs.data)return this.loadData(function(){c.d3build()});var d=this.d3,e=this.size(),f=this.attrs.data,g=this.attrs.padding?+this.attrs.padding:10,h=e[0]/2,i=e[1]/2,j=Math.min(h,i)-g,k=this.svg().append("g").attr("class","sunburst").attr("transform","translate("+h+","+i+")"),l=d.scale.category20c(),m=d.layout.partition().value(function(a){return a.size}),n=d.scale.linear().range([0,2*Math.PI]),o=d.scale.sqrt().range([0,j]),p=d.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,n(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,n(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,o(a.y))}).outerRadius(function(a){return Math.max(0,o(a.y+a.dy))}),q=k.selectAll("path").data(m.nodes(f)).enter().append("path").attr("d",p).style("fill",function(a){return l((a.children?a:a.parent).name)}).on("click",a)}}),"function"==typeof define&&define.amd?define(a):"object"==typeof module&&module.exports?module.exports=a:window.d3ext=a}();