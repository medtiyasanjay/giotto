!function(a){var b;b="object"==typeof module&&module.exports?module.exports:window,"function"==typeof define&&define.amd?define(["d3"],function(){return a(d3,b)}):"object"==typeof module&&module.exports&&a(d3,b)}(function(a){"use strict";function b(){}function c(a){return e(a,"width")}function d(a){return e(a,"height")}function e(a,b){for(var c,d=a.node();d&&"BODY"!==d.tagName&&!(c=d.getBoundingClientRect()[b]);)d=d.parentNode;return c}function f(){function a(){b.forEach(function(a){a()})}var b=[];return a.add=function(a){b.push(a)},a}var g={version:"0.1.0"};a.ext=g;var h=/xyz/.test(function(){})?/\b_super\b/:/.*/,i=function(a,b,c,d){return"function"==typeof c&&"function"==typeof d[b]&&h.test(c)?a.new_attr(b,function(){var a=this._super;this._super=d[b];var e=c.apply(this,arguments);return this._super=a,e}):a.new_attr(b,c)},j=g.Type=function(a){return a.new_class=function(a,b){var c=this,d=a===c,e=d?a:a.prototype;a.initialising=!0;var f=new a;delete a.initialising;for(var g in b)"Metaclass"!==g&&(f[g]=i.call(a,c,g,b[g],e));if(d){for(g in e)void 0===f[g]&&(f[g]=e[g]);return f}var h=function(){!this.constructor.initialising&&this.init&&this.init.apply(this,arguments)};return h.prototype=f,h.prototype.constructor=h,h.extend=a.extend,h},a.new_attr=function(a,b){return b},a.extend=function(b){return a.new_class(this,b)},a}(function(){}),k=g.Class=function(a){return a.__class__=j,a.extend=function(a){var b=a.Metaclass||this.__class__,c=b.new_class(this,a);return c.__class__=b,c},a}(function(){}),l=g.extend=function(){var a=arguments.length,b=arguments[0];if(!b||2>a)return b;for(var c,d=0;++d<a;)if(c=arguments[d],Object(c)===c)for(var e in c)c.hasOwnProperty(e)&&(b[e]=c[e]);return b},m=function(a){function c(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function d(a){var d=window.console||{},e=d[a]||d.log||b,f=!1;try{f=!!e.apply}catch(g){}return f?function(){for(var a=[],b=0;b<arguments.length;++b)a.push(c(arguments[b]));return e.apply(d,a)}:function(a,b){e(a,null===b?"":b)}}return{log:d("log"),info:d("info"),warn:d("warn"),error:d("error"),debug:function(){var b=d("debug");return function(){a&&b.apply(self,arguments)}}()}};g.VizDefaults={resize:!1,resizeDelay:200,onInit:null,events:["build","change"]};var n=g.Viz=k.extend({init:function(b,e){if(e||Object(b)!==b||(e=b,b=null),b||(b=document.createElement("div")),e=l({},g.VizDefaults,this.defaults,e),b=a.select(b),this.element=b,this.attrs=e,this.log=m(e.debug),this.elwidth=null,this.elheight=null,this.dispatch=a.dispatch.apply(a,e.events),e.width||(e.width=c(b),e.width?this.elwidth=!0:e.width=400),e.height?"string"==typeof e.height&&e.height.indexOf("%")===e.height.length-1&&(e.height_percentage=.01*parseFloat(e.height),e.height=e.height_percentage*e.width):(e.height=d(b),e.height?this.elheight=!0:e.height=400),e.resize){var h=this;null===window.onresize&&(window.onresize=f()),window.onresize.add&&window.onresize.add(function(){h._resize()})}e.onInit&&e.onInit.call(this)},_resize:function(){var a,b=this.elwidth?c(this.element):this.attrs.width;if(a=this.attrs.height_percentage?b*this.attrs.height_percentage:this.elheight?d(this.element):this.attrs.height,(this.attrs.width!==b||this.attrs.height!==a)&&(this.attrs.width=b,this.attrs.height=a,!this._resizing))if(this.attrs.resizeDelay){var e=this;this._resizing=!0,setTimeout(function(){e.log.info("Resizing visualization"),e.resize(),e._resizing=!1},this.attrs.resizeDelay)}else this.resize()},resize:function(a){a&&(this.attrs.width=a[0],this.attrs.height=a[1]),this.build()},svg:function(){return this.element.html(""),this.element.append("svg").attr("width",this.attrs.width).attr("height",this.attrs.height)},size:function(){return[this.attrs.width,this.attrs.height]},sy:function(){var a=this.size();return a[1]/a[0]},build:function(a){a&&(this.attrs=l(this.attrs,a)),this.d3build(),this.dispatch.build&&this.dispatch.build(this)},d3build:function(){},loadData:function(b){var c=this,d=this.attrs.src;return d?a.json(d,function(a,d){a||c.setData(d,b)}):void 0},setData:function(a,b){this.attrs.processData&&(a=this.attrs.processData(a)),Object(a)===a&&a.data?this.attrs=l(this.attrs,a):this.attrs.data=a,b&&b()},on:function(a,b){return this.dispatch.on(a,b),this}});return g.isviz=function(a){return a!==n&&a.prototype&&a.prototype instanceof n},g.C3=n.extend({c3opts:["data","axis","grid","region","legend","tooltip","subchart","zoom","point","line","bar","pie","donut"],init:function(a,b){b||Object(a)!==a||(b=a,a=null),b&&(b.resize=!1),this._super(a,b)},d3build:function(){var a=this,b=this.attrs;if(!this.c3)return require(["c3"],function(b){a.c3=b,a.d3build()});if(!b.data)return this.loadData(function(){a.d3build()});var c={bindto:this.element.node(),size:{width:this.elwidth?null:b.width,height:this.elheight?null:b.height}};a.c3opts.forEach(function(a){b[a]&&(c[a]=b[a])});this.c3.generate(c)}}),g.Force=n.extend({d3build:function(){function b(a){var b=a.radius+16,c=a.x-b,d=a.x+b,e=a.y-b,f=a.y+b;return function(b,g,h,i,j){if(b.point&&b.point!==a){var k=a.x-b.point.x,l=a.y-b.point.y,m=Math.sqrt(k*k+l*l),n=a.radius+b.point.radius;n>m&&(m=(m-n)/m*.5,a.x-=k*=m,a.y-=l*=m,b.point.x+=k,b.point.y+=l)}return g>d||c>i||h>f||e>j}}var c=(this.d3,this.svg()),d=this.attrs,e=d.nodes||100,f=d.minRadius||4,g=d.maxRadius||16,h=d.gravity||.05,i=d.charge||-2e3,j=g>f?g-f:0,k=a.range(e).map(function(){return{radius:Math.random()*j+f}}),l=a.scale.category10(),m=a.layout.force().gravity(h).charge(function(a,b){return b?0:i}).nodes(k).size(this.size()),n=k[0];n.radius=0,n.fixed=!0,m.start(),c.selectAll("circle").data(k.slice(1)).enter().append("svg:circle").attr("r",function(a){return a.radius-2}).style("fill",function(a,b){return l(b%3)}),m.on("tick",function(){for(var d=a.geom.quadtree(k),e=0,f=k.length;++e<f;)d.visit(b(k[e]));c.selectAll("circle").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}),c.on("mousemove",function(){var b=a.mouse(this);n.px=b[0],n.py=b[1],m.resume()}).on("touchmove",function(){var b=a.touches(this);n.px=b[0],n.py=b[1],m.resume()})}}),g.Leaflet=n.extend({defaults:{center:[41.898582,12.476801],zoom:4,maxZoom:18},d3build:function(){var a=this.attrs,b=this.element[0];require("leaflet",function(){this.map=new L.Map(b,{center:a.center,zoom:a.zoom}),a.buildMap&&a.buildMap.call(this)})},addLayer:function(a,b){this.map&&L.tileLayer(a,b).addTo(this.map)}}),g.SunBurst=n.extend({defaults:{labels:!0,padding:10,transition:750,scale:"sqrt"},d3build:function(){function b(b){return"log"===m.scale?a.scale.log().range([1,b]):"linear"===m.scale?a.scale.linear().range([0,b]):a.scale.sqrt().range([0,b])}function c(b){function c(a){return a.x>=b.x&&a.x<b.x+b.dx}z!==b.depth&&(j&&j.transition().attr("opacity",0),z=b.depth,B.transition().duration(p).attrTween("d",f(b)).each("end",function(a){a.depth===z&&c(a)&&(g.current=a,g.dispatch.change&&g.dispatch.change(g))}),j&&(k=[],i.transition().duration(p).attrTween("d",f(b)).each("end",function(b){b.depth>=z&&c(b)&&e(a.select(this.parentNode).select("text").transition().duration(p).attr("opacity",1))})))}function d(a){function b(a){var b=c-a;b>=0&&e>b?(c+=e,d=!0):0>b&&b>-e&&(c-=e-b,d=!0)}for(var c=x(a.x+a.dx/2),d=!0,e=Math.PI/40;d;)d=!1,k.forEach(b);return k.push(c),c}function e(a){var b;return a.attr("x",function(a){return a.depth===z?0:(b=d(a),this.__data__.angle=b,b>Math.PI?-y(a.y):y(a.y))}).attr("dx",function(a){return a.depth===z?0:a.angle>Math.PI?-6:6}).attr("dy",function(a){return a.depth===z?a.depth?40:0:".35em"}).attr("transform",function(a){return b=0,a.depth>z&&(b=a.angle,b>Math.PI&&(b-=Math.PI),b-=Math.PI/2),"rotate("+b/Math.PI*180+")"}).attr("text-anchor",function(a){return b=a.angle,a.depth===z?"middle":b&&b>Math.PI?"end":"start"}).style("font-size",function(a){var b=a.depth-z;return b?b>0?Math.max(120-20*b,40)+"%":void 0:"120%"})}function f(b){var c=a.interpolate(x.domain(),[b.x,b.x+b.dx]),d=a.interpolate(y.domain(),[b.y,1]),e=a.interpolate(y.range(),[b.y?20:0,s]);return function(a,b){return b?function(){return A(a)}:function(b){return x.domain(c(b)),y.domain(d(b)).range(e(b)),A(a)}}}var g=this;if(!this.attrs.data)return this.loadData(function(){g.d3build()});var h,i,j,k,l=this.size(),m=this.attrs,n=m.data,o=+m.padding,p=+m.transition,q=l[0]/2,r=l[1]/2,s=Math.min(q,r)-o,t=a.layout.partition().value(function(a){return a.size}).sort(function(a){return void 0===a.order?a.size:a.order}),u=this.svg().append("g").attr("transform","translate("+q+","+r+")"),v=u.append("g").attr("class","sunburst"),w=a.scale.category20c(),x=a.scale.linear().range([0,2*Math.PI]),y=b(s),z=0,A=a.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,x(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,x(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,y(a.y))}).outerRadius(function(a){return Math.max(0,y(a.y+a.dy))}),B=v.selectAll("path").data(t.nodes(n)).enter().append("path").attr("d",A).style("fill",function(a){return w((a.children?a:a.parent).name)});if(this.attrs.labels){var C=B.data();k=[],h=u.append("g").attr("class","text").selectAll("g").data(C).enter().append("g"),i=h.append("path").attr("d",A).attr("opacity",0).on("click",c),j=h.append("text").text(function(a){return void 0!==m.addorder&&void 0!==a.order?a.order+" - "+a.name:a.name}),e(j)}}}),a});