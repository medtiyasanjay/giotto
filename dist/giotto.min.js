!function(a){var b;b="object"==typeof module&&module.exports?module.exports:window,"function"==typeof define&&define.amd?define(["d3"],function(){return a(d3,b)}):"object"==typeof module&&module.exports&&a(d3,b)}(function(a,b){"use strict";function c(){}function d(a){return h(a,"width")}function e(a){return h(a,"height")}function f(a){return i(a,"width")}function g(a){return i(a,"height")}function h(a,b){for(var c,d=a.node();d&&"BODY"!==d.tagName&&!(c=d.getBoundingClientRect()[b]);)d=d.parentNode;return c}function i(b,c){for(var d,e=b.node();e&&"BODY"!==e.tagName;){if(d=e.getBoundingClientRect()[c])return a.select(e);e=e.parentNode}}function j(b,c){p.paper[c.type](b,c);var d=b.innerWidth(),e=b.innerHeight();return b.xAxis().orient(c.xaxis.position).scale().range([0,d]),b.yaxis(2).yAxis().orient(c.yaxis2.position).scale().range([e,0]),b.yaxis(1).yAxis().orient(c.yaxis.position).scale().range([e,0]),a.rebind(b,c.event,"on")}function l(b,c){var h,i;c?(h=c.width,i=c.height,c=w(c,function(a,b){return void 0!==p.defaults.paper[b]?a:void 0})):c={};var j=t({},p.defaults.paper,c);return h||(h=d(b),h?j.elwidth=f(b):h=p.constants.WIDTH),i?"string"==typeof i&&i.indexOf("%")===i.length-1&&(j.height_percentage=.01*parseFloat(i),i=a.round(j.height_percentage*h)):(i=e(b),i?j.elheight=g(b):i=p.constants.HEIGHT),j.size=[h,i],j.event=a.dispatch("refresh"),j}function m(a,b,c){a.attr("transform",function(a){var d=b(a);return"translate("+(isFinite(d)?d:c(a))+",0)"})}function n(a,b,c){a.attr("transform",function(a){var d=b(a);return"translate(0,"+(isFinite(d)?d:c(a))+")"})}var o={version:"0.1.0",d3:a,math:{}},p=o;a.giotto=o,a.canvas={},p.require=function(a,c){return b.rcfg&&b.rcfg.min&&(a=b.rcfg.min(a)),require(a,c),p},p.angular={module:function(a,b,c){return b=b||"giotto",c=c||[],a.module(b,c).directive("jstats",function(){return{link:function(b,c,d){var e=d.mode?+d.mode:1;require(rcfg.min(["stats"]),function(){var d=new Stats;d.setMode(e),b.stats=d,c.append(a.element(d.domElement))})}}})},directive:function(a,b,c,d,e){d=d||"giotto",e=e?e.slice():[];var f=d.toLowerCase()+b.substring(0,1).toUpperCase()+b.substring(1);e.push(function(){return{restrict:"AE",link:function(a,b,d){var e=b.data(f);if(!e){var g=v(d);g.scope=a,e=c(b[0],g),b.data(f,e),a.$emit("giotto-viz",e),e.start()}}}}),a.module(d).directive(f,e)},addAll:function(a,b,c,d){p.angular.module(a,b,c),a.forEach(p.viz,function(c,e){p.angular.directive(a,e,c,b,d)})}};var q=function(a){function b(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function d(a){var d=window.console||{},e=d[a]||d.log||c,f=!1;try{f=!!e.apply}catch(g){}return f?function(){for(var a=[],c=0;c<arguments.length;++c)a.push(b(arguments[c]));return e.apply(d,a)}:function(a,b){e(a,null===b?"":b)}}return{log:d("log"),info:d("info"),warn:d("warn"),error:d("error"),debug:function(){var b=d("debug");return function(){a&&b.apply(self,arguments)}}()}};p.log=q(b.debug),p.xyfunction=function(a,b){var c=[];return z(a)&&a.forEach(function(a){c.push([a,b(a)])}),c};{var r=Object.prototype.toString,s=p._={},t=p.extend=function(){var a=arguments.length,b=arguments[0];if(!b||2>a)return b;for(var c,d=0;++d<a;)if(c=arguments[d],Object(c)===c)for(var e in c)c.hasOwnProperty(e)&&(b[e]=c[e]);return b},u=s.copyMissing=function(a,b){if(a&&b)for(var c in a)a.hasOwnProperty(c)&&void 0===b[c]&&(b[c]=a[c]);return b},v=function(a){if(a&&"string"==typeof a.options){for(var c=b,d=a.options.split("."),e=0;e<d.length&&(c=c[d[e]],c);++e);"function"==typeof c&&(c=c(p,a)),a=t(a,c)}return a},w=(s.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},s.pick=function(a,b){var c,d={};for(var e in a)a.hasOwnProperty(e)&&(c=b(a[e],e),void 0!==c&&(d[e]=c));return d}),x=s.isObject=function(a){return"[object Object]"===r.call(a)},y=(s.isString=function(a){return"[object String]"===r.call(a)},s.isFunction=function(a){return"[object Function]"===r.call(a)}),z=s.isArray=function(a){return"[object Array]"===r.call(a)},A=s.encodeObject=function(a,b){var c;if("multipart/form-data"===b){var d=new FormData;for(c in a)a.hasOwnProperty(c)&&d.append(c,a[c]);return d}if("application/json"===b)return JSON.stringify(a);var e=[];for(c in a)a.hasOwnProperty(c)&&e.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return e.join("&")},B=s.getObject=function(a){if(s.isString(a)){var c=a.split(".");a=b;for(var d=0;d<c.length&&(a=a[c[d]],a);++d);}return a};s.loadCss=function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet"),b.setAttribute("type","text/css"),b.setAttribute("href",a),document.getElementsByTagName("head")[0].appendChild(b)}}p.defaults={},p.defaults.axis={color:"#000",tickSize:.05,minTickSize:null},p.defaults.paper={type:"svg",resizeDelay:200,resize:!0,margin:{top:20,right:20,bottom:20,left:20},xaxis:t({position:"bottom"},p.defaults.axis),yaxis:t({position:"left"},p.defaults.axis),yaxis2:t({position:"right"},p.defaults.axis),colors:a.scale.category10().range(),lines:{interpolate:"basis",width:2},nodes:{symbol:"circle"},font:{size:11,weight:"bold",lineHeight:13,style:"italic",family:"sans-serif",variant:"small-caps"}},p.defaults.viz=t({onInit:null,events:["build","change","start","tick","end"]}),p.constants={DEFAULT_VIZ_GROUP:"default_viz_group",WIDTH:400,HEIGHT:300,leaflet:"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"},p.paper=function(b,c){var f={},g=0;return x(b)&&(c=b,b=null),b||(b=document.createElement("div")),b=a.select(b),c=l(b,c),f.destroy=function(){return b.selectAll("*").remove(),f},f.type=function(){return c.type},f.size=function(){return[c.size[0],c.size[1]]},f.width=function(){return c.size[0]},f.height=function(){return c.size[1]},f.innerWidth=function(){return c.size[0]-c.margin.left-c.margin.right},f.innerHeight=function(){return c.size[1]-c.margin.top-c.margin.bottom},f.aspectRatio=function(){return f.innerHeight()/f.innerWidth()},f.element=function(){return b},f.yaxis=function(a){return arguments.length?((1===a||2===a)&&(c.yaxisNumber=a),f):c.yaxisNumber},f.xAxis=function(a){return arguments.length?(c.xAxis=a,f):c.xAxis},f.yAxis=function(a){return arguments.length?(c.yAxis[c.yaxisNumber-1]=a,f):c.yAxis[c.yaxisNumber-1]},f.xGrid=function(){return c.xGrid},f.yGrid=function(){return c.yGrid},f.scale=function(a){var b=c.xAxis.scale();return b(a)-b(0)},f.scalex=function(a){return c.xAxis.scale()(a)},f.scaley=function(a){return f.yAxis().scale()(a)},f.resize=function(a){c._resizing=!0,a||(a=f.boundingBox()),(c.size[0]!==a[0]||c.size[1]!==a[1])&&(p.log.info("Resizing paper"),c.size=a,f.refresh()),c._resizing=!1},f.boundingBox=function(){var b,f=c.elwidth?d(c.elwidth):c.size[0];return b=c.height_percentage?a.round(f*c.height_percentage,0):c.elheight?e(c.elheight):c.size[1],[f,b]},f.xyData=function(a){if(a){a.data||(a={data:a});var b=a.data,c=1/0,d=1/0,e=-1/0,f=-1/0,g=function(a){return c=c>a?a:c,e=a>e?a:e,a},h=function(a){return d=d>a?a:d,f=a>f?a:f,a};if(z(b[0])&&2===b[0].length){var i=[];b.forEach(function(a){i.push({x:g(a[0]),y:h(a[1])})}),b=i}else b.forEach(function(a){a.x=g(a.x),a.y=h(a.y)});return a.data=b,a.xrange=[c,e],a.yrange=[d,f],a}},f.pickColor=function(){var a=c.colors[g++];return g===c.colors.length&&(g=0),a},c.resize&&a.select(window).on("resize",function(){c._resizing||(c.resizeDelay?(c._resizing=!0,a.timer(function(){return f.resize(),!0},c.resizeDelay)):f.resize())}),j(f,c)},p.paper.addType=function(a,b){var c=[];p.paper[a]=function(a,d){b(a,d);for(var e=0;e<c.length;++e)c[e](a,d);return a},p.paper[a].plugin=function(a,b,d){p.defaults.paper[a]=b,c.push(d)}},p.paper.addType("svg",function(b,c){function d(a,b){b.font;return a.attr("stroke",b.color),e(a,b.font)}function e(a,b){var d=c.font;return b||(b={}),a.style({"font-size":b.size||d.size,"font-weight":b.weight||d.weight,"font-style":b.style||d.style,"font-family":b.family||d.family,"font-variant":b.variant||d.variant})}var f=b.element().append("svg").attr("class","giotto").attr("width",c.size[0]).attr("height",c.size[1]).attr("viewBox","0 0 "+c.size[0]+" "+c.size[1]),g=f;c.xAxis=a.svg.axis(),c.yAxis=[a.svg.axis(),a.svg.axis()],b.refresh=function(){return f.attr("width",c.size[0]).attr("height",c.size[1]),c.event.refresh({type:"refresh",size:c.size.slice(0)}),b},b.clear=function(){return g=f,f.selectAll("*").remove(),b},b.current=function(){return g},b.root=function(){return g=f,b},b.parent=function(){var c=g.node();return c!==f.node()&&(g=a.select(c.parentNode)),b},b.group=function(){return g=g.append("g").attr("transform","translate("+c.margin.left+","+c.margin.top+")")},b.circle=function(a,c,d){return a=b.scalex(a),c=b.scaley(c),d=b.scale(d),g.append("circle").attr("cx",a).attr("cy",c).attr("r",d)},b.rect=function(a,c,d,e,f){var h=b.scalex(a),i=b.scaley(c);d=b.scalex(a+d)-h,e=b.scalex(c+e)-i;var j=g.append("rect").attr("x",h).attr("y",i).attr("width",d).attr("height",e);if(f){{var k=b.scalex(f)-b.scalex(0);b.scaley(f)-b.scaley(0)}j.attr("rx",k).attr("ry",rt)}return j},b.path=function(d,e){e||(e={}),u(c.lines,e);var f=e.area?a.svg.area():a.svg.line(),h=b.scalex,i=b.scaley,j=e.color||b.pickColor();return f.interpolate(e.interpolate).x(function(a){return h(a.x)}).y(function(a){return i(a.y)}),g.append("path").attr("class",e.area?"area":"line").attr("stroke",j).attr("stroke-width",e.width).datum(d).attr("d",f)},b.drawXaxis=function(){var a=c.xaxis,b="top"===a.position?c.margin.top:c.size[1]-c.margin.bottom;return d(f.append("g").attr("class","axis x-axis").attr("transform","translate("+c.margin.left+","+b+")").call(c.xAxis),a)},b.drawYaxis=function(){var a=b.yaxis(),e=1===a?c.yaxis:c.yaxis2,g="left"===e.position?c.margin.left:c.size[0]-c.margin.right,h=b.yAxis();return d(f.append("g").attr("class","axis y-axis-"+a).attr("transform","translate("+g+","+c.margin.top+")").call(h),e)},b.encode=function(){return btoa(unescape(encodeURIComponent(f.attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML)))},b.downloadSVG=function(c){var d="data:image/svg+xml;charset=utf-8;base64,"+b.encode();a.select(c.target).attr("href",d)},b.downloadPNG=function(c){function d(b,c){if(c&&200===c.status){var d=JSON.parse(c.responseText);a.xhr(d.url).post(A({input:"upload",file:i},"multipart/form-data"),function(a,b){b&&200===b.status&&(d=JSON.parse(b.responseText),e(d))})}}function e(b){a.xhr(b.url,function(a,c){c&&200===c.status&&(b=JSON.parse(c.responseText),"finished"===b.step?g(b.output):"error"===b.step?f(b):e(b))})}function f(){}function g(b){a.select(c.target).attr("href",b.url+"?inline")}if(p.cloudConvertApiKey){var h={apikey:p.cloudConvertApiKey,inputformat:"svg",outputformat:"png"},i=new Blob(["base64,",b.encode()],{type:"image/svg+xml;charset=utf-8"});a.xhr("https://api.cloudconvert.org/process?"+A(h)).header("content-type","multipart/form-data").post(d)}}});var C=0;p.viz={},p.createviz=function(b,c,d){var e=[],f=function(b,c){x(b)&&(c=b,b=null),c=t({},f.defaults,c);var g,h={},i=++C,j=a.dispatch.apply(a,c.events),k=0,l=!1;c.event=j,h.uid=function(){return i},h.vizType=function(){return f},h.vizName=function(){return f.vizName()},h.paper=function(a){return(a||void 0===g)&&(g&&g.destroy(),g=p.paper(b,c),g.on("refresh",function(){h.refresh()})),g},h.element=function(){return h.paper().element()},h.alpha=function(b){return arguments.length?(b=+b,k?k=b>0?b:0:b>0&&(j.start({type:"start",alpha:k=b}),a.timer(h.tick)),h):k},h.resume=function(){return h.alpha(.1)},h.stop=function(){return h.alpha(0)},h.tick=function(){return(k*=.99)<.005?(j.end({type:"end",alpha:k=0}),!0):void j.tick({type:"tick",alpha:k})},h.start=function(){return h.resume()},h.refresh=function(){return g&&"canvas"===g.type()&&this.start(),h},h.loadData=function(b){return c.src&&!l?(l=!0,p.log.info("Giotto loading data from "+c.src),a.json(c.src,function(a,c){l=!1,a||h.setData(c,b)})):void 0},h.setData=function(a,b){c.processData&&(a=c.processData(a)),Object(a)===a&&a.data?t(c,a):c.data=a,b&&b()},h.options=function(){return c},h.xyfunction=p.xyfunction,a.rebind(h,j,"on"),d&&d(h,c);for(var m=0;m<e.length;++m)e[m](h,c);if(c.onInit){var n=B(c.onInit);y(n)?n(h):p.log.error("Could not locate onInit function "+c.onInit)}return h};return p.viz[b]=f,f.defaults=t({},p.defaults.viz,p.defaults.paper,c),f.vizName=function(){return b},f.plugin=function(a){e.push(a)},f},a.canvas.axis=function(){function b(b){b.each(function(){var b,k=a.select(this),l=this.__chart__||d,o=this.__chart__=d.copy(),p=null===j?o.ticks?o.ticks.apply(o,i):o.domain():j,q=null===c?o.tickFormat?o.tickFormat.apply(o,i):d3_identity:c,r=k.selectAll(".tick").data(p,o),s=r.enter().insert("g",".domain").attr("class","tick").style("opacity",ε),t=a.transition(r.exit()).style("opacity",ε).remove(),u=a.transition(r.order()).style("opacity",1),v=Math.max(f,0)+h,w=d3_scaleRange(o),x=k.selectAll(".domain").data([0]),y=(x.enter().append("path").attr("class","domain"),a.transition(x));s.append("line"),s.append("text");var z,A,B,C,D=s.select("line"),E=u.select("line"),F=r.select("text").text(q),G=s.select("text"),H=u.select("text"),I="top"===e||"left"===e?-1:1;if("bottom"===e||"top"===e?(b=m,z="x",B="y",A="x2",C="y2",F.attr("dy",0>I?"0em":".71em").style("text-anchor","middle"),y.attr("d","M"+w[0]+","+I*g+"V0H"+w[1]+"V"+I*g)):(b=n,z="y",B="x",A="y2",C="x2",F.attr("dy",".32em").style("text-anchor",0>I?"end":"start"),y.attr("d","M"+I*g+","+w[0]+"H0V"+w[1]+"H"+I*g)),D.attr(C,I*f),G.attr(B,I*v),E.attr(A,0).attr(C,I*f),H.attr(z,0).attr(B,I*v),o.rangeBand){var J=o,K=J.rangeBand()/2;l=o=function(a){return J(a)+K}}else l.rangeBand?l=o:t.call(b,o,l);s.call(b,l,o),u.call(b,o,o)})}var c,d=a.scale.linear(),e=D,f=6,g=6,h=3,i=[10],j=null;return b.scale=function(a){return arguments.length?(d=a,b):d},b.orient=function(a){return arguments.length?(e=a in E?a+"":D,b):e},b.ticks=function(){return arguments.length?(i=arguments,b):i},b.tickValues=function(a){return arguments.length?(j=a,b):j},b.tickFormat=function(a){return arguments.length?(c=a,b):c},b.tickSize=function(a){var c=arguments.length;return c?(f=+a,g=+arguments[c-1],b):f},b.innerTickSize=function(a){return arguments.length?(f=+a,b):f},b.outerTickSize=function(a){return arguments.length?(g=+a,b):g},b.tickPadding=function(a){return arguments.length?(h=+a,b):h},b.tickSubdivide=function(){return arguments.length&&b},b};var D="bottom",E={top:1,right:1,bottom:1,left:1};p.paper.addType("canvas",function(b,c){var d,e,f;c.xAxis=a.canvas.axis(),c.yAxis=[a.canvas.axis(),a.canvas.axis()],b.refresh=function(){return b.destroy(),d=b.element().append("canvas").attr("width",c.size[0]).attr("height",c.size[1]),e=d.node().getContext("2d"),f=e,c.event.refresh({type:"refresh",size:c.size.slice(0)}),b},b.refresh(),b.current=function(){return f},b.clear=function(){return f=e,f.clearRect(0,0,c.size[0],c.size[1]),b}}),p.createviz("chart",{margin:{top:30,right:30,bottom:30,left:30},serie:{lines:{show:!0},points:{show:!1},bars:{show:!1}}},function(a,b){function c(a,b){return a?void 0===a.show?void 0===b?!0:b:a.show:!1}function d(a,b){return a=void 0===a||null===a?b:a}function e(a,b){return a?b?(f.group(),p.log.info("Add new serie to chart"),u(g.serie,a),a.lines.show&&(a.lines=f.path(a.data,a.lines)),a.points.show&&(a.points=f.nodes(a.data,a.points)),a.bars.show&&(a.bars=f.bars(a.data,a.bars)),f.parent(),void 0):(z(a)&&(a={data:a}),f.xyData(a)):void 0}var f=a.paper(),g=a.vizType().defaults;a.addSeries=function(c){var g=[1/0,-1/0],h=[1/0,-1/0],i=[];return c.forEach(function(b){y(b)&&(b=b(a)),b=e(b),b&&(i.push(b),g[0]=Math.min(g[0],b.xrange[0]),g[1]=Math.max(g[1],b.xrange[1]),h[0]=Math.min(h[0],b.yrange[0]),h[1]=Math.max(h[1],b.yrange[1]))}),f.xAxis().scale().domain([d(b.xaxis.min,g[0]),d(b.xaxis.min,g[1])]),f.yAxis().scale().domain([d(b.yaxis.min,h[0]),d(b.yaxis.min,h[1])]),i.forEach(function(a){e(a,!0)}),a},a.draw=function(){var d=b.data;return!d&&b.src?a.loadData(a.draw):(p._.isFunction(d)&&(d=d(a)),a.addSeries(d),c(b.xaxis)&&f.drawXaxis(),c(b.yaxis)&&f.drawYaxis(),void(c(b.yaxis2,!1)&&f.drawYaxis()))},a.on("tick.main",function(){a.stop(),a.draw()})}),p.createviz("force",{nodes:0,minRadius:.02,maxRadius:.08,theta:.8,friction:.9},function(b,c){function d(a){var b=a.radius+.05,c=a.x-b,d=a.x+b,e=a.y-b,f=a.y+b;return function(b,g,h,i,j){if(b.point&&b.point!==a){var k=a.x-b.point.x,l=a.y-b.point.y,m=Math.sqrt(k*k+l*l),n=a.radius+b.point.radius;n>m&&(m=(m-n)/m*.5,a.x-=k*=m,a.y-=l*=m,b.point.x+=k,b.point.y+=l)}return g>d||c>i||h>f||e>j}}function e(a){return a.weight=0,isNaN(a.x)&&(a.x=Math.random()),isNaN(a.y)&&(a.y=Math.random()),isNaN(a.px)&&(a.px=a.x),isNaN(a.py)&&(a.py=a.y),a}var f,g,h,i,j,k=[];b.nodes=function(a){if(!arguments.length)return k;for(f=null,k=a,i=0;i<k.length;++i)e(k[i]).index=i;return b},b.addNode=function(a){a.index=k.length,k.push(e(a))},b.theta=function(a){return arguments.length?(c.theta=a,b):+c.theta},b.friction=function(a){return arguments.length?(c.friction=a,b):+c.friction},b.quadtree=function(){return h||(h=a.geom.quadtree(k)),h},b.randomNode=function(){var a=+c.minRadius,b=+c.maxRadius,d=b>a?b-a:0;return{radius:Math.random()*d+a}},b.drawCircles=function(c){c||(c=a.scale.category10());var d=b.paper(),e=c.range().length;if("svg"===d.type()){var f=d.clear().current();return f.selectAll("circle").data(k).enter().append("svg:circle").attr("r",function(a){var b=d.scale(a.radius);return b>2?b-2:0}).attr("cx",function(a){return d.scalex(a.x)}).attr("cy",function(a){return d.scaley(a.y)}).style("fill",function(a,b){return c(b%e)})}},b.on("tick.main",function(){for(h=null,b.quadtree(),g=b.friction(),i=-1;++i<k.length;)j=k[i],j.fixed?(j.x=j.px,j.y=j.py):(j.x-=(j.px-(j.px=j.x))*g,j.y-=(j.py-(j.py=j.y))*g),h.visit(d(k[i]))}),+c.nodes&&b.nodes(a.range(+c.nodes).map(function(){return b.randomNode()}))}),p.viz.force.plugin(function(a,b){function c(){var c=b.linkDistance,h=b.linkStrength,i=a.nodes();if(d=[],e=[],n.length){for(f=0;f<n.length;++f)g=n[f],"number"==typeof g.source&&(g.source=i[g.source]),"number"==typeof g.target&&(g.target=i[g.target]),++g.source.weight,++g.target.weight;if("function"==typeof c)for(f=0;f<n.length;++f)d[f]=+c.call(a,n[f],f);else for(f=0;f<n.length;++f)d[f]=c;if("function"==typeof h)for(f=0;f<n.length;++f)e[f]=+h.call(a,n[f],f);else for(f=0;f<n.length;++f)e[f]=h}}var d,e,f,g,h,i,j,l,m,n=[];p._.copyMissing({linkStrength:1,linkDistance:20},b),a.linkStrength=function(c){return arguments.length?(b.linkStrength="function"==typeof c?c:+c,a):b.linkStrength},a.linkDistance=function(c){return arguments.length?(b.linkDistance="function"==typeof c?c:+c,a):b.linkDistance},a.on("tick.links",function(){for(d||c(),f=0;f<n.length;++f)g=n[f],h=g.source,i=g.target,j=i.x-h.x,l=i.y-h.y,m=j*j+l*l,m&&(m=b.alpha*e[f]*((m=Math.sqrt(m))-d[f])/m,j*=m,l*=m,i.x-=j*(k=h.weight/(i.weight+h.weight)),i.y-=l*k,h.x+=j*(k=1-k),h.y+=l*k)})}),p.viz.force.plugin(function(a,b){var c,d,e,f;void 0===b.gravity&&(b.gravity=.05),a.gravity=function(c){return arguments.length?(b.gravity=c,a):+b.gravity},a.on("tick.gravity",function(){if(d=a.alpha()*b.gravity,f=a.nodes(),d)for(c=0;c<f.length;++c)e=f[c],e.fixed||(e.x+=(.5-e.x)*d,e.y+=(.5-e.y)*d)})}),p.viz.force.plugin(function(a,b){function c(){if(a.chargeDistance(b.chargeDistance),g=a.charge(),h=a.nodes(),f=[],"function"==typeof g)for(j=0;j<h.length;++j)f[j]=+g.call(a,h[j],j);else for(j=0;j<h.length;++j)f[j]=g}function d(b){var c=a.theta(),d=c*c;return function(a,c,e,f){if(a.point!==b){var g=a.cx-b.x,h=a.cy-b.y,i=f-c,j=g*g+h*h;if(j>i*i/d)return m>j&&(k=a.charge/j,b.px-=g*k,b.py-=h*k),!0;a.point&&j&&m>j&&(k=a.pointCharge/j,b.px-=g*k,b.py-=h*k)}return!a.charge}}function e(a,b,c){var d=0,f=0;if(a.charge=0,!a.leaf)for(var g,h=a.nodes,i=h.length,j=-1;++j<i;)g=h[j],g&&(e(g,b,c),a.charge+=g.charge,d+=g.charge*g.cx,f+=g.charge*g.cy);if(a.point){a.leaf||(a.point.x+=Math.random()-.5,a.point.y+=Math.random()-.5);var k=b*c[a.point.index];a.charge+=a.pointCharge=k,d+=k*a.point.x,f+=k*a.point.y}a.cx=d/a.charge,a.cy=f/a.charge}var f,g,h,i,j,k,l,m;p._.copyMissing({charge:-30,chargeDistance:1/0},b),a.charge=function(c){return arguments.length?(b.charge=c,a):"function"==typeof b.charge?b.charge:+b.charge},a.chargeDistance=function(c){return arguments.length?(b.chargeDistance2=+c,m=c*c,a):+b.chargeDistance},a.on("tick.charge",function(){if(h=a.nodes(),g=a.charge(),g&&h.length)for(f||c(),e(i=a.quadtree(),a.alpha(),f),j=-1;++j<h.length;)(l=h[j]).fixed||i.visit(d(l))})}),p.createviz("map",{tile:null,center:[41.898582,12.476801],zoom:4,maxZoom:18,zoomControl:!0,wheelZoom:!0},function(a,b){a.start=function(){},a.innerMap=function(){},a.addLayer=function(){},b.tile&&p.viz.map.tileProviders[b.tile](a,b)}).tileProviders={},p.viz.map.tileProviders.leaflet=function(b,c){function d(a,b){var c=e.latLngToLayerPoint(new L.LatLng(b,a));this.stream.point(c.x,c.y)}var e,f=[];b.start=function(){"undefined"==typeof L?(p._.loadCss(p.constants.leaflet),p.require(["leaflet"],function(){b.start()})):(e=new L.map(b.element().node(),{center:c.center,zoom:c.zoom}),c.zoomControl?c.wheelZoom||e.scrollWheelZoom.disable():(e.dragging.disable(),e.touchZoom.disable(),e.doubleClickZoom.disable(),e.scrollWheelZoom.disable(),e.tap&&e.tap.disable()),e.on("viewreset",function(){for(var a=0;a<f.length;++a)f[a]()}),b.resume())},b.innerMap=function(){return e},b.addLayer=function(a,b){e&&L.tileLayer(a,b).addTo(e)},b.addOverlay=function(b,c){var g=a.geo.transform({point:d}),h=a.geo.path().projection(g),i=e?a.select(e.getPanes().overlayPane).append("svg"):null,j=i?i.append("g").attr("class","leaflet-zoom-hide"):null,k=function(){var a=h.bounds(b),d=a[0],e=a[1];i.attr("width",e[0]-d[0]).attr("height",e[1]-d[1]).style("left",d[0]+"px").style("top",d[1]+"px"),j.attr("transform","translate("+-d[0]+","+-d[1]+")"),c&&c(h)};return f.push(k),{element:j,collection:b,path:h,draw:k}}},p.createviz("sunBurst",{labels:!0,addorder:!1,padding:10,transition:750,scale:"sqrt",initNode:null},function(b,c){function d(){var a=u.size(),b=Math.min(a[0],a[1]);return 400>b?Math.round(100-.15*(500-b)):100}function e(c){function d(a){return a.x>=c.x&&a.x<c.x+c.dx}if(c!==l){q&&q.transition().attr("opacity",0);var e=k(c);return s=c.depth,t.transition().duration(x).attrTween("d",e).each("end",function(a){c===a&&(b.current=a,b.fire("change"))}),q&&(r=[],p.transition().duration(x).attrTween("d",e).each("end",function(b){b.depth>=s&&d(b)&&j(a.select(this.parentNode).select("text").transition().duration(x).attr("opacity",1))})),!0}}function f(){var d=u.clear().size(),e=d[0]/2,f=d[1]/2,i=a.layout.partition().value(function(a){return a.size}).sort(function(a){return void 0===a.order?a.size:a.order}),k=u.group().attr("transform","translate("+e+","+f+")"),v=k.append("g").attr("class","sunburst");n=Math.min(e,f)-c.padding,m=g(n),s=0,l=c.data;m(0),m(n);if(t=v.selectAll("path").data(i.nodes(l)).enter().append("path").attr("d",z).style("fill",function(a){return w((a.children?a:a.parent).name)}),c.labels){var x=t.data();r=[],o=k.append("g").attr("class","text").selectAll("g").data(x).enter().append("g"),p=o.append("path").attr("d",z).attr("opacity",0).on("click",h),q=o.append("text").text(function(a){return void 0!==c.addorder&&void 0!==a.order?a.order+" - "+a.name:a.name}),j(q)}b.select(c.initNode)||c.event.change({type:"change",viz:b})}function g(b){return"linear"===c.scale?a.scale.linear().range([0,b]):a.scale.sqrt().range([0,b])}function h(d){function e(a){return a.x>=d.x&&a.x<d.x+d.dx}s!==d.depth&&(q&&q.transition().attr("opacity",0),s=d.depth,t.transition().duration(x).attrTween("d",k(d)).each("end",function(a){a.depth===s&&e(a)&&(b.current=a,c.event.change({type:"change",viz:b}))}),q&&(r=[],p.transition().duration(x).attrTween("d",k(d)).each("end",function(b){b.depth>=s&&e(b)&&j(a.select(this.parentNode).select("text").transition().duration(x).attr("opacity",1))})))}function i(a){function b(a){var b=c-a;b>=0&&e>b?(c+=e,d=!0):0>b&&b>-e&&(c-=e-b,d=!0)}for(var c=y(a.x+a.dx/2),d=!0,e=Math.PI/40;d;)d=!1,r.forEach(b);return r.push(c),c}function j(a){var b;return a.attr("x",function(a){return a.depth===s?0:(b=i(a),this.__data__.angle=b,b>Math.PI?-m(a.y):m(a.y))}).attr("dx",function(a){return a.depth===s?0:a.angle>Math.PI?-6:6}).attr("dy",function(a){return a.depth===s?a.depth?40:0:".35em"}).attr("transform",function(a){return b=0,a.depth>s&&(b=a.angle,b>Math.PI&&(b-=Math.PI),b-=Math.PI/2),"rotate("+b/Math.PI*180+")"}).attr("text-anchor",function(a){return b=a.angle,a.depth===s?"middle":b&&b>Math.PI?"end":"start"}).style("font-size",function(a){var b=a.depth-s,c=v;return b?b>0&&(c=Math.max(1.2*c-20*b,30)):c*=1.2,Math.round(c)+"%"})}function k(b){var c=a.interpolate(y.domain(),[b.x,b.x+b.dx]),d=a.interpolate(m.domain(),[b.y,1]),e=a.interpolate(m.range(),[b.y?20:0,n]);return function(a,b){return b?function(){return z(a)}:function(b){return y.domain(c(b)),m.domain(d(b)).range(e(b)),z(a)}}}var l,m,n,o,p,q,r,s,t,u=b.paper(),v=d(),w=a.scale.category20c(),x=+c.transition,y=a.scale.linear().range([0,2*Math.PI]),z=a.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,y(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,y(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,m(a.y))}).outerRadius(function(a){return Math.max(0,m(a.y+a.dy))});b.on("tick.main",function(){return c.data?(f(),void b.alpha(0)):b.loadData()}),b.select=function(a){if(l){var b=c.data;if(a&&a.length)for(var d=0;d<a.length;++d){var f=a[d];if(!b.children)break;for(var g=0;g<=b.children.length;++g)if(b.children[g]&&b.children[g].name===f){b=b.children[g];break}}return e(b)}},b.scale=function(a){return arguments.length?(c.scale!==a&&(c.scale=a,b.resume()),b):c.scale}}),p.createviz("trianglify",{bleed:150,fillOpacity:1,strokeOpacity:1,noiseIntensity:0,gradient:null,cellsize:0,cellpadding:0,x_gradient:null,y_gradient:null},function(a,b){function c(){var c=+b.cellsize,d=(+b.cellpadding,+b.fillOpacity),f=+b.strokeOpacity,g=+b.noiseIntensity,h=a.gradient(b.gradient),i=a.gradient(b.x_gradient)||h,j=a.gradient(b.y_gradient)||h,k=a.paper().destroy(),l=k.element(),m=a.paper().size();e||(e=new Trianglify),e.options.fillOpacity=Math.min(1,Math.max(d,0)),e.options.strokeOpacity=Math.min(1,Math.max(f,0)),e.options.noiseIntensity=Math.min(1,Math.max(g,0)),i&&(e.options.x_gradient=i),j&&(e.options.y_gradient=j),c>0&&(e.options.cellsize=c,e.options.bleed=+attrs.bleed);var n=e.generate(m[0],m[1]),o=l.select(".trianglify-background");if(!o.node()){for(var p=l.node(),q=document.createElement("div"),r=p.childNodes;r.length;)q.appendChild(r[0]);q.className="trianglify-background",p.appendChild(q),o=l.select(".trianglify-background")}o.style("min-height","100%").style("background-image",n.dataUrl)}var d,e;a.gradient=function(a){if(a&&"string"==typeof a){var b=a.split("-");if(2===b.length){var c=Trianglify.colorbrewer[b[0]],d=+b[1];if(c)return c[d]}}},a.on("tick.main",function(){if(void 0===a.Trianglify&&"undefined"==typeof Trianglify){if(!d)return d=!0,p.require(["trianglify"],function(b){d=!1,a.Trianglify=b||null})}else void 0===a.Trianglify&&(a.Trianglify=Trianglify),c(),a.stop()})}),p.paper.svg.plugin("grid",{color:"#333",opacity:.3},function(b,c){function d(){f||(c.grid=t({},c.grid,p.defaults.paper.grid),void 0===c.xaxis.grid&&(c.xaxis.grid=!0),void 0===c.yaxis.grid&&(c.yaxis.grid=!0),f=a.svg.axis(),g=a.svg.axis())}function e(a,d,e,f){var g=b.root().current(),h=g.select("."+e+"-grid");f?(a.scale(d.scale()).ticks(d.ticks()).tickFormat(""),h.node()||(h=b.group().attr("class","grid "+e+"-grid").attr("stroke",c.grid.color).attr("stroke-opacity",c.grid.opacity)),"x"===e?a.tickSize(b.innerHeight(),0,0):a.tickSize(-b.innerWidth(),0,0).orient("left"),h.call(a)):h.remove()}var f,g;b.showGrid=function(){return d(),e(f,b.xAxis(),"x",c.xaxis.grid),e(g,b.yAxis(),"y",c.yaxis.grid),b},b.hideGrid=function(){return f&&(e(f,b.xAxis(),"x"),e(g,b.yAxis(),"y")),b},b.xGrid=function(){return d(),f},b.yGrid=function(){return d(),g}}),p.viz.chart.plugin(function(a,b){b.grid=t({show:!1},b.grid),a.showGrid=function(b){return a.paper().showGrid(b),a},a.hideGrid=function(){return a.paper().hideGrid(),a},a.on("tick.grid",function(){b.grid.show?a.showGrid():a.hideGrid()})}),p.paper.svg.plugin("zoom",{x:!0,y:!0,extent:[1,10]},function(b,c){function d(){b.drawXaxis(),b.drawYaxis()}var e;b.zoom=function(f){f&&t(c.zoom,f),e||(e=a.behavior.zoom()),c.zoom.x&&e.x(b.xAxis().scale()),c.zoom.y&&e.y(b.yAxis().scale()),e.scaleExtend(c.zoom.extent).on("zoom",d)}});var F=52,G=2<<51,H=21201,I=["d       s       a       m_i","2       1       0       1","3       2       1       1 3","4       3       1       1 3 1","5       3       2       1 1 1","6       4       1       1 1 3 3","7       4       4       1 3 5 13","8       5       2       1 1 5 5 17","9       5       4       1 1 5 5 5","10      5       7       1 1 7 11 1"];return p.math.sobol=function(a){if(1>a||a>H)throw new Error("Out of range dimension");var b,c,d={},e=0,f=[],g=[],h=[];d.next=function(){var b=[];if(0===e)return e++,h.slice();for(var d=1,i=e-1;1==(1&i);)i>>=1,d++;for(c=0;a>c;c++)g[c]^=f[c][d],b[c]=g[c]/G;return e++,b},d.dimension=function(){return a},d.count=function(){return e};var i=[];for(c=0;F>=c;c++)i.push(0);for(c=0;a>c;c++)f[c]=i.slice(),g[c]=0,h[c]=0;if(a>I.length)throw new Error("Out of range dimension");for(b=I,c=1;F>=c;c++)f[0][c]=1<<F-c;for(var j=1;a>j;j++){var k=b[j].split(/\s+/),l=+k[1],m=+k[2],n=[0];for(c=0;l>c;c++)n.push(+k[3+c]);for(c=1;l>=c;c++)f[j][c]=n[c]<<F-c;for(c=l+1;F>=c;c++){f[j][c]=f[j][c-l]^f[j][c-l]>>l;for(var o=1;l-1>=o;o++)f[j][c]^=(m>>l-1-o&1)*f[j][c-o]}}return d},a});