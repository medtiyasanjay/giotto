!function(a){var b;b="object"==typeof module&&module.exports?module.exports:window,"function"==typeof define&&define.amd?define(["d3"],function(){return a(d3,b)}):"object"==typeof module&&module.exports&&a(d3,b)}(function(a,b){"use strict";function c(a){return a}function d(){return 0}function e(a){return"function"==typeof a?a:function(){return a}}function f(a){var b=a[0],c=a[a.length-1];return c>b?[b,c]:[c,b]}function g(a){return a.rangeExtent?a.rangeExtent():f(a.range())}function h(a){return a[0]}function i(a){return a[1]}function j(){return!0}function l(a,b){return(b[1]-a[1])/(b[0]-a[0])}function m(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function n(a,b){for(var c,d=[],e=(1-b)/2,f=a[0],g=a[1],h=1,i=a.length;++h<i;)c=f,f=g,g=a[h],d.push([e*(g[0]-c[0]),e*(g[1]-c[1])]);return d}function o(a){for(var b=0,c=a.length-1,d=[],e=a[0],f=a[1],g=d[0]=l(e,f);++b<c;)d[b]=(g+(g=l(e=f,f=a[b+1])))/2;return d[b]=g,d}function p(a){for(var b,c,d,e,f=[],g=o(a),h=-1,i=a.length-1;++h<i;)b=l(a[h],a[h+1]),Sb(b)<Mb?g[h]=g[h+1]=0:(c=g[h]/b,d=g[h+1]/b,e=c*c+d*d,e>9&&(e=3*b/Math.sqrt(e),g[h]=e*c,g[h+1]=e*d));for(h=-1;++h<=i;)e=(a[Math.min(i,h+1)][0]-a[Math.max(0,h-1)][0])/(6*(1+g[h]*g[h])),f.push([e||0,g[h]*e||0]);return f}function q(a,b,c,d){var e=a[0],f=c[0],g=b[0]-e,h=d[0]-f,i=a[1],j=c[1],k=b[1]-i,l=d[1]-j,m=(h*(i-j)-l*(e-f))/(l*g-h*k);return[e+m*g,i+m*k]}function r(a){return a>1?Qb:-1>a?-Qb:Math.asin(a)}function s(a){return a.innerRadius}function t(a){return a.outerRadius}function u(a){return a.startAngle}function v(a){return a.endAngle}function w(a){return a&&a.padAngle}function x(a,b,c,d){return(a-c)*b-(b-d)*a>0?0:1}function y(a,b,c,d,e){var f=a[0]-b[0],g=a[1]-b[1],h=(e?d:-d)/Math.sqrt(f*f+g*g),i=h*g,j=-h*f,k=a[0]+i,l=a[1]+j,m=b[0]+i,n=b[1]+j,o=(k+m)/2,p=(l+n)/2,q=m-k,r=n-l,s=q*q+r*r,t=c-d,u=k*n-m*l,v=(0>r?-1:1)*Math.sqrt(t*t*s-u*u),w=(u*r-q*v)/s,x=(-u*q-r*v)/s,y=(u*r+q*v)/s,z=(-u*q+r*v)/s,A=w-o,B=x-p,C=y-o,D=z-p;return A*A+B*B>C*C+D*D&&(w=y,x=z),[[w-i,x-j],[w*c/t,x*c/t]]}function z(){}function A(a){return E(a,"width")}function B(a){return E(a,"height")}function C(a){return F(a,"width")}function D(a){return F(a,"height")}function E(a,b){for(var c,d=a.node();d&&"BODY"!==d.tagName&&!(c=d.getBoundingClientRect()[b]);)d=d.parentNode;return c}function F(b,c){for(var d,e=b.node();e&&"BODY"!==e.tagName;){if(d=e.getBoundingClientRect()[c])return a.select(e);e=e.parentNode}}function G(a){return"svg"===a.tagName.toLowerCase()?a:a.ownerSVGElement}function H(a){var b={},c=a.getScreenCTM(),d=G(a),e=d.createSVGPoint(),f=a.getBBox(),g=f.width,h=f.height,i=f.x,j=f.y;return e.x=i,e.y=j,b.nw=e.matrixTransform(c),e.x+=g,b.ne=e.matrixTransform(c),e.y+=h,b.se=e.matrixTransform(c),e.x-=g,b.sw=e.matrixTransform(c),e.y-=h/2,b.w=e.matrixTransform(c),e.x+=g,b.e=e.matrixTransform(c),e.x-=g/2,e.y-=h/2,b.n=e.matrixTransform(c),e.y+=h,b.s=e.matrixTransform(c),b}function I(a,b,c){function d(a,b){"function"==typeof c[a]?c[a](b):c[a]=b}var e,f={},g=!1;return Zb.forEach(function(a){f[a]=c[a]||b[a]}),f.size=0,b.active&&(c.active||(c.active={}),Ab(b.active,c.active),N(c)),c.reset=function(){return g=!1,Zb.forEach(function(a){d(a,f[a])}),c},c.highLight=function(){if(g)return c;g=!0;var a,b=c.active;return b&&Zb.forEach(function(c){a=b[c],a&&($b.indexOf(c)>-1&&(a*=f[c]),d(c,a))}),c},c.set=function(a,b){return f[a]=b,d(a,b),c},c.size=function(a){return arguments.length?(e=+a,c):c.symbol?e*e*(Yb[c.symbol]||1):e},c.options=function(){return b},c.forEach=function(a){a(c)},c}function J(b,c,d){return yb.isArray(d)&&(d={label:d[0],value:d[1]}),d.fill||(d.fill=b.pickColor()),d.color||(d.color=a.rgb(d.fill).darker()),I(b,c,d)}function K(a,b){var c=a.options?a.options():a[0].options();return b.setOptions=function(d,e){return-1===Zb.indexOf(d)?c[d]=e:a.forEach(function(a){a.set(d,e)}),b},b.data=function(){return a},b}function M(b,c){c.color||(c.color=b.pickColor()),c.fill===!0&&(c.fill=a.rgb(c.color).brighter()),N(c)}function N(b){var c=b.active;c||(c=b.active={}),"darker"===c.fill?c.fill=a.rgb(b.fill).darker():"brighter"===c.fill&&(c.fill=a.rgb(b.fill).brighter()),"darker"===c.color?c.color=a.rgb(b.color).darker():"brighter"===c.color&&(c.color=a.rgb(b.color).brighter())}function O(b,c,d){return"auto"===d.width?a.round(.8*(b.innerWidth()/c.length)):d.width}function P(b,c){var d,e;c?(d=c.width,e=c.height,c=Cb(c,function(a,b){return void 0!==rb.defaults.paper[b]?a:void 0})):c={};var f=zb(!0,{},rb.defaults.paper,c);d||(d=A(b),d?f.elwidth=C(b):d=rb.constants.WIDTH),e?"string"==typeof e&&e.indexOf("%")===e.length-1&&(f.height_percentage=.01*parseFloat(e),e=a.round(f.height_percentage*d)):(e=B(b),e?f.elheight=D(b):e=rb.constants.HEIGHT),Ab(f.font,f.xaxis),Ab(f.xaxis,f.yaxis),Ab(f.yaxis,f.yaxis2),f.size=[d,e];var g=a[f.type];return f.xAxis=g.axis(),f.yAxis=[g.axis(),g.axis()],f}function Q(a){function b(h){function i(){k(c,a(n),m)}if(c){for(var j,l=[],n=[],o=-1,p=h.length,q=e(d),r=e(f);++o<p;)g.call(b,j=h[o],o)?n.push([+q.call(b,j,o),+r.call(b,j,o)]):n.length&&(i(),n=[]);return n.length&&i(),l.length?l.join(""):null}}var c,d=h,f=i,g=j,k=R,l=k.key,m=.7;return b.context=function(a){return arguments.length?(c=a,b):c},b.x=function(a){return arguments.length?(d=a,b):d},b.y=function(a){return arguments.length?(f=a,b):f},b.defined=function(a){return arguments.length?(g=a,b):g},b.interpolate=function(a){return arguments.length?(l="function"==typeof a?k=a:(k=cc.get(a)||R).key,b):l},b.tension=function(a){return arguments.length?(m=a,b):m},b}function R(a,b,c,d){var e=b[0];d||(a.beginPath(),a.moveTo(e[0],e[1]));for(var f=1;f<b.length;++f)e=b[f],a.lineTo(e[0],e[1])}function S(a,b){R(a,b),a.closePath()}function T(a,b){var c=b[1],d=b[0],e=.5*(c[0]+d[0]);a.beginPath(),a.moveTo(d[0],d[1]),a.lineTo(e,d[1]),a.lineTo(e,c[1]);for(var f=2;f<b.length;++f)d=c,c=b[f],e=.5*(c[0]+d[0]),a.lineTo(e,d[1]),a.lineTo(e,c[1]);a.lineTo(c[0],c[1])}function U(a,b){var c,d=b[0];a.beginPath(),a.moveTo(d[0],d[1]);for(var e=1;e<b.length;++e)c=d,d=b[e],a.lineTo(c[0],d[1]),a.lineTo(d[0],d[1])}function V(a,b){var c,d=b[0];a.beginPath(),a.moveTo(d[0],d[1]);for(var e=1;e<b.length;++e)c=d,d=b[e],a.lineTo(d[0],c[1]),a.lineTo(d[0],d[1])}function W(a,b){if(b.length<3)return R(a,b);var c=1,d=b.length,e=b[0],f=e[0],g=e[1],h=[f,f,f,(e=b[1])[0]],i=[g,g,g,e[1]];for(a.beginPath(),a.moveTo(f,g),a.lineTo(m(ub,h),m(ub,i)),b.push(b[d-1]);++c<=d;)e=b[c],h.shift(),h.push(e[0]),i.shift(),i.push(e[1]),cb(a,h,i);b.pop(),a.lineTo(e[0],e[1])}function X(a,b){if(b.length<4)return R(b);for(var c,d=-1,e=b.length,f=[0],g=[0];++d<3;)c=b[d],f.push(c[0]),g.push(c[1]);for(a.beginPath(),a.moveTo(m(ub,f),m(ub,g)),--d;++d<e;)c=b[d],f.shift(),f.push(c[0]),g.shift(),g.push(c[1]),cb(a,f,g)}function Y(a,b){for(var c,d=-1,e=b.length,f=e+4,g=[],h=[];++d<4;)c=b[d%e],g.push(c[0]),h.push(c[1]);for(a.beginPath(),a.moveTo(m(ub,g),m(ub,h)),--d;++d<f;)c=b[d%e],g.shift(),g.push(c[0]),h.shift(),h.push(c[1]),cb(a,g,h)}function Z(a,b,c){var d=b.length-1;if(d)for(var e,f,g=b[0][0],h=b[0][1],i=b[d][0]-g,j=b[d][1]-h,k=-1;++k<=d;)e=b[k],f=k/d,e[0]=c*e[0]+(1-c)*(g+f*i),e[1]=c*e[1]+(1-c)*(h+f*j);return W(a,b)}function $(a,b,c){b.length<3?R(a,b):(a.beginPath(),a.moveTo(b[0][0],b[0][1]),db(a,b,n(b,c)))}function _(a,b,c){b.length<4?R(a,b):(a.beginPath(),a.moveTo(b[1][0],b[1][1]),db(a,b.slice(1,-1),n(b,c)))}function ab(a,b,c){b.length<3?R(a,b):(a.beginPath(),a.moveTo(b[0][0],b[0][1]),db(a,(b.push(b[0]),b),n([b[b.length-2]].concat(b,[b[1]]),c)))}function bb(a,b){b.length<3?R(a,b):(a.beginPath(),a.moveTo(b[0][0],b[0][1]),db(a,b,p(b)))}function cb(a,b,c){a.bezierCurveTo(m(sb,b),m(sb,c),m(tb,b),m(tb,c),m(ub,b),m(ub,c))}function db(a,b,c){if(c.length<1||b.length!=c.length&&b.length!=c.length+2)return R(a,b,null,!0);var d,e,f=b.length!=c.length,g=b[0],h=b[1],i=c[0],j=i,k=1;if(f&&(a.quadraticCurveTo(h[0]-2*i[0]/3,h[1]-2*i[1]/3,h[0],h[1]),g=b[1],k=2),c.length>1){j=c[1],h=b[k],k++,a.bezierCurveTo(g[0]+i[0],g[1]+i[1],h[0]-j[0],h[1]-j[1],h[0],h[1]);for(var l=2;l<c.length;l++,k++)d=h[0]+j[0],e=h[1]+j[1],h=b[k],j=c[l],a.bezierCurveTo(d,e,h[0]-j[0],h[1]-j[1],h[0],h[1])}if(f){var m=b[k];a.quadraticCurveTo(h[0]+2*j[0]/3,h[1]+2*j[1]/3,m[0],m[1])}}function eb(a,b){var c=Math.sqrt(b/Nb);a.beginPath(),a.arc(0,0,c,0,Ob,!1),a.closePath()}function fb(b,c){if(1>c){var d=a.rgb(b);return"rgba("+d.r+","+d.g+","+d.b+","+c+")"}return b}function gb(b,c,d,e,f){function g(b){b.save(),b.translate(e?e():0,f?f():0),d(a.select(b.canvas)),b.restore()}var h,i=I(b,c,{});return i.draw=function(a){var d=c.size;return c.size=b.scale(b.dim(d))+"px",a=a||h,h.strokeStyle=i.color,a.fillStyle=i.color,a.font=Lb(c),h.lineWidth=b.factor()*i.lineWidth,g(a),a.stroke(),c.size=d,i},i.context=function(a){return h=a,i},i.inRange=function(){return!1},i.reset()}function hb(b,c,d){function e(b){var c=j.area?a.canvas.area():a.canvas.line();c.interpolate(j.interpolate).x(function(a){return g(a.x)}).y(function(a){return h(a.y)}).context(b)(d)}var f,g=b.scalex,h=b.scaley,i=b.factor(),j=I(b,c,{});return j.draw=function(a){return a=a||f,f.strokeStyle=j.color,f.lineWidth=i*j.lineWidth,e(a),a.stroke(),j},j.context=function(a){return f=a,j},j.inRange=function(a,b){return e(f),f.isPointInPath(a,b)},j.reset()}function ib(a,b,c,d){var e,f=a.scalex,g=a.scaley,h=a.factor();return c=I(a,b,{data:c}),c.draw=function(a){return a=a||e,a.save(),a.fillStyle=fb(c.fill,c.fillOpacity),a.strokeStyle=fb(c.color,c.colorOpacity),a.lineWidth=h*c.lineWidth,a.translate(f(c.data.x),g(c.data.y)),d.context(a)(c),a.fill(),a.stroke(),a.restore(),c},c.context=function(a){return e=a,c},c.inRange=function(a,b){e.save(),e.translate(f(c.data.x),g(c.data.y)),d.context(e)(c);var h=e.isPointInPath(a,b);return e.restore(),h},c.reset()}function jb(a,b,c){function d(a){a.beginPath(),i=.5*c.size(),f=j(c.data.x),g=k(c.data.y),h=k(0),lb(a,[[f-i,h],[f+i,h],[f+i,g],[f-i,g]],m),a.closePath()}var e,f,g,h,i,j=a.scalex,k=a.scaley,l=a.factor(),m=l*b.radius;return c=I(a,b,{data:c}),c.context=function(a){return e=a,c},c.draw=function(a){return a=a||e,a.fillStyle=fb(c.fill,c.fillOpacity),a.strokeStyle=fb(c.color,c.colorOpacity),a.lineWidth=l*c.lineWidth,d(a),a.fill(),a.stroke(),c},c.inRange=function(a,b){return d(e),e.isPointInPath(a,b)},c.reset()}function kb(a,b,c,d){var e,f=(a.scalex,a.scaley,a.factor());return c=J(a,b,c),c.draw=function(b){return b=b||e,b.save(),b.translate(.5*a.innerWidth(),.5*a.innerHeight()),b.fillStyle=fb(c.fill,c.fillOpacity),b.strokeStyle=fb(c.color,c.colorOpacity),b.lineWidth=f*c.lineWidth,d.context(b)(c),b.fill(),b.stroke(),b.restore(),c},c.context=function(a){return e=a,c},c.inRange=function(b,f){e.save(),e.translate(.5*a.innerWidth(),.5*a.innerHeight()),d.context(e)(c);var g=e.isPointInPath(b,f);return e.restore(),g},c.reset()}function lb(a,b,c){c>0&&(b=mb(b,c));var d,e,f=b.length;for(a.beginPath(),d=0;f>d;d++)e=b[d],0===d?a.moveTo(e[0],e[1]):a.lineTo(e[0],e[1]),c>0&&a.quadraticCurveTo(e[2],e[3],e[4],e[5]);a.closePath()}function mb(a,b){var c,d,e,f,g,h,i,j,k=a.length,l=new Array(k);for(d=0;k>d;d++)c=d-1,e=d+1,0>c&&(c=k-1),e===k&&(e=0),f=a[c],g=a[d],h=a[e],i=nb(f[0],f[1],g[0],g[1],b,!1),j=nb(g[0],g[1],h[0],h[1],b,!0),l[d]=[i[0],i[1],g[0],g[1],j[0],j[1]];return l}function nb(a,b,c,d,e,f){var g=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2)),h=f?e/g:(g-e)/g;return[a+h*(c-a),b+h*(d-b)]}function ob(b,c){function d(){e||(c.grid=zb({},c.grid,rb.defaults.paper.grid),void 0===c.xaxis.grid&&(c.xaxis.grid=!0),void 0===c.yaxis.grid&&(c.yaxis.grid=!0),e=a[g].axis(),f=a[g].axis())}var e,f,g=b.type(),h={};b.showGrid=function(){return d(),h[g].addgrid(),h[g].showhide(e,b.xAxis(),"x",c.xaxis.grid),h[g].showhide(f,b.yAxis(),"y",c.yaxis.grid),b},b.hideGrid=function(){return e&&(h[g].showhide(e,b.xAxis(),"x"),h[g].showhide(f,b.yAxis(),"y")),b},b.xGrid=function(){return d(),e},b.yGrid=function(){return d(),f},h.svg={addgrid:function(){var a=b.root().current().select("rect.grid");a.node()||(a=b.current().insert("rect","*").attr("class","grid").attr("width",b.innerWidth()).attr("height",b.innerHeight())),b.setBackground(a,c.grid.background)},showhide:function(a,d,e,f){var g=b.root().current().select("."+e+"-grid");f?g.node()||(a.scale(d.scale()).ticks(d.ticks()).tickFormat(""),g=b.group().attr("class","grid "+e+"-grid").attr("stroke",c.grid.color).attr("stroke-opacity",c.grid.opacity),c.grid.background&&g.attr("fill",c.grid.backgroundColor),"x"===e?a.tickSize(b.innerHeight(),0):a.tickSize(-b.innerWidth(),0).orient("left"),b.addComponent(I(b,{},g),function(){g.call(a)})):g.remove()}},h.canvas={addgrid:function(){},showhide:function(){}}}function pb(a,b){if(b.show){var c=rb.tip(a);return c.attr("class",b.className).style({background:b.fill,opacity:b.fillOpacity,color:b.color,padding:b.padding,"border-radius":b.radius}),"d3-tip"===b.className&&lc&&(lc["d3-tip:after"].color=b.fill,Ib("",lc),lc=null),c}}var qb={version:"0.1.0",d3:a,math:{}},rb=qb;a.giotto=qb,a.canvas={},rb.require=function(a,c){return b.rcfg&&b.rcfg.min&&(a=b.rcfg.min(a)),require(a,c),rb};var sb=[0,2/3,1/3,0],tb=[0,1/3,2/3,0],ub=[0,1/6,2/3,1/6],vb="auto",wb=function(a){function b(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function c(a){var c=window.console||{},d=c[a]||c.log||z,e=!1;try{e=!!d.apply}catch(f){}return e?function(){for(var a=[],e=0;e<arguments.length;++e)a.push(b(arguments[e]));return d.apply(c,a)}:function(a,b){d(a,null===b?"":b)}}return{log:c("log"),info:c("info"),warn:c("warn"),error:c("error"),debug:function(){var b=c("debug");return function(){a&&b.apply(self,arguments)}}()}};rb.log=wb(b.debug);var xb=Object.prototype.toString,yb=rb._={},zb=rb.extend=yb.extend=function(){var a,b=arguments.length,c=arguments[0],d=0,e=!1;if(c===!0&&(e=!0,c=arguments[1],d++),!c||d+2>b)return c;for(;++d<b;)if(a=arguments[d],Object(a)===a)for(var f in a)a.hasOwnProperty(f)&&(e&&yb.isObject(a[f])?yb.isObject(c[f])?zb(!0,c[f],a[f]):c[f]=zb(!0,{},a[f]):c[f]=a[f]);return c},Ab=yb.copyMissing=function(a,b){if(a&&b)for(var c in a)a.hasOwnProperty(c)&&void 0===b[c]&&(b[c]=a[c]);return b},Bb=function(a){if(a&&"string"==typeof a.options){for(var c=b,d=a.options.split("."),e=0;e<d.length&&(c=c[d[e]],c);++e);"function"==typeof c&&(c=c(rb,a)),a=zb(a,c)}return a},Cb=(yb.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},yb.size=function(a){if(a){if(void 0!==a.length)return a.length;if(yb.isObject(a)){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}return 0}return 0},yb.pick=function(a,b){var c,d={};for(var e in a)a.hasOwnProperty(e)&&(c=b(a[e],e),void 0!==c&&(d[e]=c));return d}),Db=yb.isObject=function(a){return"[object Object]"===xb.call(a)},Eb=(yb.isString=function(a){return"[object String]"===xb.call(a)},yb.isFunction=function(a){return"[object Function]"===xb.call(a)}),Fb=yb.isArray=function(a){return"[object Array]"===xb.call(a)},Gb=yb.isNull=function(a){return void 0===a||null===a},Hb=(yb.encodeObject=function(a,b){var c;if("multipart/form-data"===b){var d=new FormData;for(c in a)a.hasOwnProperty(c)&&d.append(c,a[c]);return d}if("application/json"===b)return JSON.stringify(a);var e=[];for(c in a)a.hasOwnProperty(c)&&e.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return e.join("&")},yb.getObject=function(a){if(yb.isString(a)){var c=a.split(".");a=b;for(var d=0;d<c.length&&(a=a[c[d]],a);++d);}return a}),Ib=(yb.loadCss=function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet"),b.setAttribute("type","text/css"),b.setAttribute("href",a),document.getElementsByTagName("head")[0].appendChild(b)},yb.addCss=function(a,b){function c(a,b){var e,f=[];for(var g in b)b.hasOwnProperty(g)&&(e=b[g],yb.isObject(e)?c(a+" ."+g,e):f.push("    "+g+": "+e+";"));f.length&&d.push(a+" {\n"+f.join("\n")+"\n}")}var d=[];if(c(a,b),d.length){d=d.join("\n");var e=document.createElement("style");return e.innerHTML=d,document.getElementsByTagName("head")[0].appendChild(e),e}}),Jb=yb.slugify=function(a){a=a.replace(/^\s+|\s+$/g,""),a=a.toLowerCase();for(var b="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",c="aaaaeeeeiiiioooouuuunc------",d=0,e=b.length;e>d;d++)a=a.replace(new RegExp(b.charAt(d),"g"),c.charAt(d));return a=a.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},Kb=["style","variant","weight","size","family"],Lb=yb.fontString=function(a){for(var b,c=[],d=0;d<Kb.length;++d)b=a[Kb[d]],b&&c.push(b);return c.join(" ")};rb.slider=function(){function b(b){b.each(function(){function b(b){"boolean"==typeof o&&(o=a.svg.axis().ticks(Math.round(i/100)).tickFormat(u).orient("horizontal"===n?"bottom":"right")),g=f.copy().range([0,i]),o.scale(g);var c=b.append("svg").classed("d3-slider-axis d3-slider-axis-"+o.orient(),!0).on("click",x),d=c.append("g");"horizontal"===n?(c.style("margin-left",-p+"px"),c.attr({width:i+2*p,height:p}),"top"===o.orient()?(c.style("top",-p+"px"),d.attr("transform","translate("+p+","+p+")")):d.attr("transform","translate("+p+",0)")):(c.style("top",-p+"px"),c.attr({width:p,height:i+2*p}),"left"===o.orient()?(c.style("left",-p+"px"),d.attr("transform","translate("+p+","+p+")")):d.attr("transform","translate(0,"+p+")")),d.call(o)}function l(){if(!e.length){var b=Math.max(0,Math.min(i,a.event.offsetX||a.event.layerX));c(d(f.invert(b/i)))}}function m(){if(!e.length){var b=i-Math.max(0,Math.min(i,a.event.offsetY||a.event.layerY));c(d(f.invert(b/i)))}}function r(){"handle-one"===a.event.sourceEvent.target.id?q=1:"handle-two"==a.event.sourceEvent.target.id&&(q=2);var b=Math.max(0,Math.min(i,a.event.x));c(d(f.invert(b/i)))}function w(){"handle-one"===a.event.sourceEvent.target.id?q=1:"handle-two"==a.event.sourceEvent.target.id&&(q=2);var b=i-Math.max(0,Math.min(i,a.event.y));c(d(f.invert(b/i)))}function x(){a.event.stopPropagation()}f||(f=a.scale.linear().domain([j,k])),e=e||f.domain()[0];var y=a.select(this).classed("d3-slider d3-slider-"+n,!0),z=a.behavior.drag();z.on("dragend",function(){s.slideend(a.event,e)});var A;if(2==e.length?(h=y.append("a").classed("d3-slider-handle",!0).attr("xlink:href","#").attr("id","handle-one").on("click",x).call(z),v=y.append("a").classed("d3-slider-handle",!0).attr("id","handle-two").attr("xlink:href","#").on("click",x).call(z)):h=y.append("a").classed("d3-slider-handle",!0).attr("xlink:href","#").attr("id","handle-one").on("click",x).call(z),"horizontal"===n){if(y.on("click",l),2==e.length){A=a.select(this).append("div").classed("d3-slider-range",!0),h.style("left",t(f(e[0]))),A.style("left",t(f(e[0]))),z.on("drag",r);var B=100-parseFloat(t(f(e[1])));v.style("left",t(f(e[1]))),A.style("right",B+"%"),z.on("drag",r)}else h.style("left",t(f(e))),z.on("drag",r);i=parseInt(y.style("width"),10)}else{if(y.on("click",m),z.on("drag",w),2==e.length){A=a.select(this).append("div").classed("d3-slider-range-vertical",!0),h.style("bottom",t(f(e[0]))),A.style("bottom",t(f(e[0]))),z.on("drag",w);var C=100-parseFloat(t(f(e[1])));v.style("bottom",t(f(e[1]))),A.style("top",C+"%"),z.on("drag",w)}else h.style("bottom",t(f(e))),z.on("drag",w);i=parseInt(y.style("height"),10)}o&&b(y)})}function c(b){var c=e.length?e[q-1]:e,g=t(f(d(c))),i=t(f(d(b))),j="horizontal"===n?"left":"bottom";if(g!==i){if(2===e.length?(e[q-1]=b,a.event&&s.slide(a.event,e)):a.event&&s.slide(a.event.sourceEvent||a.event,e=b),e[0]>=e[1])return;if(1===q)2===e.length&&("left"===j?divRange.style("left",i):divRange.style("bottom",i)),m?h.transition().styleTween(j,function(){return a.interpolate(g,i)}).duration("number"==typeof m?m:250):h.style(j,i);else{var k=100-parseFloat(i),l=100-parseFloat(i);"left"===j?divRange.style("right",k+"%"):divRange.style("top",l+"%"),m?v.transition().styleTween(j,function(){return a.interpolate(g,i)}).duration("number"==typeof m?m:250):v.style(j,i)}}}function d(a){if(a===f.domain()[0]||a===f.domain()[1])return a;var b=a;if(r){var c=f(a),d=f.ticks().map(function(a){return c-f(a)}),e=-1,g=0,h=f.range()[1];do e++,Math.abs(d[e])<h&&(h=Math.abs(d[e]),g=e);while(d[e]>0&&e<d.length-1);b=f.ticks()[g]}else{var i=(a-f.domain()[0])%l;b=a-i,2*Math.abs(i)>=l&&(b+=i>0?l:-l)}return b}var e,f,g,h,i,j=0,k=100,l=.01,m=!0,n="horizontal",o=!1,p=50,q=1,r=!1,s=a.dispatch("slide","slideend"),t=a.format(".2%"),u=a.format(".0"),v=null;return b.min=function(a){return arguments.length?(j=a,b):j},b.max=function(a){return arguments.length?(k=a,b):k},b.step=function(a){return arguments.length?(l=a,b):l},b.animate=function(a){return arguments.length?(m=a,b):m},b.orientation=function(a){return arguments.length?(n=a,b):n},b.axis=function(a){return arguments.length?(o=a,b):o},b.margin=function(a){return arguments.length?(p=a,b):p},b.value=function(a){return arguments.length?(e&&c(d(a)),e=a,b):e},b.snap=function(a){return arguments.length?(r=a,b):r},b.scale=function(a){return arguments.length?(f=a,b):f},a.rebind(b,s,"on"),b},rb.math.distances={euclidean:function(a,b){for(var c=0,d=0;d<a.length;d++)c+=Math.pow(b[d]-a[d],2);return Math.sqrt(c)}},rb.math.kmeans=function(a,b,c){var d={};return b=b||300,c=c||"euclidean","string"==typeof c&&(c=rb.math.distances[c]),d.centroids=function(b){return arguments.length?(a=b,d):a},d.maxIters=function(a){return arguments.length?(b=+a,d):b},d.randomCentroids=function(a,b){var c=a.slice(0);return c.sort(function(){return Math.round(Math.random())-.5}),c.slice(0,b)},d.classify=function(b){var d,e,f=1/0,g=0;for(d=0;d<a.length;d++)e=c(b,a[d]),f>e&&(f=e,g=d);return g},d.cluster=function(c,e){var f,g,h,i=0,j=!0,k=c.length,l=a.length,m=new Array(l);if(l>k)throw Error("Number of points less than the number of clusters in K-means classification");for(;j&&b>i;){for(j=!1,++i,h=0;l>h;++h)m[h]={centroid:a[h],points:[],indices:[]};for(g=0;k>g;g++)h=d.classify(c[g]),m[h].points.push(c[g]),m[h].indices.push(g);for(f=[],h=0;l>h;++h){if(!m[h].points.length){f=d.randomCentroids(c,l);break}f.push(rb.math.mean(m[h].points))}for(h=0;l>h;++h)if(f[h]!=a[h]){a=f,j=!0;break}e&&e(m,i)}return m},d};var Mb=1e-6,Nb=Math.PI,Ob=2*Nb,Pb=Ob-Mb,Qb=Nb/2,Rb=Nb/180,Sb=Math.abs;rb.math.xyfunction=function(a,b){var c=[];return Fb(a)&&a.forEach(function(a){c.push([a,b(a)])}),c},rb.math.mean=function(a){var b,c,d,e=a[0].slice(0);for(c=1;c<a.length;++c)for(b=a[c],d=0;d<e.length;++d)e[d]+=b[d];for(d=0;d<e.length;++d)e[d]/=a.length;return e};var Tb=52,Ub=2<<51,Vb=21201,Wb=["d       s       a       m_i","2       1       0       1","3       2       1       1 3","4       3       1       1 3 1","5       3       2       1 1 1","6       4       1       1 1 3 3","7       4       4       1 3 5 13","8       5       2       1 1 5 5 17","9       5       4       1 1 5 5 5","10      5       7       1 1 7 11 1"];rb.math.sobol=function(a){if(1>a||a>Vb)throw new Error("Out of range dimension");var b,c,d={},e=0,f=[],g=[],h=[];d.next=function(){var b=[];if(0===e)return e++,h.slice();for(var d=1,i=e-1;1==(1&i);)i>>=1,d++;for(c=0;a>c;c++)g[c]^=f[c][d],b[c]=g[c]/Ub;return e++,b},d.dimension=function(){return a},d.count=function(){return e};var i=[];for(c=0;Tb>=c;c++)i.push(0);for(c=0;a>c;c++)f[c]=i.slice(),g[c]=0,h[c]=0;if(a>Wb.length)throw new Error("Out of range dimension");for(b=Wb,c=1;Tb>=c;c++)f[0][c]=1<<Tb-c;for(var j=1;a>j;j++){var k=b[j].split(/\s+/),l=+k[1],m=+k[2],n=[0];for(c=0;l>c;c++)n.push(+k[3+c]);for(c=1;l>=c;c++)f[j][c]=n[c]<<Tb-c;for(c=l+1;Tb>=c;c++){f[j][c]=f[j][c-l]^f[j][c-l]>>l;for(var o=1;l-1>=o;o++)f[j][c]^=(m>>l-1-o&1)*f[j][c-o]}}return d},rb.defaults={},rb.defaults.axis={tickSize:"6px",outerTickSize:"6px",tickPadding:"3px",lineWidth:1,min:null,max:null},rb.defaults.paper={type:"svg",resizeDelay:200,resize:!0,margin:{top:20,right:20,bottom:20,left:20},xaxis:zb({position:"bottom"},rb.defaults.axis),yaxis:{position:"left",min:null,max:null},yaxis2:{position:"right",min:null,max:null},colors:a.scale.category10().range(),css:null,activeEvents:["mousemove","touchstart","touchmove","mouseout"],line:{interpolate:"cardinal",fill:"none",fillOpacity:1,colorOpacity:1,lineWidth:2,active:{color:"darker",lineWidth:1}},point:{symbol:"circle",size:"8px",fill:!0,fillOpacity:1,colorOpacity:1,lineWidth:2,active:{fill:"darker",color:"brighter",size:1.5}},bar:{width:"auto",color:null,fill:!0,fillOpacity:1,colorOpacity:1,lineWidth:2,radius:4,active:{fill:"darker",color:"brighter"}},pie:{lineWidth:1,padAngle:0,cornerRadius:0,fillOpacity:.7,colorOpacity:1,innerRadius:0,active:{fill:"darker",color:"brighter"}},font:{color:"#444",size:"11px",weight:"normal",lineHeight:13,style:"normal",family:"sans-serif",variant:"small-caps"}},rb.defaults.viz=zb({onInit:null,events:["build","change","start","tick","end"],contextmenu:[{label:"Open Image",callback:function(a){window.open(a.image())}}]}),rb.constants={DEFAULT_VIZ_GROUP:"default_viz_group",WIDTH:400,HEIGHT:300,leaflet:"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"};var Xb=0;rb.paper=function(b,c){var d,e,f={},g=++Xb;return f.type=function(){return c.type},f.uid=function(){return g},f.width=function(){return c.size[0]},f.height=function(){return c.size[1]},f.innerWidth=function(){return c.size[0]-c.margin.left-c.margin.right},f.innerHeight=function(){return c.size[1]-c.margin.top-c.margin.bottom},f.size=function(){return[f.width(),f.height()]},f.aspectRatio=function(){return f.innerHeight()/f.innerWidth()},f.element=function(){return b},f.yaxis=function(a){return arguments.length?((1===+a||2===+a)&&(d=+a),f):d},f.xAxis=function(){return c.xAxis},f.yAxis=function(){return c.yAxis[d-1]},f.allAxis=function(){var a=f.innerWidth(),b=f.innerHeight(),d=f.yaxis(),e=[{axis:f.xAxis(),o:c.xaxis,range:[0,a]},{axis:f.yaxis(1).yAxis(),o:c.yaxis,range:[b,0]},{axis:f.yaxis(2).yAxis(),o:c.yaxis2,range:[b,0]}];return f.yaxis(d),e},f.scale=function(a){var b=c.xAxis.scale();return Math.max(0,b(a)-b(0))},f.scalex=function(a){return c.xAxis.scale()(a)},f.scaley=function(a){return f.yAxis().scale()(a)},f.xfromPX=function(a){return c.xAxis.scale().invert(a)},f.yfromPX=function(a){return f.yAxis().scale().invert(a)},f.resize=function(a){c._resizing=!0,a||(a=f.boundingBox()),(c.size[0]!==a[0]||c.size[1]!==a[1])&&(rb.log.info("Resizing paper"),f.refresh(a)),c._resizing=!1},f.dim=function(a){var b=+a;if(isNaN(b))return f.xfromPX(a.substring(0,a.length-2));var c=f.xAxis().scale().domain();return b*(c[c.length-1]-c[0])},f.x=function(a){var b=f.xAxis().scale().domain();return a*(b[b.length-1]-b[0])+b[0]},f.y=function(a){var b=f.yAxis().scale().domain();return a*(b[b.length-1]-b[0])+b[0]},f.boundingBox=function(){var b,d=c.elwidth?A(c.elwidth):c.size[0];return b=c.height_percentage?a.round(d*c.height_percentage,0):c.elheight?B(c.elheight):c.size[1],[d,b]},f.pickColor=function(b,d){0===arguments.length&&(b=e++);for(var f=1,g=0;b>=c.colors.length;)b-=c.colors.length,g+=f;var h=c.colors[b];return d&&(h=a.rgb(h).darker(d)),g&&(h=a.rgb(h).brighter(g)),h},f.clear=function(){return e=0,f},f.options=function(){return c},f.drawXaxis=function(){var a=c.xaxis,b="top"===a.position?0:f.innerHeight;return c._axis(f.xAxis(),"x-axis",0,b,a)},f.drawYaxis=function(){var a=f.yaxis(),b=1===a?c.yaxis:c.yaxis2,d="left"===b.position?0:f.innerWidth;return c._axis(f.yAxis(),"y-axis-"+a,d,0,b)},f.resetAxis=function(){return f.yaxis(1).allAxis().forEach(function(a){var b=(a.axis,a.o),c=f.scale(f.dim(b.tickSize)),d=f.scale(f.dim(b.outerTickSize)),e=f.scale(f.dim(b.tickPadding));a.axis.scale().range(a.range),a.axis.tickSize(c,d).tickPadding(e).orient(b.position),(Gb(b.min)||Gb(b.max))&&(b.auto=!0)}),f},Db(b)&&(c=b,b=null),b||(b=document.createElement("div")),b=a.select(b),c=P(b,c),rb.paper[c.type](f,c),f.clear().resetAxis(),c.css&&Ib("#giotto-paper-"+f.uid(),c.css),c.resize&&a.select(window).on("resize.paper"+f.uid(),function(){c._resizing||(c.resizeDelay?(c._resizing=!0,a.timer(function(){return f.resize(),!0},c.resizeDelay)):f.resize())}),f},rb.paper.addType=function(a,b){var c=[];rb.paper[a]=function(a,d){b(a,d);for(var e=0;e<c.length;++e)c[e](a,d);return a},rb.paper[a].plugin=function(a,b,d){rb.defaults.paper[a]=b,c.push(d)}},rb.paper.addType("html",function(a){clear=a.clear,a.clear=function(){return a.element().selectAll("*").remove(),clear()}}),rb.paper.addType("svg",function(b,c){function d(a,b){return a.style({fill:b.color,"font-size":b.size,"font-weight":b.weight,"font-style":b.style,"font-family":b.family,"font-variant":b.variant})}function e(a){return a.attr("stroke",function(a){return a.color}).attr("stroke-width",function(a){return a.lineWidth}).attr("fill",function(a){return a.fill}).attr("fill-opacity",function(a){return a.fillOpacity})}function f(b){return c.activeEvents.forEach(function(c){b.on(c+".paper-active",function(){"mouseout"===a.event.type?m.activeout(this):m.activein(this)})}),b}var g,h,i,j,k=b.element().append("svg").attr("class","giotto").attr("id","giotto-paper-"+b.uid()).attr("width",c.size[0]).attr("height",c.size[1]).attr("viewBox","0 0 "+c.size[0]+" "+c.size[1]),l=b.clear,m=a.dispatch("activein","activeout");b.destroy=function(){return k=j=null,b.element().selectAll("*").remove(),b},b.refresh=function(a){return a&&(c.size=a,k.attr("width",c.size[0]).attr("height",c.size[1])),b},b.render=function(a){arguments.length?h[a]&&h[a]():g.forEach(function(a){a()})},b.clear=function(){return g=[],h={},i=0,k.selectAll("*").remove(),j=k.append("g").attr("transform","translate("+c.margin.left+","+c.margin.top+")").attr("class","paper"),l()},b.current=function(){return j},b.root=function(){return j=k.select("g.paper"),b},b.parent=function(){var c=j.node().parentNode;return c!==k.node()&&(j=a.select(c)),b},b.on=function(a,c){return m[a]?m.on(a,function(a){c.call(a,this)}):j.on(a,function(a){c.call(this,a)}),b},b.data=function(a){return yb.isFunction(a.data)?a.data():a.__data__},b.group=function(a){return j=j.append("g"),a&&j.attr(a),j},b.circle=function(a,c,d){return a=b.scalex(a),c=b.scaley(c),d=b.scale(d),j.append("circle").attr("cx",a).attr("cy",c).attr("r",d)},b.rect=function(a,c,d,e,f){var g=b.scalex(a),h=b.scaley(c);d=b.scalex(a+d)-g,e=b.scalex(c+e)-h;var i=j.append("rect").attr("x",g).attr("y",h).attr("width",d).attr("height",e);if(f){{var k=b.scalex(f)-b.scalex(0);b.scaley(f)-b.scaley(0)}i.attr("rx",k).attr("ry",rt)}return i},b.path=function(d,e){e||(e={}),d=d.slice(),M(b,Ab(c.line,e));var g=j,h=b.scalex,i=b.scaley,k=I(b,e,{}).reset();return d.paper=k,k.draw=function(a){return a.attr("stroke",k.color).attr("stroke-opacity",k.colorOpacity).attr("stroke-width",k.lineWidth)},b.addComponent(k,function(){var b=g.select("path.line"),c=e.area?a.svg.area():a.svg.line();c.interpolate(e.interpolate).x(function(a){return h(a.x)}).y(function(a){return i(a.y)}),b.node()||(b=g.append("path").attr("class","line")),k.draw(b.classed("area",e.area).datum(d).attr("d",c)),f(b)})},b.points=function(d,g){function h(a){return e(a).attr("d",n)}g||(g={}),d=d.slice(),M(b,Ab(c.point,g));for(var i,k=b.scale(b.dim(g.size)),l=b.scalex,m=b.scaley,n=a.svg.symbol().type(function(a){return a.symbol}).size(function(a){return a.size()}),o=j,p=0;p<d.length;p++)i=I(b,g,{values:d[p]}),i.set("size",k),i.draw=h,d[p]=i.reset();return b.addComponent(d,function(){var a=o.select("g.points");a.node()||(a=o.append("g").attr("class","points")),a.selectAll("path.point").remove(),f(h(a.selectAll("path.point").data(d).enter().append("path").attr("class","point").attr("transform",function(a){return"translate("+l(a.values.x)+","+m(a.values.y)+")"})))})},b.barchart=function(a,d){function g(a){return e(a).attr("width",function(a){return a.size()})}d||(d={}),a=a.slice(),M(b,Ab(c.bar,d));for(var h,i=O(b,a,d),k=b.scalex,l=b.scaley,m=j,n=0;n<a.length;n++)h=I(b,d,{values:a[n]}),h.set("size",i),h.draw=g,a[n]=h.reset();return b.addComponent(a,function(){var b,c=l(0),e=m.select("g.barchart");e.node()||(e=m.append("g").attr("class","barchart")),b=g(e.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",function(a){return k(a.values.x)-.5*a.size()}).attr("y",function(a){return a.values.y<0?c:l(a.values.y)}).attr("height",function(a){return a.values.y<0?l(a.values.y)-c:c-l(a.values.y)})),d.radius>0&&b.attr("rx",d.radius).attr("ry",d.radius),f(b)})},b.pie=function(d,g){g||(g={}),d=d.slice(),Ab(c.pie,g);
for(var h,i,k=j,l=0;l<d.length;l++)h=J(b,g,d[l]),h.draw=e,d[l]=h.reset();return b.addComponent(d,function(){var c=(b.scalex,b.scaley,b.innerWidth()),j=b.innerHeight(),m=.5*Math.min(c,j),n=g.innerRadius*m,o=b.scale(b.dim(g.cornerRadius)),p=k.select("g.pie"),q=a.layout.pie().value(function(a){return a.value}).padAngle(Rb*g.padAngle)(d),r=a.svg.arc().cornerRadius(o).innerRadius(n).outerRadius(m);for(l=0;l<q.length;l++)h=q[l],i=h.data,delete h.data,zb(i,h),i.draw=e,q[l]=i;p.node()||(p=k.append("g").attr("class","pie").attr("transform","translate("+c/2+","+j/2+")")),p.selectAll(".slice").remove(),f(e(p.selectAll(".slice").data(q).enter().append("path").attr("class","slice").attr("d",r)))})},b.setBackground=function(a,c){return yb.isObject(c)&&(void 0!==c.opacity&&a.attr("fill-opacity",c.opacity),c=c.color),yb.isString(c)&&a.attr("fill",c),b},b.gradient=function(b,c,d){var e=a.select("body").append("svg"),f=e.append("linearGradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","100%").attr("id",b).attr("gradientUnits","userSpaceOnUse");f.append("stop").attr("offset","0").attr("stop-color",c),f.append("stop").attr("offset","0.5").attr("stop-color",d)},b.encode=function(){return btoa(unescape(encodeURIComponent(k.attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML)))},b.image=function(){return"data:image/svg+xml;charset=utf-8;base64,"+b.encode()},b.downloadSVG=function(c){var d=b.image(),e=c?c.target:document;a.select(e).attr("href",d)},b.download=b.downloadSVG,b.addComponent=function(a,b){a=K(a,b);var c=++i;return g.push(a),h[c]=a,a.cid=c,a},b.removeComponent=function(a){if(a){var b=h[a];if(b){delete h[a];var c=g.indexOf(b);if(c>-1)return g.splice(c,1)[0]}}},c._axis=function(a,c,e,f,g){var h=b.root().current().select("g."+c);h.node()||(h=b.current().append("g").attr("class","axis "+c),b.addComponent(I(b,g,a),function(){var b=e?e():0,c=f?f():0;h.attr("transform","translate("+b+","+c+")").call(a),h.selectAll("line, path").attr("stroke",g.color).attr("stroke-width",g.lineWidth),d(h.selectAll("text"),g)}))}}),rb.viz={},rb.vizplugins=[],rb.vizplugin=function(a){rb.vizplugins.push(a)},rb.createviz=function(b,c,d){var e=[],f=function(b,c){Db(b)&&(c=b,b=null),c=zb({},f.defaults,c);var g,h={},i=a.dispatch.apply(a,c.events),j=0,k=!1;for(c.event=i,h.vizType=function(){return f},h.vizName=function(){return f.vizName()},h.paper=function(a){return(a||void 0===g)&&(g&&g.destroy(),g=rb.paper(b,c)),g},h.element=function(){return h.paper().element()},h.clear=function(){return h.paper().clear(),h},h.alpha=function(b){return arguments.length?(b=+b,j?j=b>0?b:0:b>0&&(i.start({type:"start",alpha:j=b}),a.timer(h.tick)),h):j},h.resume=function(){return h.alpha(.1)},h.stop=function(){return h.alpha(0)},h.tick=function(){return c.scope&&c.scope.stats&&c.scope.stats.begin(),(j*=.99)<.005?(i.end({type:"end",alpha:j=0}),!0):(i.tick({type:"tick",alpha:j}),void(c.scope&&c.scope.stats&&c.scope.stats.end()))},h.start=function(){return h.resume()},h.render=function(){return g.render(),h},h.loadData=function(b){return c.src&&!k?(k=!0,rb.log.info("Giotto loading data from "+c.src),a.json(c.src,function(a,c){k=!1,a||h.setData(c,b)})):void 0},h.setData=function(a,b){c.processData&&(a=c.processData(a)),Object(a)===a&&a.data?zb(c,a):c.data=a,b&&b()},h.options=function(){return c},h.image=function(){return g.image()},h.xyfunction=rb.math.xyfunction,a.rebind(h,i,"on"),d&&d(h,c),l=0;l<rb.vizplugins.length;++l)rb.vizplugins[l](h,c);for(var l=0;l<e.length;++l)e[l](h,c);if(c.onInit){var m=Hb(c.onInit);Eb(m)?m(h,c):rb.log.error("Could not locate onInit function "+c.onInit)}return h};return rb.viz[b]=f,f.defaults=zb({},rb.defaults.viz,rb.defaults.paper,c),f.vizName=function(){return b},f.plugin=function(a){e.push(a)},f};var Yb={circle:.7,cross:.7,diamond:.7,"triangle-up":.6,"triangle-down":.6},Zb=["fill","color","fillOpacity","colorOpacity","lineWidth","size","symbol"],$b=["lineWidth","size"];a.canvas.arc=function(){function a(){var d=Math.max(0,+c.apply(a,arguments)),e=Math.max(0,+f.apply(a,arguments)),l=i.apply(a,arguments)-Qb,m=j.apply(a,arguments)-Qb,n=Math.abs(m-l),o=l>m?0:1;if(d>e&&(p=e,e=d,d=p),b.beginPath(),n>=Pb)return b.arc(0,0,e,0,Ob,!1),d&&b.arc(0,0,d,0,Ob,!0),void b.closePath();var p,s,t,u,v,w,z=(+k.apply(a,arguments)||0)/2,A=0,B=0,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null;if(z&&(t=h===vb?Math.sqrt(d*d+e*e):+h.apply(a,arguments),o||(B*=-1),e&&(B=r(t/e*Math.sin(z))),d&&(A=r(t/d*Math.sin(z)))),e){if(C=e*Math.cos(l+B),D=e*Math.sin(l+B),E=e*Math.cos(m-B),F=e*Math.sin(m-B),w=Math.abs(m-l-2*B)<=Nb?0:1,B&&x(C,D,E,F)===o^w){var K=(l+m)/2;C=e*Math.cos(K),D=e*Math.sin(K),E=F=null}}else C=D=0;if(d){if(G=d*Math.cos(m-A),H=d*Math.sin(m-A),I=d*Math.cos(l+A),J=d*Math.sin(l+A),v=Math.abs(l-m+2*A)<=Nb?0:1,A&&x(G,H,I,J)===1-o^v){var L=(l+m)/2;G=d*Math.cos(L),H=d*Math.sin(L),I=J=null}}else G=H=0;if((p=Math.min(Math.abs(e-d)/2,+g.apply(a,arguments)))>.001){s=e>d^o?0:1;var M=null===I?[G,H]:null===E?[C,D]:q([C,D],[I,J],[E,F],[G,H]),N=C-M[0],O=D-M[1],P=E-M[0],Q=F-M[1],R=1/Math.sin(Math.acos((N*P+O*Q)/(Math.sqrt(N*N+O*O)*Math.sqrt(P*P+Q*Q)))/2),S=Math.sqrt(M[0]*M[0]+M[1]*M[1]);if(null!==E){var T=Math.min(p,(e-S)/(R+1)),U=y(null===I?[G,H]:[I,J],[C,D],e,T,o),V=y([E,F],[G,H],e,T,o);p===T?(u=1-o^x(U[1][0],U[1][1],V[1][0],V[1][1]),_b(b,U[0],U[1],T,0,s),_b(b,U[1],V[1],e,u,o),_b(b,V[1],V[0],T,0,s)):_b(b,U[0],V[0],T,1,s)}else b.moveTo(C,D);if(null!==I){var W=Math.min(p,(d-S)/(R-1)),X=y([C,D],[I,J],d,-W,o),Y=y([G,H],null===E?[C,D]:[E,F],d,-W,o);b.lineTo(Y[0][0],Y[0][1]),p===W?(u=o^x(Y[1][0],Y[1][1],X[1][0],X[1][1]),b.lineTo(Y[0][0],Y[0][1]),_b(b,Y[0],Y[1],W,0,s),_b(b,Y[1],X[1],d,u,1-o),_b(b,X[1],X[0],W,0,s)):_b(b,Y[0],X[0],W,0,s)}else b.lineTo(G,H)}else null!==E&&_b(b,[C,D],[E,F],e,w,o),b.lineTo(G,H),null!==I&&_b(b,[G,H],[I,J],d,v,1-o);b.closePath()}var b,c=s,f=t,g=d,h=vb,i=u,j=v,k=w;return a.context=function(c){return arguments.length?(b=c,a):b},a.innerRadius=function(b){return arguments.length?(c=e(b),a):c},a.outerRadius=function(b){return arguments.length?(f=e(b),a):f},a.cornerRadius=function(b){return arguments.length?(g=e(b),a):g},a.padRadius=function(b){return arguments.length?(h=b==vb?vb:e(b),a):h},a.startAngle=function(b){return arguments.length?(i=e(b),a):i},a.endAngle=function(b){return arguments.length?(j=e(b),a):j},a.padAngle=function(b){return arguments.length?(k=e(b),a):k},a.centroid=function(){var b=(+c.apply(a,arguments)+f.apply(a,arguments))/2,d=(+i.apply(a,arguments)+j.apply(a,arguments))/2-Qb;return[Math.cos(d)*b,Math.sin(d)*b]},a};var _b=a.canvas.drawArc=function(a,b,c,d,e,f){var g=b[0]-c[0],h=b[1]-c[1],i=g*g+h*h,j=Math.sqrt(i),k=.5*(b[0]+c[0]),l=.5*(b[1]+c[1]),m=Math.sqrt(d*d-.25*i);f>0?(k+=m*h/j,l-=m*g/j):(k-=m*h/j,l+=m*g/j);var n=Math.atan2(b[1]-l,b[0]-k),o=Math.atan2(c[1]-l,c[0]-k);a.arc(k,l,d,n,o,0>=f)};a.canvas.axis=function(){function b(a){a.each(function(){var a,b=this.getContext("2d"),m=(this.__chart__||d,this.__chart__=d.copy()),n=null===k?m.ticks?m.ticks.apply(m,j):m.domain():k,o=null===l?m.tickFormat?m.tickFormat.apply(m,j):c:l,p=Math.max(f,0)+i,q="top"===e||"left"===e?-1:1,r=g(m);"bottom"===e||"top"===e?(b.textBaseline=0>q?"bottom":"top",b.textAlign="center",b.moveTo(r[0],0),b.lineTo(r[1],0),b.moveTo(r[0],0),b.lineTo(r[0],q*h),b.moveTo(r[1],0),b.lineTo(r[1],q*h),n.forEach(function(c){a=m(c),b.moveTo(a,0),b.lineTo(a,q*f),b.fillText(o(c),a,q*p)})):(b.textBaseline="middle",b.textAlign=0>q?"end":"start",b.moveTo(0,r[0]),b.lineTo(0,r[1]),b.moveTo(0,r[0]),b.lineTo(q*h,r[0]),b.moveTo(0,r[1]),b.lineTo(q*h,r[1]),n.forEach(function(c){a=m(c),b.moveTo(0,a),b.lineTo(q*f,a),b.fillText(o(c),q*p,a)}))})}var d=a.scale.linear(),e=ac,f=6,h=6,i=3,j=[10],k=null,l=null;return b.scale=function(a){return arguments.length?(d=a,b):d},b.orient=function(a){return arguments.length?(e=a in bc?a+"":ac,b):e},b.ticks=function(){return arguments.length?(j=arguments,b):j},b.tickValues=function(a){return arguments.length?(k=a,b):k},b.tickFormat=function(a){return arguments.length?(l=a,b):l},b.tickSize=function(a){var c=arguments.length;return c?(f=+a,h=+arguments[c-1],b):f},b.innerTickSize=function(a){return arguments.length?(f=+a,b):f},b.outerTickSize=function(a){return arguments.length?(h=+a,b):h},b.tickPadding=function(a){return arguments.length?(i=+a,b):i},b.tickSubdivide=function(){return arguments.length&&b},b};var ac="bottom",bc={top:1,right:1,bottom:1,left:1};a.canvas.retinaScale=function(a,b,c){return a.canvas.width=b,a.canvas.height=c,window.devicePixelRatio&&(a.canvas.style.width=b+"px",a.canvas.style.height=c+"px",a.canvas.width=b*window.devicePixelRatio,a.canvas.height=c*window.devicePixelRatio,a.scale(window.devicePixelRatio,window.devicePixelRatio)),window.devicePixelRatio||1},a.canvas.line=function(){return Q(c)};var cc=a.map({linear:R,"linear-closed":S,step:T,"step-before":U,"step-after":V,basis:W,"basis-open":X,"basis-closed":Y,bundle:Z,cardinal:$,"cardinal-open":_,"cardinal-closed":ab,monotone:bb});a.canvas.symbol=function(){function b(a,d){return(dc.get(f.call(b,a,d))||eb)(c,g.call(b,a,d))}var c,d=a.svg.symbol(),f=d.type(),g=d.size();return b.type=function(a){return arguments.length?(f=e(a),b):f},b.size=function(a){return arguments.length?(g=e(a),b):g},b.context=function(a){return arguments.length?(c=a,b):c},b};var dc=a.map({circle:eb,cross:function(a,b){var c=Math.sqrt(b/5)/2,d=3*c;a.beginPath(),a.moveTo(-d,-c),a.lineTo(-c,-c),a.lineTo(-c,-d),a.lineTo(c,-d),a.lineTo(c,-c),a.lineTo(d,-c),a.lineTo(d,c),a.lineTo(c,c),a.lineTo(c,d),a.lineTo(-c,d),a.lineTo(-c,c),a.lineTo(-d,c),a.closePath()},diamond:function(a,b){var c=Math.sqrt(b/(2*fc)),d=c*fc;a.beginPath(),a.moveTo(0,-c),a.lineTo(d,0),a.lineTo(0,c),a.lineTo(-d,0),a.closePath()},square:function(a,b){var c=Math.sqrt(b);a.beginPath(),a.rect(-.5*c,-.5*c,c,c),a.closePath()},"triangle-down":function(a,b){var c=Math.sqrt(b/ec),d=c*ec/2;a.beginPath(),a.moveTo(0,d),a.lineTo(c,-d),a.lineTo(-c,-d),a.closePath()},"triangle-up":function(a,b){var c=Math.sqrt(b/ec),d=c*ec/2;a.beginPath(),a.moveTo(0,-d),a.lineTo(c,d),a.lineTo(-c,d),a.closePath()}});a.canvas.symbolTypes=dc.keys();var ec=Math.sqrt(3),fc=Math.tan(30*Rb);a.canvas.transition=function(b,c){var d=a.transition(b,c);return d},rb.paper.addType("canvas",function(b,c){function d(){j=[],k={},l=0,o=null,p.selectAll("*").remove()}function e(){o=++l;var a=p.append("canvas").attr("class","giotto").attr("id","giottoCanvas-"+b.uid()+"-"+o),c=a.node(),d=i(c.getContext("2d"));d.__cid__=o;var e={cid:o,canvas:c,callbacks:[],data:[]};return j.length&&a.style({position:"absolute",top:"0",left:"0"}),j.push(o),k[o]=e,a}function f(a){h(a,c.size),a.translate(n*c.margin.left,n*c.margin.top),k[o].callbacks.forEach(function(b){b(a)})}function g(a,c){var d,e,f=o;return c?(e=b.get(c),e&&(o=e.cid,d=a(e.canvas.getContext("2d"),e.canvas,e))):j.forEach(function(b){o=b,e=k[o],a(e.canvas.getContext("2d"),e.canvas,e)}),o=f,d}function h(a,b){return a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,n*b[0],n*b[1]),a}function i(d){return n=a.canvas.retinaScale(d,c.size[0],c.size[1]),b.resetAxis(),d}var j,k,l,m=b.clear,n=1,o=null,p=b.element().append("div").attr("class","canvas-container").style("position","relative");b.container=function(){return p},b.destroy=function(){return d(),b},b.refresh=function(a){if(a){var d=c.size;c.size=a,g(function(a){h(a,d),i(a)})}return b.render(),b},b.width=function(){return n*c.size[0]},b.height=function(){return n*c.size[1]},b.innerWidth=function(){return n*(c.size[0]-c.margin.left-c.margin.right)},b.innerHeight=function(){return n*(c.size[1]-c.margin.top-c.margin.bottom)},b.factor=function(a){return arguments.length?(n=+a,b):n},b.each=function(a){return g(a),b},b.render=function(a){return arguments.length?g(f,a):g(f),b},b.clear=function(a){return a?(h(a,c.size),b):(d(),e(),m())},b.group=function(a){var c=e();return a&&c.attr(a),b.render(o),b.current()},b.on=function(a,c){return p.on(a,function(){c.call(this)}),b},b.current=function(){return null!==o?k[o].canvas.getContext("2d"):null},b.root=function(){return j&&(o=j[0]),b},b.parent=function(){var a=j.indexOf(o);return o=Math.max(0,a-1),b},b.get=function(a){return a&&(a.node&&(a=a.node()),a&&a.getContext&&(a=a.getContext("2d")),a)?k[a.__cid__?a.__cid__:a]:void 0},b.xfromPX=function(a){return c.xAxis.scale().invert(n*a)},b.yfromPX=function(a){return b.yAxis().scale().invert(n*a)},b.circle=function(a,c,d){var e=b.current();e.beginPath(),a=b.scalex(a),c=b.scaley(c),d=b.scale(d),e.arc(a,c,d,0,2*Math.PI,!1),e.endPath()},b.getDataAtPoint=function(a){var b,c=n*a[0],d=n*a[1],e=[];return g(function(a,f,g){g.callbacks.forEach(function(f){b=f.data(),b.forEach(function(b){b.context(a).inRange(c,d)&&e.push(b)})})}),e},b.path=function(a,d){d||(d={}),a=a.slice(),M(b,Ab(c.line,d));var e=hb(b,d,a);return b.addComponent(e,function(a){e.context(a).draw()})},b.points=function(d,e){e||(e={}),d=d.slice(),M(b,Ab(c.point,e));for(var f=a.canvas.symbol().type(function(a){return a.symbol}).size(function(a){return a.size()}),g=0;g<d.length;++g)d[g]=ib(b,e,d[g],f);return b.addComponent(d,function(a){for(var c=b.scale(b.dim(e.size)),f=0;f<d.length;++f)d[f].context(a).size(c).draw()})},b.barchart=function(a,d){d||(d={}),a=a.slice(),M(b,Ab(c.bar,d));for(var e=0;e<a.length;e++)a[e]=jb(b,d,a[e]);return b.addComponent(a,function(c){for(var e=O(b,a,d),f=0;f<a.length;f++)a[f].context(c).size(e).draw()})},b.pie=function(d,e){e||(e={}),d=d.slice(),Ab(c.pie,e);for(var f=a.canvas.arc(),g=0;g<d.length;g++)d[g]=kb(b,e,d[g],f);return b.addComponent(d,function(c){var h,i,j=b.innerWidth(),k=b.innerHeight(),l=.5*Math.min(j,k),m=e.innerRadius*l,n=b.scale(b.dim(e.cornerRadius)),o=a.layout.pie().value(function(a){return a.value}).padAngle(Rb*e.padAngle)(d);for(f=f.cornerRadius(n).innerRadius(m).outerRadius(l).context(c),g=0;g<o.length;++g)h=o[g],i=h.data,delete h.data,zb(i,h),i.context(c).draw()})},b.removeCanvas=function(c){if(c=b.get(c)){delete k[c.cid];var d=j.indexOf(c.cid);return d>-1&&j.splice(d,1)[0],a.select(c.canvas).remove(),c.canvas}},b.addComponent=function(a,b){return a=K(a,b),k[o].callbacks.push(a),a.cid=o,a},b.image=function(){var a,d=e().node(),f=b.current();g(function(b){b!==f&&(a=new Image,a.src=b.canvas.toDataURL(),f.drawImage(a,0,0,c.size[0],c.size[1]))});var h=d.toDataURL();return b.removeCanvas(d),h},c._axis=function(a,c,d,f,h){var i=(h.font,gb(b,h,a,d,f)),j=p.select(".axis").node();return j||(j=e().classed("axis",!0)),g(function(){return b.addComponent(i,function(a){i.context(a).draw()})},j)}}),rb.createviz("chart",{margin:{top:30,right:30,bottom:30,left:30},chartTypes:["pie","bar","line","point"]},function(a,b){function c(a,b){return a?void 0===a.show?void 0===b?!0:b:a.show:!1}function d(c){if(c){Fb(c)&&(c={data:c});var d,e,f,h=a.paper();return g.push(c),c.label||(c.label="serie "+g.length),b.chartTypes.forEach(function(a){f=c[a],f&&(Fb(f)&&(c.data=f),f={}),(f||b[a].show)&&(f||(f={}),zb(f,b[a]),c[a]=f,e=!0)}),e||(c.line=zb({},b.line)),b.chartTypes.forEach(function(a){f=c[a],f&&"pie"!==a&&!f.color&&(d||(d=h.pickColor()),f.color=d)}),c}}function e(c){var d=a.paper();d.group({"class":"serie "+Jb(c.label)}),b.chartTypes.forEach(function(b){c[b]&&(c[b]=gc[b](a,c.data,c[b]))}),d.parent()}var f,g=[];a.numSeries=function(){return g.length},a.each=function(b){return g.forEach(b),a},a.forEach=a.each,a.addSeries=function(b){var c,e=[];return b.forEach(function(b){Eb(b)&&(b=b(a)),b=d(b),b&&(b.pie||(b=hc(b),void 0===b.yaxis&&(b.yaxis=1),f||(f=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]]),c=f[0],c[0]=Math.min(c[0],b.xrange[0]),c[1]=Math.max(c[1],b.xrange[1]),c=f[b.yaxis],c[0]=Math.min(c[0],b.yrange[0]),c[1]=Math.max(c[1],b.yrange[1])),e.push(b))}),e},a.addSerie=function(b){return a.addSeries([b])},a.clear=function(){return a.paper().clear(),g=[],a},a.draw=function(){var d=a.paper(),h=b.data;if(h){if(delete b.data,void 0===h&&b.src)return a.loadData(a.draw);rb._.isFunction(h)&&(h=h(a))}h&&(h=a.addSeries(h)),(h||b.type!==d.type())&&(b.type!==d.type()&&(d=a.paper(!0),h=g),f&&d.allAxis().forEach(function(a,b){var c=a.o,d=f[b],e=a.axis.scale();c.auto?(e.domain([d[0],d[1]]).nice(),Gb(c.min)?Gb(c.max)||e.domain([e.domain()[0],c.max]):e.domain([c.min,e.domain()[1]])):e.domain([c.min,c.max])}),h.forEach(function(a){e(a)}),h.length===g.length&&f&&(c(b.xaxis)&&d.drawXaxis(),c(b.yaxis)&&d.drawYaxis(),c(b.yaxis2,!1)&&d.drawYaxis())),a.render()},a.setSerieOption=function(c,d,e){-1!==b.chartTypes.indexOf(c)&&(a.numSeries()?a.each(function(a){a[c]&&a[c].setOptions(d,e)}):b[c][d]=e)},a.on("tick.main",function(){a.stop(),a.draw()})});var gc={pie:function(a,b,c){return a.paper().pie(b,c)},bar:function(a,b,c){return a.paper().barchart(b,c)},line:function(a,b,c){return a.paper().path(b,c)},point:function(a,b,c){return a.paper().points(b,c)}},hc=function(a){if(a){a.data||(a={data:a});var b=a.data,c=1/0,d=1/0,e=-1/0,f=-1/0,g=function(a){return c=c>a?a:c,e=a>e?a:e,a},h=function(a){return d=d>a?a:d,f=a>f?a:f,a},i=[];if(Fb(b[0])&&2===b[0].length)b.forEach(function(a){i.push({x:g(a[0]),y:h(a[1])})});else{var j=a.xlabel||"x",k=a.ylabel||"y";b.forEach(function(a){i.push({x:g(a[j]),y:h(a[k])})})}return a.data=i,a.xrange=[c,e],a.yrange=[d,f],a}};rb.createviz("force",{theta:.8,friction:.9},function(a,b){function c(b){var c=a.paper();return b.weight=0,isNaN(b.x)&&(b.x=c.x(Math.random())),isNaN(b.y)&&(b.y=c.y(Math.random())),b}var d,e,f,g,h,i=[],j=[];a.nodes=function(b){if(!arguments.length)return i;for(d=null,i=b,g=0;g<i.length;++g)c(i[g]).index=g;return a},a.addNode=function(b){return b.index=i.length,i.push(c(b)),a},a.theta=function(c){return arguments.length?(b.theta=c,a):+b.theta},a.friction=function(c){return arguments.length?(b.friction=c,a):+b.friction},a.quadtree=function(b){return(!f||b)&&(f=a.paper().quadtree()(i)),f},a.addForce=function(a){j.push(a)},a.drawPoints=function(){var b=a.paper().options().colors,c=0;for(g=0;g<i.length;g++)i[g].fill||(i[g].fill=b[c%b.length],c++);return a.paper().points(i)},a.drawQuadTree=function(b){return a.paper().drawQuadTree(a.quadtree,b)},a.on("tick.main",function(){for(f=null,g=-1;++g<i.length;)h=i[g],h.px=h.x,h.py=h.y;for(g=0;g<j.length;++g)j[g]();for(e=a.friction(),g=-1;++g<i.length;)h=i[g],h.fixed?(h.x=h.px,h.y=h.py):(h.x-=(h.px-h.x)*e,h.y-=(h.py-h.y)*e)})}),rb.viz.force.plugin(function(a,b){function c(){var c=b.linkDistance,h=b.linkStrength,i=a.nodes();if(d=[],e=[],n.length){for(f=0;f<n.length;++f)g=n[f],"number"==typeof g.source&&(g.source=i[g.source]),"number"==typeof g.target&&(g.target=i[g.target]),++g.source.weight,++g.target.weight;if("function"==typeof c)for(f=0;f<n.length;++f)d[f]=+c.call(a,n[f],f);else for(f=0;f<n.length;++f)d[f]=c;if("function"==typeof h)for(f=0;f<n.length;++f)e[f]=+h.call(a,n[f],f);else for(f=0;f<n.length;++f)e[f]=h}}var d,e,f,g,h,i,j,l,m,n=[];rb._.copyMissing({linkStrength:1,linkDistance:20},b),a.linkStrength=function(c){return arguments.length?(b.linkStrength="function"==typeof c?c:+c,a):b.linkStrength},a.linkDistance=function(c){return arguments.length?(b.linkDistance="function"==typeof c?c:+c,a):b.linkDistance},a.addForce(function(){for(d||c(),f=0;f<n.length;++f)g=n[f],h=g.source,i=g.target,j=i.x-h.x,l=i.y-h.y,m=j*j+l*l,m&&(m=b.alpha*e[f]*((m=Math.sqrt(m))-d[f])/m,j*=m,l*=m,i.x-=j*(k=h.weight/(i.weight+h.weight)),i.y-=l*k,h.x+=j*(k=1-k),h.y+=l*k)})}),rb.viz.force.plugin(function(a,b){var c,d,e,f;void 0===b.gravity&&(b.gravity=.05),a.gravity=function(c){return arguments.length?(b.gravity=c,a):+b.gravity},a.addForce(function(){d=a.alpha()*b.gravity,f=a.nodes();var g=a.paper().x(.5),h=a.paper().y(.5);for(c=0;c<f.length;++c)e=f[c],e.fixed||(e.x+=(g-e.x)*d,e.y+=(h-e.y)*d)})}),rb.viz.force.plugin(function(a,b){function c(){if(a.chargeDistance(b.chargeDistance),g=a.charge(),h=a.nodes(),f=[],"function"==typeof g)for(j=0;j<h.length;++j)f[j]=+g.call(a,h[j],j);else for(j=0;j<h.length;++j)f[j]=g}function d(b){var c=a.theta(),d=c*c;return function(a,c,e,f){if(a.point!==b&&a.charge){var g=a.cx-b.x,h=a.cy-b.y,i=f-c,j=g*g+h*h;if(j>i*i/d)return m>j&&(k=a.charge/j,b.px-=g*k,b.py-=h*k),!0;a.point&&j&&m>j&&(k=a.pointCharge/j,b.px-=g*k,b.py-=h*k)}return!a.charge}}function e(b,c,d){var f=0,g=0;if(b.charge=0,!b.leaf)for(var h,i=b.nodes,j=i.length,k=-1;++k<j;)h=i[k],h&&(e(h,c,d),b.charge+=h.charge,f+=h.charge*h.cx,g+=h.charge*h.cy);if(b.point){if(!b.leaf){var l=a.paper();b.point.x+=l.x(Math.random())-l.x(.5),b.point.y+=l.y(Math.random())-l.y(.5)}var m=c*d[b.point.index];b.charge+=b.pointCharge=m,f+=m*b.point.x,g+=m*b.point.y}b.cx=b.charge?f/b.charge:0,b.cy=b.charge?g/b.charge:0}{var f,g,h,i,j,k,l,m;a.paper()}rb._.copyMissing({charge:-30,chargeDistance:1/0},b),a.charge=function(d){return arguments.length?(b.charge=d,f&&c(),a):"function"==typeof b.charge?b.charge:+b.charge},a.chargeDistance=function(c){return arguments.length?(b.chargeDistance2=+c,m=c*c,a):+b.chargeDistance},a.addForce(function(){if(h=a.nodes(),g=a.charge(),g&&h.length)for(f||c(),e(i=a.quadtree(),a.alpha(),f),j=-1;++j<h.length;)l=h[j],l.fixed||i.visit(d(l))})}),rb.createviz("map",{tile:null,center:[41.898582,12.476801],zoom:4,maxZoom:18,zoomControl:!0,wheelZoom:!0},function(a,b){a.start=function(){},a.innerMap=function(){},a.addLayer=function(){},b.tile&&rb.viz.map.tileProviders[b.tile](a,b)}).tileProviders={},rb.viz.map.tileProviders.leaflet=function(b,c){function d(a,b){var c=e.latLngToLayerPoint(new L.LatLng(b,a));this.stream.point(c.x,c.y)}var e,f=[];b.start=function(){"undefined"==typeof L?(rb._.loadCss(rb.constants.leaflet),rb.require(["leaflet"],function(){b.start()})):(e=new L.map(b.element().node(),{center:c.center,zoom:c.zoom}),c.zoomControl?c.wheelZoom||e.scrollWheelZoom.disable():(e.dragging.disable(),e.touchZoom.disable(),e.doubleClickZoom.disable(),e.scrollWheelZoom.disable(),e.tap&&e.tap.disable()),e.on("viewreset",function(){for(var a=0;a<f.length;++a)f[a]()}),b.resume())},b.innerMap=function(){return e},b.addLayer=function(a,b){e&&L.tileLayer(a,b).addTo(e)},b.addOverlay=function(b,c){var g=a.geo.transform({point:d}),h=a.geo.path().projection(g),i=e?a.select(e.getPanes().overlayPane).append("svg"):null,j=i?i.append("g").attr("class","leaflet-zoom-hide"):null,k=function(){var a=h.bounds(b),d=a[0],e=a[1];i.attr("width",e[0]-d[0]).attr("height",e[1]-d[1]).style("left",d[0]+"px").style("top",d[1]+"px"),j.attr("transform","translate("+-d[0]+","+-d[1]+")"),c&&c(h)};return f.push(k),{element:j,collection:b,path:h,draw:k}}},rb.createviz("sunburst",{labels:!0,addorder:!1,transition:750,scale:"sqrt",initNode:null},function(b,c){function d(){var a=Math.min(u.innerWidth(),u.innerHeight());return 400>a?Math.round(100-.15*(500-a)):100}function e(c){function d(a){return a.x>=c.x&&a.x<c.x+c.dx}if(c!==l){q&&q.transition().attr("opacity",0);var e=k(c);return s=c.depth,t.transition().duration(x).attrTween("d",e).each("end",function(a){c===a&&(b.current=a,b.fire("change"))}),q&&(r=[],p.transition().duration(x).attrTween("d",e).each("end",function(b){b.depth>=s&&d(b)&&j(a.select(this.parentNode).select("text").transition().duration(x).attr("opacity",1))})),!0}}function f(){var d=.5*u.innerWidth(),e=.5*u.innerHeight(),f=a.layout.partition().value(function(a){return a.size}).sort(function(a){return void 0===a.order?a.size:a.order}),i=u.group().attr("transform","translate("+d+","+e+")"),k=i.append("g").attr("class","sunburst");n=Math.min(d,e),m=g(n),s=0,l=c.data;m(0),m(n);if(t=k.selectAll("path").data(f.nodes(l)).enter().append("path").attr("d",z).style("fill",function(a){return w((a.children?a:a.parent).name)}),c.labels){var v=t.data();r=[],o=i.append("g").attr("class","text").selectAll("g").data(v).enter().append("g"),p=o.append("path").attr("d",z).attr("opacity",0).on("click",h),q=o.append("text").text(function(a){return void 0!==c.addorder&&void 0!==a.order?a.order+" - "+a.name:a.name}),j(q)}b.select(c.initNode)||c.event.change({type:"change",viz:b})}function g(b){return"linear"===c.scale?a.scale.linear().range([0,b]):a.scale.sqrt().range([0,b])}function h(d){function e(a){return a.x>=d.x&&a.x<d.x+d.dx}s!==d.depth&&(q&&q.transition().attr("opacity",0),s=d.depth,t.transition().duration(x).attrTween("d",k(d)).each("end",function(a){a.depth===s&&e(a)&&(b.current=a,c.event.change({type:"change",viz:b}))}),q&&(r=[],p.transition().duration(x).attrTween("d",k(d)).each("end",function(b){b.depth>=s&&e(b)&&j(a.select(this.parentNode).select("text").transition().duration(x).attr("opacity",1))})))}function i(a){function b(a){var b=c-a;b>=0&&e>b?(c+=e,d=!0):0>b&&b>-e&&(c-=e-b,d=!0)}for(var c=y(a.x+a.dx/2),d=!0,e=Math.PI/40;d;)d=!1,r.forEach(b);return r.push(c),c}function j(a){var b;return a.attr("x",function(a){return a.depth===s?0:(b=i(a),this.__data__.angle=b,b>Math.PI?-m(a.y):m(a.y))}).attr("dx",function(a){return a.depth===s?0:a.angle>Math.PI?-6:6}).attr("dy",function(a){return a.depth===s?a.depth?40:0:".35em"}).attr("transform",function(a){return b=0,a.depth>s&&(b=a.angle,b>Math.PI&&(b-=Math.PI),b-=Math.PI/2),"rotate("+b/Math.PI*180+")"}).attr("text-anchor",function(a){return b=a.angle,a.depth===s?"middle":b&&b>Math.PI?"end":"start"}).style("font-size",function(a){var b=a.depth-s,c=v;return b?b>0&&(c=Math.max(1.2*c-20*b,30)):c*=1.2,Math.round(c)+"%"})}function k(b){var c=a.interpolate(y.domain(),[b.x,b.x+b.dx]),d=a.interpolate(m.domain(),[b.y,1]),e=a.interpolate(m.range(),[b.y?20:0,n]);return function(a,b){return b?function(){return z(a)}:function(b){return y.domain(c(b)),m.domain(d(b)).range(e(b)),z(a)}}}var l,m,n,o,p,q,r,s,t,u=b.paper(),v=d(),w=a.scale.category20c(),x=+c.transition,y=a.scale.linear().range([0,2*Math.PI]),z=a.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,y(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,y(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,m(a.y))}).outerRadius(function(a){return Math.max(0,m(a.y+a.dy))});b.on("tick.main",function(){return c.data?(b.stop(),void f()):b.loadData()}),b.select=function(a){if(l){var b=c.data;if(a&&a.length)for(var d=0;d<a.length;++d){var f=a[d];if(!b.children)break;for(var g=0;g<=b.children.length;++g)if(b.children[g]&&b.children[g].name===f){b=b.children[g];break}}return e(b)}},b.scale=function(a){return arguments.length?(c.scale!==a&&(c.scale=a,b.resume()),b):c.scale}}),rb.createviz("trianglify",{bleed:150,fillOpacity:1,strokeOpacity:1,noiseIntensity:0,gradient:null,cellsize:0,cellpadding:0,x_gradient:null,y_gradient:null},function(a,b){function c(){var c=+b.cellsize,d=(+b.cellpadding,+b.fillOpacity),f=+b.strokeOpacity,g=+b.noiseIntensity,h=a.gradient(b.gradient),i=a.gradient(b.x_gradient)||h,j=a.gradient(b.y_gradient)||h,k=a.paper().clear(),l=k.element(),m=a.paper().size();l.selectAll("*").remove(),e||(e=new Trianglify),e.options.fillOpacity=Math.min(1,Math.max(d,0)),e.options.strokeOpacity=Math.min(1,Math.max(f,0)),e.options.noiseIntensity=Math.min(1,Math.max(g,0)),i&&(e.options.x_gradient=i),j&&(e.options.y_gradient=j),c>0&&(e.options.cellsize=c,e.options.bleed=+attrs.bleed);var n=e.generate(m[0],m[1]),o=l.select(".trianglify-background");if(!o.node()){for(var p=l.node(),q=document.createElement("div"),r=p.childNodes;r.length;)q.appendChild(r[0]);q.className="trianglify-background",p.appendChild(q),o=l.select(".trianglify-background")}o.style("min-height","100%").style("background-image",n.dataUrl)}var d,e;a.gradient=function(a){if(a&&"string"==typeof a){var b=a.split("-");if(2===b.length){var c=Trianglify.colorbrewer[b[0]],d=+b[1];if(c)return c[d]}}},a.on("tick.main",function(){if(void 0===a.Trianglify&&"undefined"==typeof Trianglify){if(!d)return d=!0,rb.require(["trianglify"],function(b){d=!1,a.Trianglify=b||null})}else void 0===a.Trianglify&&(a.Trianglify=Trianglify),c(),a.stop()})}),rb.paper.svg.plugin("brush",{axis:"x",opacity:.125,fill:"#000"},function(b,c){function d(){b.root().current().classed("selecting",!0),c.brush.start&&c.brush.start()}function e(){c.brush.move&&c.brush.move()}function f(){b.root().current().classed("selecting",!1),c.brush.end&&c.brush.end()}var g,h;b.brush=function(){return h},b.extent=function(a){return arguments.length?void(h&&(h.extent(a),b.render(g))):h?h.extent():null},b.addBrush=function(i){return g?b:(yb.isObject(i)&&zb(c.brush,i),h=a.svg.brush().on("brushstart",d).on("brush",e).on("brushend",f),g=b.addComponent(function(){if(h){var a=b.root().current(),g=a.select("g.brush");if("x"===c.brush.axis&&h.x(b.xAxis().scale()),g.node())g.call(h);else{c.brush.extent&&h.extent(c.brush.extent),g=a.append("g");var i=g.call(h).selectAll("rect").attr("fill",c.brush.fill).attr("fill-opacity",c.brush.opacity);"x"===c.brush.axis&&(g.attr("class","brush x-brush"),i.attr("y",-6).attr("height",b.innerHeight()+7))}d(),e(),f()}}),h)},b.removeBrush=function(){g=b.removeComponent(g),b.root().current().select("g.brush").remove(),h=null}}),rb.viz.chart.plugin(function(a,b){var c,d,e;b.brush&&(d=b.brush,yb.isObject(d)||(d={}),e=zb({},d),e.start=function(){d.start&&d.start(a)},e.move=function(){a.each(function(b){var c=a.paper().brush(),d=c.extent();b.point.chart&&b.point.chart.selectAll(".point").classed("selected",function(a){return d[0]<=a.x&&a.x<=d[1]}),b.bar.chart&&b.bar.chart.selectAll(".bar").classed("selected",function(a){return d[0]<=a.x&&a.x<=d[1]})}),d.move&&d.move(a)},e.end=function(){d.end&&d.end(a)}),a.dimension=function(b){return init(),arguments.length?(c=b,a):c},a.on("tick.brush",function(){e&&a.paper().addBrush(e)})}),rb.viz.force.plugin(function(b,c){function d(a,b){var c,d,e,f=a.radius+b,g=a.x-f,h=a.x+f,i=a.y-f,j=a.y+f;return function(b,k,l,m,n){return b.point&&b.point!==a&&(c=a.x-b.point.x,d=a.y-b.point.y,e=Math.sqrt(c*c+d*d),f=a.radius+b.point.radius,f>e&&(e=.5*(f-e)/e,c*=e,d*=e,a.fixed||b.point.fixed?a.fixed?(b.point.x-=2*c,b.point.y-=2*d):(a.x+=2*c,a.y+=2*d):(a.x+=c,a.y+=d,b.point.x-=c,b.point.y-=d))),k>h||g>m||l>j||i>n}}rb._.copyMissing({collidePadding:.002,collideBuffer:.02},c),b.collide=function(){for(var e,f=[],g=b.nodes(),h=b.paper(),i=h.scalex,j=h.scaley,k=h.xAxis().scale().invert,l=h.yAxis().scale().invert,m=h.scale,n=m(h.dim(c.collideBuffer)),o=h.dim(c.collidePadding),p=0;p<g.length;++p)e=g[p],e.radius&&f.push({x:i(e.x),y:j(e.y),index:e.index,radius:m(e.radius+o)});var q=a.geom.quadtree(f);for(p=0;p<f.length;++p)q.visit(d(f[p],n));for(p=0;p<f.length;++p)e=f[p],g[e.index].x=k(e.x),g[e.index].y=l(e.y)}});var ic={color:"#333",background:{color:"#c6dbef",opacity:.4},opacity:.3};rb.paper.svg.plugin("grid",ic,ob),rb.paper.canvas.plugin("grid",ic,ob),rb.viz.chart.plugin(function(a,b){b.grid=zb({show:!1},b.grid),a.showGrid=function(b){return a.paper().showGrid(b),a},a.hideGrid=function(){return a.paper().hideGrid(),a},a.on("tick.grid",function(){b.grid.show?a.showGrid():a.hideGrid()})}),rb.contextMenu=function(){function b(){!l&&k&&27===a.event.keyCode&&f()}function c(){var b=a.event;(!l&&k&&2!==b.button||b.target!==i)&&f()}function d(b){return function(){if(!l){var c=a.event;c.preventDefault(),c.stopPropagation(),f(),i=this,e(c,b)}}}function e(a,b){b&&b(j),j.classed("open",!0);var c=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0),d=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||0),e=j.node().scrollWidth,f=j.node().scrollHeight,g=document.clientWidth+c,h=document.clientHeight+d,i=e+a.pageX,l=f+a.pageY,m=Math.max(a.pageX-c,0),n=Math.max(a.pageY-d,0);i>g&&(m-=i-g),l>h&&(n-=l-h),j.style({top:n+"px",left:m+"px",position:"fixed"}),k=!0}function f(){j.classed("open",!1),k&&m.close(),k=!1}function g(){j||(j=a.select(document.createElement("div")).attr("class","giotto-menu"),f(),document.body.appendChild(j.node()),a.select(document).on("keyup.gmenu",b).on("click.gmenu",c).on("contextmenu.gmenu",c))}var h={},i=null,j=null,k=!1,l=!1,m=a.dispatch("open","close");return h.bind=function(a,e){g(),a.on("keyup.gmenu",b),a.on("click.gmenu",c),a.on("contextmenu.gmenu",d(e))},h.disabled=function(a){return arguments.length?(l=a?!0:!1,h):l},a.rebind(h,m,"on"),h},rb.contextmenu=rb.contextMenu(),rb.vizplugin(function(a,b){a.contextmenu=function(c){c.append("ul").attr("class","dropdown-menu").attr("role","menu").selectAll("li").data(b.contextmenu).enter().append("li").append("a").attr("role","menuitem").text(function(a){return a.label
}).attr("href","#").on("click",function(b){b.callback&&b.callback(a)})},b.contextmenu&&rb.contextmenu.bind(a.element(),function(b){return a.contextmenu(b)})});var jc={color:"#ccc",opacity:1,width:1,fill:"none",fillOpacity:.5};rb.paper.svg.plugin("quadtree",jc,function(b,c){function d(a,b){return 0>=a?0:a>=b?b:a}function e(a){var c=[],e=b.scalex,f=b.scaley,g=b.innerWidth(),h=b.innerHeight();return a.depth=0,a.visit(function(a,b,i,j,k){a.x1=d(e(b),g),a.y1=d(f(k),h),a.x2=d(e(j),g),a.y2=d(f(i),h),c.push(a);for(var l=0;4>l;l++)a.nodes[l]&&(a.nodes[l].depth=a.depth+1)}),c}b.quadtree=function(){return a.geom.quadtree},b.drawQuadTree=function(a,d){rb.extend(c.quadtree,d);var f=b.current(),g=c.quadtree;return b.addComponent(function(){var b=f.select("g.quadtree"),c=a();return b.node()?b.selectAll(".quad-node").remove():b=f.append("g").attr("class","quadtree").attr("stroke",g.color).attr("stroke-width",g.width).attr("stroke-opacity",g.opacity).attr("fill",g.fill).attr("fill-opacity",g.fillOpacity).style("shape-rendering","crispEdges"),b.selectAll(".quad-node").data(e(c)).enter().append("rect").attr("class","quad-node").attr("x",function(a){return a.x1}).attr("y",function(a){return a.y1}).attr("width",function(a){return a.x2-a.x1}).attr("height",function(a){return a.y2-a.y1}),{chart:b}})}}),rb.paper.canvas.plugin("quadtree",jc,function(b){b.quadtree=function(){return a.geom.quadtree}});var kc={className:"d3-tip",show:!0,fill:"#333",fillOpacity:.8,color:"#fff",padding:"5px",radius:"3px",template:function(a){return"<strong>"+a.label+":</strong><span>"+a.value+"</span>"}};rb.paper.svg.plugin("tooltip",kc,function(b,c){function d(a){return e&&e.reset().draw(a),e=null,f&&f.hide(),a}var e,f=pb(b,c.tooltip);b.tooltip=function(){return f},f&&f.html(function(){return c.tooltip.template(e)}),b.on("activein",function(){var b=a.select(this),c=this.__data__;yb.isArray(c)&&(c=c.paper),c!==e&&(d(b),e=c,e&&(e.highLight().draw(b),f&&f.bbox(H(this)).show()))}).on("activeout",function(){rb.log.info("active out"),d(a.select(this))})}),rb.paper.canvas.plugin("tooltip",kc,function(b,c){var d=pb(b,c.tooltip),e=[];b.tooltip=function(){return d},c.activeEvents.forEach(function(c){b.on(c+".tooltip",function(){var c,d=b.container().select(".interaction-overlay").node();d?d=d.getContext("2d"):(b.group({"class":"interaction-overlay"}),d=b.current(),b.parent());for(var f=0;f<e.length;++f)b.clear(d);if(e=[],"mouseout"!==a.event.type&&(c="mousemove"===a.event.type?a.mouse(this):a.touches(this)[0],e=b.getDataAtPoint(c),e.length))for(b.render(d),f=0;f<e.length;++f)e[f].highLight().draw(d)})})}),rb.tip=function(){function b(){return"n"}function c(){return[0,0]}function d(){return" "}function e(){return{top:n.n.y-r.offsetHeight,left:n.n.x-r.offsetWidth/2}}function f(){return{top:n.s.y,left:n.s.x-r.offsetWidth/2}}function g(){return{top:n.e.y-r.offsetHeight/2,left:n.e.x}}function h(){return{top:n.w.y-r.offsetHeight/2,left:n.w.x-r.offsetWidth}}function i(){return{top:n.nw.y-r.offsetHeight,left:n.nw.x-r.offsetWidth}}function j(){return{top:n.ne.y-r.offsetHeight,left:n.ne.x}}function k(){return{top:n.sw.y,left:n.sw.x-r.offsetWidth}}function l(){return{top:n.se.y,left:n.e.x}}function m(){var b=a.select(document.createElement("div"));return b.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),b.node()}var n,o=b,p=c,q=d,r=m(),s={};document.body.appendChild(r),s.show=function(){var b=Array.prototype.slice.call(arguments);b[b.length-1]instanceof SVGElement&&(target=b.pop());var c,d=q.apply(this,b),e=p.apply(this,b),f=o.apply(this,b),g=a.select(r),h=u.length,i=document.documentElement.scrollTop||document.body.scrollTop,j=document.documentElement.scrollLeft||document.body.scrollLeft;for(g.html(d).style({opacity:1,"pointer-events":"all"});h--;)g.classed(u[h],!1);return c=t.get(f).apply(this),g.classed(f,!0).style({top:c.top+e[0]+i+"px",left:c.left+e[1]+j+"px"}),s},s.hide=function(){return a.select(r).style({opacity:0,"pointer-events":"none"}),s},s.attr=function(b){if(arguments.length<2&&"string"==typeof b)return a.select(r).attr(b);var c=Array.prototype.slice.call(arguments);return a.selection.prototype.attr.apply(a.select(r),c),s},s.style=function(b){if(arguments.length<2&&"string"==typeof b)return a.select(r).style(b);var c=Array.prototype.slice.call(arguments);return a.selection.prototype.style.apply(a.select(r),c),s},s.bbox=function(a){return arguments.length?(n=a,s):n},s.direction=function(b){return arguments.length?(o=null===b?b:a.functor(b),s):o},s.offset=function(b){return arguments.length?(p=null===b?b:a.functor(b),s):p},s.html=function(b){return arguments.length?(q=null===b?b:a.functor(b),s):q};var t=a.map({n:e,s:f,e:g,w:h,nw:i,ne:j,sw:k,se:l}),u=t.keys();return s};var lc={"d3-tip:after":{}};rb.viz.force.plugin(function(a,b){function c(a){return function(){return a}}var d=0,e=1;void 0===b.velocity&&(b.velocity=0),a.velocity=function(c){return arguments.length?(b.velocity=c,a):"function"==typeof b.velocity?b.velocity:+b.velocity},a.velocity_x=function(b){return arguments.length?(d=b,a):d},a.velocity_y=function(b){return arguments.length?(e=b,a):e},a.addForce(function(){var f=a.velocity();if(f){var g,h,i=a.nodes();"function"!=typeof b.velocity&&(f=c(f));for(var j=0;j<i.length;++j)g=i[j],g.fixed||(h=f(g),g.x+=h[d],g.y+=h[e])}})});var mc={x:!0,y:!0,extent:[1,10]};return rb.paper.svg.plugin("zoom",mc,function(b,c){function d(){e||(e=a.behavior.zoom(),c.zoom=zb({},c.zoom,rb.defaults.paper.zoom))}var e;b.zoom=function(a){d(),a&&zb(c.zoom,a),c.zoom.x&&e.x(b.xAxis().scale()),c.zoom.y&&e.y(b.yAxis().scale()),c.zoom.extent&&e.scaleExtent(c.zoom.extent),e.on("zoom",b.render);var f=b.root().current();f.call(e),b.showGrid()}}),rb.paper.canvas.plugin("zoom",mc,function(b,c){function d(){e||(e=a.behavior.zoom(),c.zoom=zb({},c.zoom,rb.defaults.paper.zoom))}var e;b.zoom=function(a){d(),a&&zb(c.zoom,a),c.zoom.x&&e.x(b.xAxis().scale()),c.zoom.y&&e.y(b.yAxis().scale()),c.zoom.extent&&e.scaleExtent(c.zoom.extent),b.showGrid()}}),rb.viz.chart.plugin(function(a,b){a.on("tick.zoom",function(){b.zoom&&a.paper().zoom(b.zoom)})}),rb.angular=function(){var a,b={};return b.module=function(c,d,e){return arguments.length?(a||(d=d||"giotto",e=e||[],a=c.module(d,e),a.config(["$compileProvider",function(b){a.directive=function(a,c){return b.directive(a,c),this}}]).directive("jstats",function(){return{link:function(a,b,d){var e=d.mode?+d.mode:1;rb.require(["stats"],function(){var d=new Stats;d.setMode(e),a.stats=d,b.append(c.element(d.domElement))})}}})),b):a},b.directive=function(b,c,d){function e(a,d,e){e.scope=a;var f=b(d[0],e);e=f.options(),d.data(c,f),yb.isFunction(e.angular)&&e.angular(f,e),a.$emit("giotto-viz",f),f.start()}return a?(d=d?d.slice():[],c||(c=b.vizName(),c=a.name.toLowerCase()+c.substring(0,1).toUpperCase()+c.substring(1)),d.push(function(){return{restrict:"AE",link:function(a,b,d){var f=b.data(c);if(!f){var g=Bb(d),h=g.require;h?(rb._.isArray(h)||(h=[h]),rb.require(h,function(c){zb(g,c),e(a,b,g)})):e(a,b,g)}}}}),a.directive(c,d)):void rb.log.warn("No angular module, cannot add directive")},b.addAll=function(a){return rb.log.info("Adding giotto visualization directives"),angular.forEach(rb.viz,function(b){rb.angular.directive(b,null,a)}),b},b}(),rb.crossfilter=function(a){function b(){if(!rb.crossfilter.lib)throw Error("Could not find crossfilter library");c.data=rb.crossfilter.lib(a.data),rb._.isArray(a.dimensions)&&a.dimensions.forEach(function(a){c.addDimension(a)}),a.callback&&a.callback(c)}var c={dims:{},tolerance:void 0===a.tolerance?rb.crossfilter.tolerance:a.tolerance};if(c.addDimension=function(a,b){b||(b=function(b){return b[a]}),c.dims[a]=c.data.dimension(b)},c.reduceDensity=function(a,b,d,e){var f,g=c.dims[a];if(!g)throw Error('Cross filter dimension "'+a+'"" not available. Add it with the addDimension method');void 0===d&&(d=null),void 0===e&&(e=null),f=null===d&&null===e?g.filter():g.filter(function(a){return null!==d&&d>a||null!==e&&a>e?void 0:!0});var h=f.bottom(1/0);if(h.length>c.tolerance*b){var i,j,k,l=rb.math.kmeans(),m=[],n=[],o=[],p=h.length/b;for(j=0;j<h.length;j++)n.push([h[j][a]]);for(j=0;b>j;j++)o.push(n[Math.round(j*p)]);l.centroids(o).maxIters(10),n=l.cluster(n).sort(function(a,b){return a.centroid[0]-b.centroid[0]}),n.forEach(function(a){for(i=a.indices[0],k=a.points[0],j=1;j<a.points.length;++j)a.points[j]>k&&(i=a.indices[j],k=a.points[j]);m.push(h[i])}),h=m}return h},void 0===rb.crossfilter.lib){if("undefined"==typeof crossfilter)return rb.require(["crossfilter"],function(a){rb.crossfilter.lib=a||null,b()}),c;rb.crossfilter.lib=crossfilter}return b(),c},rb.crossfilter.tolerance=1.1,a});