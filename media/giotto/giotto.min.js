!function(a){var b;b="object"==typeof module&&module.exports?module.exports:window,"function"==typeof define&&define.amd?define(["d3"],function(){return a(d3,b)}):"object"==typeof module&&module.exports&&a(d3,b)}(function(a,b){"use strict";function c(a){return a}function d(){return 0}function e(a){return"function"==typeof a?a:function(){return a}}function f(a){var b=a[0],c=a[a.length-1];return c>b?[b,c]:[c,b]}function g(a){return a.rangeExtent?a.rangeExtent():f(a.range())}function h(a){return a[0]}function i(a){return a[1]}function j(){return!0}function l(a,b){return(b[1]-a[1])/(b[0]-a[0])}function m(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function n(a,b){for(var c,d=[],e=(1-b)/2,f=a[0],g=a[1],h=1,i=a.length;++h<i;)c=f,f=g,g=a[h],d.push([e*(g[0]-c[0]),e*(g[1]-c[1])]);return d}function o(a){for(var b=0,c=a.length-1,d=[],e=a[0],f=a[1],g=d[0]=l(e,f);++b<c;)d[b]=(g+(g=l(e=f,f=a[b+1])))/2;return d[b]=g,d}function p(a){for(var b,c,d,e,f=[],g=o(a),h=-1,i=a.length-1;++h<i;)b=l(a[h],a[h+1]),jc(b)<dc?g[h]=g[h+1]=0:(c=g[h]/b,d=g[h+1]/b,e=c*c+d*d,e>9&&(e=3*b/Math.sqrt(e),g[h]=e*c,g[h+1]=e*d));for(h=-1;++h<=i;)e=(a[Math.min(i,h+1)][0]-a[Math.max(0,h-1)][0])/(6*(1+g[h]*g[h])),f.push([e||0,g[h]*e||0]);return f}function q(a,b,c,d){var e=a[0],f=c[0],g=b[0]-e,h=d[0]-f,i=a[1],j=c[1],k=b[1]-i,l=d[1]-j,m=(h*(i-j)-l*(e-f))/(l*g-h*k);return[e+m*g,i+m*k]}function r(a){return a>1?hc:-1>a?-hc:Math.asin(a)}function s(a){return a.innerRadius}function t(a){return a.outerRadius}function u(a){return a.startAngle}function v(a){return a.endAngle}function w(a){return a&&a.padAngle}function x(a,b,c,d){return(a-c)*b-(b-d)*a>0?0:1}function y(a,b,c,d,e){var f=a[0]-b[0],g=a[1]-b[1],h=(e?d:-d)/Math.sqrt(f*f+g*g),i=h*g,j=-h*f,k=a[0]+i,l=a[1]+j,m=b[0]+i,n=b[1]+j,o=(k+m)/2,p=(l+n)/2,q=m-k,r=n-l,s=q*q+r*r,t=c-d,u=k*n-m*l,v=(0>r?-1:1)*Math.sqrt(t*t*s-u*u),w=(u*r-q*v)/s,x=(-u*q-r*v)/s,y=(u*r+q*v)/s,z=(-u*q+r*v)/s,A=w-o,B=x-p,C=y-o,D=z-p;return A*A+B*B>C*C+D*D&&(w=y,x=z),[[w-i,x-j],[w*c/t,x*c/t]]}function z(){}function A(a){var b=a.attr("id");return b||(b="giotto-element-"+ ++vc,a.attr("id",b)),b}function B(b){var c=a.select(I(b.node())),d=c.select("defs");return d.size()||(d=c.append("defs")),d}function C(a){return G(a,"width")}function D(a){return G(a,"height")}function E(a){return H(a,"width")}function F(a){return H(a,"height")}function G(a,b){for(var c,d=a.node?a.node():a;d&&"BODY"!==d.tagName&&!(c=d.getBoundingClientRect()[b]);)d=d.parentNode;return c}function H(b,c){for(var d,e=b.node?b.node():b;e&&"BODY"!==e.tagName;){if(d=e.getBoundingClientRect()[c])return a.select(e);e=e.parentNode}}function I(a){return"svg"===a.tagName.toLowerCase()?a:a.ownerSVGElement}function J(a){var b={},c=a.getScreenCTM(),d=I(a),e=d.createSVGPoint(),f=a.getBBox(),g=f.width,h=f.height;return e.x=f.x,e.y=f.y,b.nw=e.matrixTransform(c),e.x+=g,b.ne=e.matrixTransform(c),e.y+=h,b.se=e.matrixTransform(c),e.x-=g,b.sw=e.matrixTransform(c),e.y-=.5*h,b.w=e.matrixTransform(c),e.x+=g,b.e=e.matrixTransform(c),e.x-=.5*g,e.y-=.5*h,b.n=e.matrixTransform(c),e.y+=h,b.s=e.matrixTransform(c),b}function K(a){function b(h){function i(){var b=a(t),d=a(s.reverse());P(c,b[0],!0),m(c,b,p),P(c,d[0],m.closed),o(c,d,p),c.closePath()}if(c){for(var j,n,q,r=[],s=[],t=[],u=-1,v=h.length,w=e(d),x=e(g),y=d===f?function(){return n}:e(f),z=g===k?function(){return q}:e(k);++u<v;)l.call(b,j=h[u],u)?(s.push([n=+w.call(b,j,u),q=+x.call(b,j,u)]),t.push([+y.call(b,j,u),+z.call(b,j,u)])):s.length&&(i(),s=[],t=[]);return s.length&&i(),r.length?r.join(""):null}}var c,d=h,f=h,g=0,k=i,l=j,m=Q,n=m.key,o=m,p=.7;return b.context=function(a){return arguments.length?(c=a,b):c},b.x=function(a){return arguments.length?(d=f=a,b):f},b.x0=function(a){return arguments.length?(d=a,b):d},b.x1=function(a){return arguments.length?(f=a,b):f},b.y=function(a){return arguments.length?(g=k=a,b):k},b.y0=function(a){return arguments.length?(g=a,b):g},b.y1=function(a){return arguments.length?(k=a,b):k},b.defined=function(a){return arguments.length?(l=a,b):l},b.interpolate=function(a){return arguments.length?(n="function"==typeof a?m=a:(m=rc.get(a)||Q).key,o=m.reverse||m,b):n},b.tension=function(a){return arguments.length?(p=a,b):p},b}function M(a,b){var c,d,e,f,g,h,i,j,k=a.length,l=new Array(k);for(d=0;k>d;d++)c=d-1,e=d+1,0>c&&(c=k-1),e===k&&(e=0),f=a[c],g=a[d],h=a[e],i=N(f[0],f[1],g[0],g[1],b,!1),j=N(g[0],g[1],h[0],h[1],b,!0),l[d]=[i[0],i[1],g[0],g[1],j[0],j[1]];return l}function N(a,b,c,d,e,f){var g=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2)),h=f?e/g:(g-e)/g;return[a+h*(c-a),b+h*(d-b)]}function O(a){function b(h){function i(){var b=a(n);P(c,b[0],!0),k(c,b,m)}if(c){for(var j,l=[],n=[],o=-1,p=h.length,q=e(d),r=e(f);++o<p;)g.call(b,j=h[o],o)?n.push([+q.call(b,j,o),+r.call(b,j,o)]):n.length&&(i(),n=[]);return n.length&&i(),l.length?l.join(""):null}}var c,d=h,f=i,g=j,k=Q,l=k.key,m=.7;return b.context=function(a){return arguments.length?(c=a,b):c},b.x=function(a){return arguments.length?(d=a,b):d},b.y=function(a){return arguments.length?(f=a,b):f},b.defined=function(a){return arguments.length?(g=a,b):g},b.interpolate=function(a){return arguments.length?(l="function"==typeof a?k=a:(k=rc.get(a)||Q).key,b):l},b.tension=function(a){return arguments.length?(m=a,b):m},b}function P(a,b,c){c?(a.beginPath(),a.moveTo(b[0],b[1])):a.lineTo(b[0],b[1])}function Q(a,b){for(var c=b[0],d=1;d<b.length;++d)c=b[d],a.lineTo(c[0],c[1])}function R(a,b){Q(a,b),a.closePath()}function S(a,b){var c=b[1],d=b[0],e=.5*(c[0]+d[0]);a.lineTo(e,d[1]),a.lineTo(e,c[1]);for(var f=2;f<b.length;++f)d=c,c=b[f],e=.5*(c[0]+d[0]),a.lineTo(e,d[1]),a.lineTo(e,c[1]);a.lineTo(c[0],c[1])}function T(a,b){for(var c,d=b[0],e=1;e<b.length;++e)c=d,d=b[e],a.lineTo(c[0],d[1]),a.lineTo(d[0],d[1])}function U(a,b){for(var c,d=b[0],e=1;e<b.length;++e)c=d,d=b[e],a.lineTo(d[0],c[1]),a.lineTo(d[0],d[1])}function V(a,b){if(b.length<3)return Q(a,b);var c=1,d=b.length,e=b[0],f=e[0],g=e[1],h=[f,f,f,(e=b[1])[0]],i=[g,g,g,e[1]];for(a.lineTo(m(Ib,h),m(Ib,i)),b.push(b[d-1]);++c<=d;)e=b[c],h.shift(),h.push(e[0]),i.shift(),i.push(e[1]),bb(a,h,i);b.pop(),a.lineTo(e[0],e[1])}function W(a,b){if(b.length<4)return Q(b);for(var c,d=-1,e=b.length,f=[0],g=[0];++d<3;)c=b[d],f.push(c[0]),g.push(c[1]);for(a.moveTo(m(Ib,f),m(Ib,g)),--d;++d<e;)c=b[d],f.shift(),f.push(c[0]),g.shift(),g.push(c[1]),bb(a,f,g)}function X(a,b){for(var c,d=-1,e=b.length,f=e+4,g=[],h=[];++d<4;)c=b[d%e],g.push(c[0]),h.push(c[1]);for(a.moveTo(m(Ib,g),m(Ib,h)),--d;++d<f;)c=b[d%e],g.shift(),g.push(c[0]),h.shift(),h.push(c[1]),bb(a,g,h)}function Y(a,b,c){var d=b.length-1;if(d)for(var e,f,g=b[0][0],h=b[0][1],i=b[d][0]-g,j=b[d][1]-h,k=-1;++k<=d;)e=b[k],f=k/d,e[0]=c*e[0]+(1-c)*(g+f*i),e[1]=c*e[1]+(1-c)*(h+f*j);return V(a,b)}function Z(a,b,c){b.length<3?Q(a,b):cb(a,b,n(b,c))}function $(a,b,c){b.length<4?Q(a,b):cb(a,b.slice(1,-1),n(b,c))}function _(a,b,c){b.length<3?Q(a,b):cb(a,(b.push(b[0]),b),n([b[b.length-2]].concat(b,[b[1]]),c))}function ab(a,b){b.length<3?Q(a,b):cb(a,b,p(b))}function bb(a,b,c){a.bezierCurveTo(m(Gb,b),m(Gb,c),m(Hb,b),m(Hb,c),m(Ib,b),m(Ib,c))}function cb(a,b,c){if(c.length<1||b.length!=c.length&&b.length!=c.length+2)return Q(a,b);var d,e,f=b.length!=c.length,g=b[0],h=b[1],i=c[0],j=i,k=1;if(f&&(a.quadraticCurveTo(h[0]-2*i[0]/3,h[1]-2*i[1]/3,h[0],h[1]),g=b[1],k=2),c.length>1){j=c[1],h=b[k],k++,a.bezierCurveTo(g[0]+i[0],g[1]+i[1],h[0]-j[0],h[1]-j[1],h[0],h[1]);for(var l=2;l<c.length;l++,k++)d=h[0]+j[0],e=h[1]+j[1],h=b[k],j=c[l],a.bezierCurveTo(d,e,h[0]-j[0],h[1]-j[1],h[0],h[1])}if(f){var m=b[k];a.quadraticCurveTo(h[0]+2*j[0]/3,h[1]+2*j[1]/3,m[0],m[1])}}function db(a,b){var c=Math.sqrt(b/ec);a.beginPath(),a.arc(0,0,c,0,fc,!1),a.closePath()}function eb(b,c,d){function f(b){return Xb(b)?b:a.format(b)}var g,j,k,l,m,n,o,p,q=++vc,r=h,s=i,t=Ac;d=fb(xc,d);var u=d.set;return d.uid=function(){return"giottodraw"+q},d.remove=z,d.render=function(){return c?c.apply(d):void 0},d.group=function(){return b},d.draw=function(){return d},d.each=function(a){return k?k.forEach(function(b){a.call(b)}):a.call(d),d},d.renderer=function(a){return 0===arguments.length?c:(c=a,d)},d.options=function(a){return 0===arguments.length?l:(l=a,Xb(l.x)&&d.x(l.x),Xb(l.y)&&d.y(l.y),l.formatX&&(m=f(l.formatX)),l.formatY&&(n=f(l.formatY)),d.init(d,l),d)},d.set=function(a,b){return-1===yc.indexOf(a)?l[a]=b:k?k.forEach(function(c){c.set(a,b)}):u(a,b),d},d.x=function(a){return 0===arguments.length?r:(r=e(a),d)},d.y=function(a){return 0===arguments.length?s:(s=e(a),d)},d.formatX=function(b){return m||(m=a.format("n")),m(b)},d.formatY=function(b){return n||(n=a.format("n")),n(b)},d.size=function(a){return 0===arguments.length?t:(t=e(a),d)},d.name=function(a){return 0===arguments.length?j:(j=a,d)},d.scalex=function(){var a=b.xaxis().scale();return function(b){return a(r(b))}},d.scaley=function(){var a=b.yaxis().scale();return function(b){return a(s(b))}},d.data=function(a){return 0===arguments.length?k:(g=!0,k=p?p.call(d,a):a,d)},d.add=function(a){return p&&(a=p.call(d,[a])),k?k.push(a[0]):k=a,d},d.dataConstructor=function(a){return 0===arguments.length?p:(p=e(a),d)},d.label=function(a){return 0===arguments.length?o:(o=a,d)},d}function fb(a,b){var c={},d=!1;return b||(b={}),b.factor=function(){return b.group().factor()},b.paper=function(){return b.group().paper()},b.highLight=function(){if(d)return b;d=!0;var e,f=b.active;return f&&a.forEach(function(a){e=f[a],e&&("string"==typeof e&&"%"===e.substring(e.length-1)&&(e=.01*e.substring(0,e.length-1)*c[a]),b[a]=e)}),b},b.set=function(d,e){return a.indexOf(d)>-1&&(c[d]=e,b[d]=e),b},b.reset=function(){return d=!1,a.forEach(function(a){b[a]=c[a]}),b},b.init=function(d,e){return a.forEach(function(a){c[a]=d[a]||e[a]}),e.active&&(d.active||(d.active={}),Qb(e.active,d.active),Bb(d)),b.reset()},b.setBackground=function(a){return b.group().setBackground(b,a),b},b.inRange=z,b}function gb(b,c,d){var e,f,g=b.type(),h=a.bisector(function(a){return a.sx}).left;return d=eb(b,c,d),d.bisector=a.bisector(function(a){return a.sx}).left,d.each=function(a){return a.call(d),d},d.path_line=function(){var b=d.options();return a[g].line().interpolate(b.interpolate).x(function(a){return a.sx}).y(function(a){return a.sy})},d.path_area=function(){var c=d.options(),e=b.yaxis().scale();return a[g].area().interpolate(c.interpolate).x(function(a){return a.sx}).y0(e(e.domain()[0])).y1(function(a){return a.sy})},d.path_data=function(){var c=d.x(),h=d.y(),i=b.xaxis().scale(),j=b.yaxis().scale();return f=null,d.symbol=a[g].symbol().type(function(a){return a.symbol||"circle"}).size(d.size()),e=d.data().map(function(a,b){var d={x:c(a),y:h(a),index:b,data:a};return d.sx=i(d.x),d.sy=j(d.y),d})},d.bisect=function(b){if(!f&&e&&(f=e.slice().sort(function(b,c){return a.ascending(b.sx,c.sx)})),f){var c=h(f,b);if(c<f.length)return f[c]}},d}function hb(a,b,c,d){var e=a.options();return d=fb(c,d),Yb(b)?d.init(d,e):(d.init(b,e),d.active=b.active),d.data=b,d.options=function(){return e},d.draw=function(){return a},d.group=function(){return a.group()},d}function ib(a,b,c){var d=hb(a,b,yc);return d.set("size",void 0===b.size?c:b.size),d}function jb(b,c){var d={},e=Yb(c)?d:c;return e.fill=e.fill||b.paper().pickColor(),e.color=e.color||a.rgb(e.fill).darker().toString(),hb(b,c,zc,d)}function kb(b,c){function d(){b.element().classed("selecting",!0),c.brush.start&&c.brush.start()}function e(){c.brush.move&&c.brush.move()}function f(){b.element().classed("selecting",!1),c.brush.end&&c.brush.end()}function g(a,b){var c,d=a.x(),e=[],f=h.extent();if(b){var g=a.group();b.save(),b.translate(g.marginLeft(),g.marginTop())}return a.each(function(){this.data&&(c=d(this.data),f[0]<=c&&c<=f[1]?(this.highLight(),b&&this.render(b),e.push(this)):this.reset())}),b?b.restore():a.render(),e}var h,i;b.brush=function(){return h},b.addBrush=function(j){return i?i:(Pb(c.brush,j),i=b.add(function(){var i=b.type(),j=b.resizing();if(h||(j=!0,h=a[i].brush().on("brushstart",d).on("brush",e).on("brushend",f),("x"===c.brush.axis||"xy"===c.brush.axis)&&h.x(b.xaxis().scale()),("y"===c.brush.axis||"xy"===c.brush.axis)&&h.y(b.yaxis().scale()),c.brush.extent&&h.extent(c.brush.extent),h.selectDraw="svg"===i?g:function(a){g(a,b.paper().canvasOverlay().node().getContext("2d"))}),j)if(h.extent(h.extent()),"svg"===i){var k=b.element().select(".brush");k.node()||(k=b.element().append("g").classed("brush",!0));var l=k.call(h).selectAll("rect");this.setBackground(l),"x"===c.brush.axis&&l.attr("y",-6).attr("height",b.innerHeight()+7),d(),e(),f()}else h.fillStyle(a.canvas.rgba(this.fill,this.fillOpacity)).rect([b.marginLeft(),b.marginTop(),b.innerWidth(),b.innerHeight()]),b.paper().canvasOverlay().call(h)}),i.options(c.brush))}}function lb(b,c){var d,e,f,g=b.paper();g.zoom||(g.zoom=nb(g)),b.showGrid=function(){return d?d.clear().render():(e||(e=Pb({},c),e.xaxis=Pb({position:"top",size:0,show:void 0===c.xaxis.grid||c.xaxis.grid},c.grid),e.yaxis=Pb({position:"left",size:0,show:void 0===c.yaxis.grid||c.yaxis.grid},c.grid)),e.before="*",d=b.paper().group(e),d.element().classed("grid",!0),d.xaxis().tickFormat(mb).scale(b.xaxis().scale()),d.yaxis().tickFormat(mb).scale(b.yaxis().scale()),d.add(h).options(c.grid),e.xaxis.show&&d.drawXaxis(),e.yaxis.show&&d.drawYaxis(),d.render()),b},b.hideGrid=function(){return d&&d.remove(),b};var h=function(){var b,e,h,i=d.innerWidth(),j=d.innerHeight(),k=d.type();if("svg"===k){if(f)return;var l=d.element().select(".grid-rectangle");l.node()||(l=d.element().append("rect").attr("class","grid-rectangle")),l.attr("width",i).attr("height",j),this.setBackground(l)}else{var m=d.context();m.beginPath(),m.rect(0,0,i,j),this.setBackground(m),m.fill()}if(!f&&(d.xaxis().tickSize(-j,0),d.yaxis().tickSize(-i,0),!h&&(c.grid.zoomx||c.grid.zoomy))){h=a.behavior.zoom().on("zoom",function(){if(f=!0,b){var a=b.invert(c.margin.left),h=b.invert(c.size[0]-c.margin.right);d.xaxis().scale().domain([a,h])}if(e){var i=b.invert(c.margin.top),j=b.invert(c.size[1]-c.margin.bottom);d.yaxis().scale().domain([i,j])}g.render(),f=!1}),h("svg"===k?d.element():d.paper().canvas());var n=d.factor();if(1===n)c.grid.zoomx&&h.x(d.xaxis().scale()),c.grid.zoomy&&h.y(d.yaxis().scale());else{if(c.grid.zoomx){b=d.xaxis().scale().copy();var o=b.invert(-n*c.margin.left),p=b.invert(n*(c.size[0]-c.margin.left));b.domain([o,p]).range([0,c.size[0]]),h.x(b)}if(c.grid.zoomy){e=d.yaxis().scale().copy();var q=e.invert(-n*c.margin.left),r=e.invert(n*(c.size[1]-c.margin.bottom));e.domain([q,r]).range([c.size[1],0]),h.y(e)}}c.grid.scaleExtent&&h.scaleExtent(c.grid.scaleExtent)}}}function mb(){return""}function nb(a){var b;return function(c){return arguments.length?(b=c,a):b}}function ob(b,c){var d=b.paper();if(c.tooltip.show&&(c.tooltip.interact=!0),!d.tooltip&&c.tooltip.interact){!Fc&&c.tooltip.show&&(Fc=pb(c).offset(c.tooltip.offset)),Fc||(Fc=pb(c)),d.tooltip=Fc;var e;if("svg"===d.type())c.activeEvents.forEach(function(b){d.on(b+".tooltip",function(){var b=a.select(this);e=b.size()?b.datum():null,e&&"mouseout"!==a.event.type?e&&e.reset&&(void 0===a.event.active&&(Fc.hide(!0),a.event.active=Fc.active),Fc.active.push(b),e.highLight().render(b)):Fc.hide(!0)}).on(b+".tooltip-show",function(){if(Fc.active.length){var a=J(Fc.active[0].node()),b="n";if(Fc.active.length>1){b="e";for(var c=1;c<Fc.active.length;++c){var d=J(Fc.active[c].node());a[b].y+=d[b].y}a[b].y/=Fc.active.length}Fc.bbox(a).direction(b).show()}})});else{var f=d.canvasOverlay();c.activeEvents.forEach(function(b){f.on(b+".tooltip",function(){var b,c,e=this.getContext("2d");if(a.canvas.clear(e),Fc.hide(),"mouseout"!==a.event.type&&(b=a.canvas.mouse(this),Fc.active=d.canvasDataAtPoint(b),Fc.active.length)){for(var f,g,h="n",i=0;i<Fc.active.length;++i)c=Fc.active[i],c.group().transform(e),c.highLight().render(e),i&&f?(g=c.bbox(),h="e",f[h].y+=g[h].y):i||(f=c.bbox());f&&(f[h].y/=Fc.active.length,Fc.bbox(f).direction(h).show())}})})}}}function pb(a){var b=a.tooltip,c=Pb({},a.font,b.font),d=Fb.tip(),e=d.hide;return b.show||(d.show=z,e=z),d.active=[],d.attr("class",b.className).style({background:b.fill,opacity:b.fillOpacity,color:b.color,padding:b.padding,"border-radius":b.radius,font:cc(c)}),"d3-tip"===b.className&&Gc&&(Gc["d3-tip:after"].color=b.fill,_b("",Gc),Gc=null),d.html(function(){for(var a,c,e="",f=0;f<d.active.length;++f)a=d.active[f],a.datum&&(a=a.datum()),c=a.draw(),e+=b.template({c:a.color,l:c.label()||"serie",x:c.formatX(c.x()(a.data)),y:c.formatY(c.y()(a.data))});return e}),d.hide=function(a){for(var b=0;b<d.active.length;++b){var c=d.active[b];c.datum&&(c=c.datum()),c.reset(),a&&c.render(d.active[b])}d.active=[],e()},d}function qb(b,c){var d={};return d.scale=function(b){return a.canvas.retinaScale(b.context(),c.size[0],c.size[1])},d.resize=function(b){a.canvas.clear(b.context()),d.scale(b),b.resetAxis().render()},d.point=ub,d.path=tb,d.axis=sb,d.pieslice=wb,d.bar=vb,d.points=function(){this.each(function(){this.reset().render()})},d.barchart=d.points,d.pie=function(a){a.each(function(){this.reset().render()})},d}function rb(a){return a.inRange=function(){},a.bbox=function(){},a}function sb(b,c,d){function e(e){var g=0,i=0;e.save(),f=h.options(),"x"===d[0]?i="top"===f.position?0:b.innerHeight():g="left"===f.position?0:b.innerWidth(),e.translate(g,i),c(a.select(e.canvas)),e.restore()}var f,g,h=rb(eb(b)),i=b.context();return h.render=function(c){return c=c||i,f=h.options(),f.show===!1?h:(g=f.size,f.size=b.scale(b.dim(g))+"px",c.font=cc(f),f.size=g,i.strokeStyle=a.canvas.rgba(h.color,h.colorOpacity),c.fillStyle=h.color,i.lineWidth=b.factor()*h.lineWidth,e(c),c.stroke(),h)},h.context=function(a){return i=a,h},h}function tb(b){var c,d,e,f=rb(gb(b)),g=(f.scalex,f.scaley,b.context());return f.render=function(e){if(c=f.options(),d=f.path_data(),e=e||g,c.area){var h=b.paper().canvasBackground(!0).node().getContext("2d");if(h.save(),b.transform(h),f.fill||(f.fill=f.color),f.path_area().context(h)(d),c.gradient){var i=b.yaxis().scale(),j=i.domain();Fb.gradient().y1(i(j[j.length-1])).y2(i(j[0])).direction("y").colors([{color:a.canvas.rgba(f.fill,f.fillOpacity),offset:0},{color:a.canvas.rgba(c.gradient,f.fillOpacity),offset:100}])(a.select(h.canvas))}else h.fillStyle=a.canvas.rgba(f.fill,f.fillOpacity),h.fill();h.restore()}return g.strokeStyle=f.color,g.lineWidth=b.factor()*f.lineWidth,f.path_line().context(e)(d),e.stroke(),f},f.context=function(a){return g=a,f},f.inRange=function(a){f.options();if(!f.active)return!1;if(!f.active.symbol)return!1;e||(e=ub(f,[],0));var c=f.bisect(a-b.marginLeft());return c?(e.data=c.data,e):!1},f}function ub(b,c,d){function e(){return b.symbol||(b.symbol=a.canvas.symbol().type(function(a){return a.symbol}).size(b.size())),b.symbol}function f(a){a.translate(h(g.data),i(g.data)),e().context(a)(g)}var g=rb(ib(b,c,d)),h=b.scalex(),i=b.scaley(),j=b.factor(),k=b.group(),l=b.group().context();return g.render=function(a){return a=a||l,a.save(),f(a),g.fill&&(a.fillStyle=Hc(g.fill,g.fillOpacity),a.fill()),g.color&&g.lineWidth&&(a.strokeStyle=Hc(g.color,g.colorOpacity),a.lineWidth=j*g.lineWidth,a.stroke()),a.restore(),g},g.context=function(a){return l=a,g},g.inRange=function(a,b){l.save(),f(l);var c=l.isPointInPath(a,b);return l.restore(),c},g.bbox=function(){var a=h(g.data)+k.marginLeft(),b=i(g.data)+k.marginTop(),c=Math.sqrt(e().size()(g));return xb(g,[a-c,b-c],[a+c,b-c],[a+c,b+c],[a-c,b+c])},g}function vb(b,c,d){function e(c){j=o*b.options().radius,c.beginPath(),i=.5*n(k),f=l(k.data),g=m(k.data),h=p.scaley(0),a.canvas.drawPolygon(c,[[f-i,h],[f+i,h],[f+i,g],[f-i,g]],j),c.closePath()}var f,g,h,i,j,k=rb(ib(b,c,d)),l=b.scalex(),m=b.scaley(),n=b.size(),o=b.factor(),p=b.group(),q=b.group().context();return k.render=function(b){return b=b||q,b.fillStyle=a.canvas.rgba(k.fill,k.fillOpacity),b.strokeStyle=a.canvas.rgba(k.color,k.colorOpacity),b.lineWidth=o*k.lineWidth,e(b),b.fill(),b.stroke(),k},k.inRange=function(a,b){return e(q),q.isPointInPath(a,b)},k}function wb(a,b){var c=rb(jb(a,b)),d=a.group(),e=a.factor(),f=d.context();return c.render=function(b){return b=b||f,b.save(),b.translate(.5*d.innerWidth(),.5*d.innerHeight()),b.fillStyle=Hc(c.fill,c.fillOpacity),b.strokeStyle=Hc(c.color,c.colorOpacity),b.lineWidth=e*c.lineWidth,a.arc.context(b)(c),b.fill(),b.stroke(),b.restore(),c},c.context=function(a){return f=a,c},c.inRange=function(b,e){f.save(),f.translate(.5*d.innerWidth(),.5*d.innerHeight()),a.arc.context(f)(c);var g=f.isPointInPath(b,e);return f.restore(),g},c}function xb(b,c,d,e,f){function g(a,b,c){return j[c]+.5*k*(a[c]+b[c])}var h=b.paper().element().node(),i=h.getBoundingClientRect(),j=[i.left,i.top],k=1/a.canvas.pixelRatio;return{nw:{x:k*c[0]+j[0],y:k*c[1]+j[1]},ne:{x:k*d[0]+j[0],y:k*d[1]+j[1]},se:{x:k*e[0]+j[0],y:k*e[1]+j[1]},sw:{x:k*f[0]+j[0],y:k*f[1]+j[1]},n:{x:g(c,d,0),y:g(c,d,1)},s:{x:g(f,e,0),y:g(f,e,1)},e:{x:g(e,d,0),y:g(e,d,1)},w:{x:g(f,c,0),y:g(f,c,1)}}}function yb(a,b){zb(a,b),Bb(b)}function zb(b,c){return c.color||(c.color=c.fill&&-1===Ic.indexOf(c.fill)?a.rgb(c.fill).darker().toString():b.pickColor()),c.fill===!0?c.fill=a.rgb(c.color).brighter().toString():"color"===c.fill&&(c.fill=c.color),c.color}function Ab(a,b,c){var d=a.xaxis(),e=a.yaxis();c=c||1e3,b.formatX||(b.formatX=d.tickFormat()||d.scale().tickFormat(c)),b.formatY||(b.formatY=e.tickFormat()||e.scale().tickFormat(c))}function Bb(b){var c=b.active=Pb({},b.active);"darker"===c.fill?c.fill=a.rgb(b.fill).darker().toString():"brighter"===c.fill&&(c.fill=a.rgb(b.fill).brighter().toString()),"darker"===c.color?c.color=a.rgb(b.color).darker().toString():"brighter"===c.color&&(c.color=a.rgb(b.color).brighter().toString())}function Cb(b,c){var d,e;if(c){if(c.__paper__===b)return c;d=c.width,e=c.height}else c={};if(void 0!==c.margin&&!Vb(c.margin)){var f=c.margin;c.margin={left:f,right:f,top:f,bottom:f}}return Qb(Fb.defaults.paper,c,!0),Xb(c.colors)&&(c.colors=c.colors(a)),d||(d=C(b),d?c.elwidth=E(b):d=Fb.constants.WIDTH),e?"string"==typeof e&&e.indexOf("%")===e.length-1&&(c.height_percentage=.01*parseFloat(e),e=a.round(c.height_percentage*d)):(e=D(b),e?c.elheight=F(b):e=Fb.constants.HEIGHT),Qb(c.font,c.xaxis),Qb(c.xaxis,c.yaxis),Qb(c.yaxis,c.yaxis2),c.size=[d,e],c.giotto="giotto-group",c.__paper__=a.select(b).style("position","relative").node(),c}function Db(b,c){function d(a,b){return a.style({fill:b.color,"font-size":b.size,"font-weight":b.weight,"font-style":b.style,"font-family":b.family,"font-variant":b.variant})}function e(a){return a.attr("stroke",function(a){return a.color}).attr("stroke-opacity",function(a){return a.colorOpacity}).attr("stroke-width",function(a){return a.lineWidth}).attr("fill",function(a){return a.fill}).attr("fill-opacity",function(a){return a.fillOpacity})}function f(d,e,f){var g,h=e||c.giotto;return c.activeEvents.forEach(function(c){d.on(c+"."+h,function(){e&&!b.element().select("#"+e).size()?d.on(c+"."+e,null):(g=f?f.call(this):this,b[a.event.type].call(g))})}),d}var g={};return g.resize=function(a){c.resize&&(b.svg().attr("width",c.size[0]).attr("height",c.size[1]),a.resetAxis().render())},g.point=function(a,b,c){var d=ib(a,b,c);return d.render=function(b){e(b).attr("d",a.symbol)},d},g.bar=function(a,b,c){var d=ib(a,b,c);return d.render=function(a){e(a)},d},g.pieslice=function(a,b){var c=jb(a,b);return c.render=function(b){e(b).attr("d",a.arc)},c},g.points=function(){var b=this.group(),c=b.element().select("#"+this.uid()),d=this.scalex(),g=this.scaley(),h=this.data();this.symbol=a.svg.symbol().type(function(a){return a.symbol}).size(this.size()),c.node()||(c=b.element().append("g").attr("id",this.uid()),this.remove=function(){c.remove()});var i=c.selectAll("*");return h.length!=i.length&&(i.remove(),i=c.selectAll("*").data(this.data()).enter().append("path")),f(e(i.attr("transform",function(a){return"translate("+d(a.data)+","+g(a.data)+")"}).attr("d",this.symbol))),c},g.path=function(b){function c(a,c){var d=b.paper().svgBackground(c),e=d.select("#"+a);return!e.size()&&c&&(e=d.append("g").attr("id",a).attr("transform","translate("+b.marginLeft()+","+b.marginTop()+")")),e}return gb(b,function(){var d,e,h=this,i=h.options(),j=b.element(),k=h.uid(),l="area-"+k,m=j.select("#"+k),n=i.transition,o=this.path_line(),p=this.path_data();if(m.node()){if(m.datum(p),e=c(l),i.area){e.size()||(e=c(l,!0));var q=e.select("path");q.size()||(q=e.append("path")),e=q.datum(p)}else e.remove(),e=null;!b.resizing()&&n&&n.duration&&(m=m.transition().duration(n.duration).ease(n.ease),e&&(e=e.transition().duration(n.duration).ease(n.ease)))}else m=j.append("path").attr("id",k).datum(p),i.area&&(e=c(l,!0).append("path").datum(p));return m.attr("d",o).attr("stroke",h.color).attr("stroke-opacity",h.colorOpacity).attr("stroke-width",h.lineWidth).attr("fill","none"),e&&(o=h.path_area(),h.fill||(h.fill=h.color),e.attr("d",o).attr("stroke","none"),i.gradient?Fb.gradient().colors([{color:h.fill,opacity:h.fillOpacity,offset:0},{color:i.gradient,opacity:h.fillOpacity,offset:100}]).direction("y")(e):b.setBackground(h,e)),h.active&&h.active.symbol&&f(b.paper().element(),k,function(){d||(d=j.append("path").attr("id","point-"+k).datum(g.point(h,[],0)).attr("d",h.symbol));var c=a.mouse(this),e=c[0]-b.marginLeft(),f=h.bisect(e);return f?(d.attr("transform","translate("+f.sx+","+f.sy+")"),d.datum().data=f.data,d.node()):void 0}),m})},g.barchart=function(){var a,b=this.group(),c=b.element().select("#"+this.uid()),d=this.options(),g=this.scalex(),h=this.scaley(),i=this.size(),j=b.scaley(0),k=this.data(),l=d.transition;return c.node()||(c=b.element().append("g").attr("id",this.uid())),a=c.selectAll(".bar"),a.size()!==k.length?(a.remove(),a=f(e(c.selectAll(".bar").data(k).enter().append("rect").attr("class","bar")))):a.data(k),!b.resizing()&&l&&l.duration&&(a=a.transition().duration(l.duration).ease(l.ease)),a.attr("x",function(a){return g(a.data)-.5*i(a)}).attr("y",function(a){return Math.min(j,h(a.data))}).attr("height",function(a){return jc(h(a.data)-j)}).attr("width",i),d.radius>0&&a.attr("rx",d.radius).attr("ry",d.radius),c},g.pie=function(a,b,c){var d=a.group().element(),g=d.select("#"+a.uid());return g.node()||(g=d.append("g").attr("id",a.uid()).classed("pie",!0)),g.attr("transform","translate("+b/2+","+c/2+")").selectAll(".slice").remove(),f(e(g.selectAll(".slice").data(a.data()).enter().append("path").attr("class","slice").attr("d",a.arc)))},g.axis=function(a,b,c){return eb(a,function(){var e=0,f=0,g=a.element().select("."+c),h=this.options();return h.show===!1?void g.remove():(g.node()||(g=this.group().element().append("g").attr("class",c)),"x"===c[0]?f="top"===h.position?0:this.group().innerHeight():e="left"===h.position?0:this.group().innerWidth(),g.attr("transform","translate("+e+","+f+")").call(b),g.selectAll("line, path").attr("stroke",this.color).attr("stroke-opacity",this.colorOpacity).attr("stroke-width",this.lineWidth).attr("fill","none"),0===h.size?g.selectAll("text").remove():d(g.selectAll("text"),h),g)})},g}var Eb={version:"0.1.0",d3:a,math:{}},Fb=Eb;a.giotto=Eb,a.canvas={},Fb.require=function(a,c){return b.rcfg&&b.rcfg.min&&(a=b.rcfg.min(a)),require(a,c),Fb};var Gb=[0,2/3,1/3,0],Hb=[0,1/3,2/3,0],Ib=[0,1/6,2/3,1/6],Jb="auto",Kb={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Lb=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Mb=function(a){function b(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function c(a){var c=window.console||{},d=c[a]||c.log||z,e=!1;try{e=!!d.apply}catch(f){}return e?function(){for(var a=[],e=0;e<arguments.length;++e)a.push(b(arguments[e]));return d.apply(c,a)}:function(a,b){d(a,null===b?"":b)}}return{log:c("log"),info:c("info"),warn:c("warn"),error:c("error"),debug:function(){var b=c("debug");return function(){a&&b.apply(self,arguments)}}()}};Fb.log=Mb(b.debug);var Nb=Object.prototype.toString,Ob=Fb._={},Pb=Fb.extend=Ob.extend=function(){var a,b=arguments.length,c=arguments[0],d=0,e=!1;if(c===!0&&(e=!0,c=arguments[1],d++),!c||d+2>b)return c;for(;++d<b;)if(a=arguments[d],Object(a)===a)for(var f in a)a.hasOwnProperty(f)&&(e&&Vb(a[f])?Vb(c[f])?Pb(!0,c[f],a[f]):c[f]=Pb(!0,{},a[f]):c[f]=a[f]);return c},Qb=Ob.copyMissing=function(a,b,c){if(a&&b){var d,e;for(var f in a)a.hasOwnProperty(f)&&(e=a[f],d=b[f],c&&Vb(e)&&e!==d?(Vb(d)||(d={}),Qb(e,d,c),b[f]=d):void 0===d&&(b[f]=e))}return b},Rb=function(a){for(var c=b,d=a.split("."),e=0;e<d.length&&(c=c[d[e]],c);++e);return c},Sb=function(a){var b;return a&&"string"==typeof a.options&&(b=Rb(a.options),"function"==typeof b&&(b=b())),b||(b={}),Vb(b)&&Tb(a,function(a,c){"$"!==c.substring(0,1)&&"options"!==c&&(b[c]=a)}),b},Tb=(Ob.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},Ob.size=function(a){if(a){if(void 0!==a.length)return a.length;if(Ob.isObject(a)){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}return 0}return 0},Ob.forEach=Ob.each=function(a,b){if(a){if(a.forEach)return a.forEach(b);for(var c in a)a.hasOwnProperty(c)&&b(a[c],c)}}),Ub=(Ob.pick=function(a,b){var c,d={};for(var e in a)a.hasOwnProperty(e)&&(c=b(a[e],e),void 0!==c&&(d[e]=c));return d},Ob.extendArray=function(){if(arguments.length){var a=arguments[0],b=function(b){a.push(b)};if("function"==typeof a.push)for(var c=1;c<arguments.length;++c)Tb(arguments[c],b);return a}}),Vb=Ob.isObject=function(a){return"[object Object]"===Nb.call(a)},Wb=Ob.isString=function(a){return"[object String]"===Nb.call(a)},Xb=Ob.isFunction=function(a){return"[object Function]"===Nb.call(a)},Yb=Ob.isArray=function(a){return"[object Array]"===Nb.call(a)},Zb=Ob.isNull=function(a){return void 0===a||null===a},$b=(Ob.encodeObject=function(a,b){var c;if("multipart/form-data"===b){var d=new FormData;for(c in a)a.hasOwnProperty(c)&&d.append(c,a[c]);return d}if("application/json"===b)return JSON.stringify(a);var e=[];for(c in a)a.hasOwnProperty(c)&&e.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return e.join("&")},Ob.getObject=function(a){if(Ob.isString(a)){var c=a.split(".");a=b;for(var d=0;d<c.length&&(a=a[c[d]],a);++d);}return a}),_b=(Ob.loadCss=function(a){var b=document.createElement("link");b.setAttribute("rel","stylesheet"),b.setAttribute("type","text/css"),b.setAttribute("href",a),document.getElementsByTagName("head")[0].appendChild(b)},Ob.addCss=function(a,b){function c(a,b){var e,f=[];for(var g in b)b.hasOwnProperty(g)&&(e=b[g],Ob.isObject(e)?c(a+" ."+g,e):f.push("    "+g+": "+e+";"));f.length&&d.push(a+" {\n"+f.join("\n")+"\n}")}var d=[];if(c(a,b),d.length){d=d.join("\n");var e=document.createElement("style");return e.innerHTML=d,document.getElementsByTagName("head")[0].appendChild(e),e}}),ac=Ob.slugify=function(a){a=a.replace(/^\s+|\s+$/g,""),a=a.toLowerCase();for(var b="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",c="aaaaeeeeiiiioooouuuunc------",d=0,e=b.length;e>d;d++)a=a.replace(new RegExp(b.charAt(d),"g"),c.charAt(d));return a=a.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},bc=["style","variant","weight","size","family"],cc=Ob.fontString=function(a){for(var b,c=[],d=0;d<bc.length;++d)b=a[bc[d]],b&&c.push(b);return c.join(" ")};Fb.slider=function(){function b(b){b.each(function(){function b(b){"boolean"==typeof o&&(o=a.svg.axis().ticks(Math.round(i/100)).tickFormat(u).orient("horizontal"===n?"bottom":"right")),g=f.copy().range([0,i]),o.scale(g);var c=b.append("svg").classed("d3-slider-axis d3-slider-axis-"+o.orient(),!0).on("click",x),d=c.append("g");"horizontal"===n?(c.style("margin-left",-p+"px"),c.attr({width:i+2*p,height:p}),"top"===o.orient()?(c.style("top",-p+"px"),d.attr("transform","translate("+p+","+p+")")):d.attr("transform","translate("+p+",0)")):(c.style("top",-p+"px"),c.attr({width:p,height:i+2*p}),"left"===o.orient()?(c.style("left",-p+"px"),d.attr("transform","translate("+p+","+p+")")):d.attr("transform","translate(0,"+p+")")),d.call(o)}function l(){if(!e.length){var b=Math.max(0,Math.min(i,a.event.offsetX||a.event.layerX));c(d(f.invert(b/i)))}}function m(){if(!e.length){var b=i-Math.max(0,Math.min(i,a.event.offsetY||a.event.layerY));
c(d(f.invert(b/i)))}}function r(){"handle-one"===a.event.sourceEvent.target.id?q=1:"handle-two"==a.event.sourceEvent.target.id&&(q=2);var b=Math.max(0,Math.min(i,a.event.x));c(d(f.invert(b/i)))}function w(){"handle-one"===a.event.sourceEvent.target.id?q=1:"handle-two"==a.event.sourceEvent.target.id&&(q=2);var b=i-Math.max(0,Math.min(i,a.event.y));c(d(f.invert(b/i)))}function x(){a.event.stopPropagation()}f||(f=a.scale.linear().domain([j,k])),e=e||f.domain()[0];var y=a.select(this).classed("d3-slider d3-slider-"+n,!0),z=a.behavior.drag();z.on("dragend",function(){s.slideend(a.event,e)});var A;if(2==e.length?(h=y.append("a").classed("d3-slider-handle",!0).attr("xlink:href","#").attr("id","handle-one").on("click",x).call(z),v=y.append("a").classed("d3-slider-handle",!0).attr("id","handle-two").attr("xlink:href","#").on("click",x).call(z)):h=y.append("a").classed("d3-slider-handle",!0).attr("xlink:href","#").attr("id","handle-one").on("click",x).call(z),"horizontal"===n){if(y.on("click",l),2==e.length){A=a.select(this).append("div").classed("d3-slider-range",!0),h.style("left",t(f(e[0]))),A.style("left",t(f(e[0]))),z.on("drag",r);var B=100-parseFloat(t(f(e[1])));v.style("left",t(f(e[1]))),A.style("right",B+"%"),z.on("drag",r)}else h.style("left",t(f(e))),z.on("drag",r);i=parseInt(y.style("width"),10)}else{if(y.on("click",m),z.on("drag",w),2==e.length){A=a.select(this).append("div").classed("d3-slider-range-vertical",!0),h.style("bottom",t(f(e[0]))),A.style("bottom",t(f(e[0]))),z.on("drag",w);var C=100-parseFloat(t(f(e[1])));v.style("bottom",t(f(e[1]))),A.style("top",C+"%"),z.on("drag",w)}else h.style("bottom",t(f(e))),z.on("drag",w);i=parseInt(y.style("height"),10)}o&&b(y)})}function c(b){var c=e.length?e[q-1]:e,g=t(f(d(c))),i=t(f(d(b))),j="horizontal"===n?"left":"bottom";if(g!==i){if(2===e.length?(e[q-1]=b,a.event&&s.slide(a.event,e)):a.event&&s.slide(a.event.sourceEvent||a.event,e=b),e[0]>=e[1])return;if(1===q)2===e.length&&("left"===j?divRange.style("left",i):divRange.style("bottom",i)),m?h.transition().styleTween(j,function(){return a.interpolate(g,i)}).duration("number"==typeof m?m:250):h.style(j,i);else{var k=100-parseFloat(i),l=100-parseFloat(i);"left"===j?divRange.style("right",k+"%"):divRange.style("top",l+"%"),m?v.transition().styleTween(j,function(){return a.interpolate(g,i)}).duration("number"==typeof m?m:250):v.style(j,i)}}}function d(a){if(a===f.domain()[0]||a===f.domain()[1])return a;var b=a;if(r){var c=f(a),d=f.ticks().map(function(a){return c-f(a)}),e=-1,g=0,h=f.range()[1];do e++,Math.abs(d[e])<h&&(h=Math.abs(d[e]),g=e);while(d[e]>0&&e<d.length-1);b=f.ticks()[g]}else{var i=(a-f.domain()[0])%l;b=a-i,2*Math.abs(i)>=l&&(b+=i>0?l:-l)}return b}var e,f,g,h,i,j=0,k=100,l=.01,m=!0,n="horizontal",o=!1,p=50,q=1,r=!1,s=a.dispatch("slide","slideend"),t=a.format(".2%"),u=a.format(".0"),v=null;return b.min=function(a){return arguments.length?(j=a,b):j},b.max=function(a){return arguments.length?(k=a,b):k},b.step=function(a){return arguments.length?(l=a,b):l},b.animate=function(a){return arguments.length?(m=a,b):m},b.orientation=function(a){return arguments.length?(n=a,b):n},b.axis=function(a){return arguments.length?(o=a,b):o},b.margin=function(a){return arguments.length?(p=a,b):p},b.value=function(a){return arguments.length?(e&&c(d(a)),e=a,b):e},b.snap=function(a){return arguments.length?(r=a,b):r},b.scale=function(a){return arguments.length?(f=a,b):f},a.rebind(b,s,"on"),b},Fb.math.distances={euclidean:function(a,b){for(var c=0,d=0;d<a.length;d++)c+=Math.pow(b[d]-a[d],2);return Math.sqrt(c)}},Fb.math.kmeans=function(a,b,c){var d={};return b=b||300,c=c||"euclidean","string"==typeof c&&(c=Fb.math.distances[c]),d.centroids=function(b){return arguments.length?(a=b,d):a},d.maxIters=function(a){return arguments.length?(b=+a,d):b},d.randomCentroids=function(a,b){var c=a.slice(0);return c.sort(function(){return Math.round(Math.random())-.5}),c.slice(0,b)},d.classify=function(b){var d,e,f=1/0,g=0;for(d=0;d<a.length;d++)e=c(b,a[d]),f>e&&(f=e,g=d);return g},d.cluster=function(c,e){var f,g,h,i=0,j=!0,k=c.length,l=a.length,m=new Array(l);if(l>k)throw Error("Number of points less than the number of clusters in K-means classification");for(;j&&b>i;){for(j=!1,++i,h=0;l>h;++h)m[h]={centroid:a[h],points:[],indices:[]};for(g=0;k>g;g++)h=d.classify(c[g]),m[h].points.push(c[g]),m[h].indices.push(g);for(f=[],h=0;l>h;++h){if(!m[h].points.length){f=d.randomCentroids(c,l);break}f.push(Fb.math.mean(m[h].points))}for(h=0;l>h;++h)if(f[h]!=a[h]){a=f,j=!0;break}e&&e(m,i)}return m},d};var dc=1e-6,ec=Math.PI,fc=2*ec,gc=fc-dc,hc=ec/2,ic=ec/180,jc=Math.abs;Fb.math.xyfunction=function(a,b){var c=[];return Yb(a)&&a.forEach(function(a){c.push([a,b(a)])}),c},Fb.math.mean=function(a){var b,c,d,e=a[0].slice(0);for(c=1;c<a.length;++c)for(b=a[c],d=0;d<e.length;++d)e[d]+=b[d];for(d=0;d<e.length;++d)e[d]/=a.length;return e};var kc=52,lc=2<<51,mc=21201,nc=["d       s       a       m_i","2       1       0       1","3       2       1       1 3","4       3       1       1 3 1","5       3       2       1 1 1","6       4       1       1 1 3 3","7       4       4       1 3 5 13","8       5       2       1 1 5 5 17","9       5       4       1 1 5 5 5","10      5       7       1 1 7 11 1"];Fb.math.sobol=function(a){if(1>a||a>mc)throw new Error("Out of range dimension");var b,c,d={},e=0,f=[],g=[],h=[];d.next=function(){var b=[];if(0===e)return e++,h.slice();for(var d=1,i=e-1;1==(1&i);)i>>=1,d++;for(c=0;a>c;c++)g[c]^=f[c][d],b[c]=g[c]/lc;return e++,b},d.dimension=function(){return a},d.count=function(){return e};var i=[];for(c=0;kc>=c;c++)i.push(0);for(c=0;a>c;c++)f[c]=i.slice(),g[c]=0,h[c]=0;if(a>nc.length)throw new Error("Out of range dimension");for(b=nc,c=1;kc>=c;c++)f[0][c]=1<<kc-c;for(var j=1;a>j;j++){var k=b[j].split(/\s+/),l=+k[1],m=+k[2],n=[0];for(c=0;l>c;c++)n.push(+k[3+c]);for(c=1;l>=c;c++)f[j][c]=n[c]<<kc-c;for(c=l+1;kc>=c;c++){f[j][c]=f[j][c-l]^f[j][c-l]>>l;for(var o=1;l-1>=o;o++)f[j][c]^=(m>>l-1-o&1)*f[j][c-o]}}return d},a.canvas.arc=function(){function a(){var d=Math.max(0,+c.apply(a,arguments)),e=Math.max(0,+f.apply(a,arguments)),l=i.apply(a,arguments)-hc,m=j.apply(a,arguments)-hc,n=Math.abs(m-l),o=l>m?0:1;if(d>e&&(p=e,e=d,d=p),b.beginPath(),n>=gc)return b.arc(0,0,e,0,fc,!1),d&&b.arc(0,0,d,0,fc,!0),void b.closePath();var p,s,t,u,v,w,z=(+k.apply(a,arguments)||0)/2,A=0,B=0,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null;if(z&&(t=h===Jb?Math.sqrt(d*d+e*e):+h.apply(a,arguments),o||(B*=-1),e&&(B=r(t/e*Math.sin(z))),d&&(A=r(t/d*Math.sin(z)))),e){if(C=e*Math.cos(l+B),D=e*Math.sin(l+B),E=e*Math.cos(m-B),F=e*Math.sin(m-B),w=Math.abs(m-l-2*B)<=ec?0:1,B&&x(C,D,E,F)===o^w){var K=(l+m)/2;C=e*Math.cos(K),D=e*Math.sin(K),E=F=null}}else C=D=0;if(d){if(G=d*Math.cos(m-A),H=d*Math.sin(m-A),I=d*Math.cos(l+A),J=d*Math.sin(l+A),v=Math.abs(l-m+2*A)<=ec?0:1,A&&x(G,H,I,J)===1-o^v){var L=(l+m)/2;G=d*Math.cos(L),H=d*Math.sin(L),I=J=null}}else G=H=0;if((p=Math.min(Math.abs(e-d)/2,+g.apply(a,arguments)))>.001){s=e>d^o?0:1;var M=null===I?[G,H]:null===E?[C,D]:q([C,D],[I,J],[E,F],[G,H]),N=C-M[0],O=D-M[1],P=E-M[0],Q=F-M[1],R=1/Math.sin(Math.acos((N*P+O*Q)/(Math.sqrt(N*N+O*O)*Math.sqrt(P*P+Q*Q)))/2),S=Math.sqrt(M[0]*M[0]+M[1]*M[1]);if(null!==E){var T=Math.min(p,(e-S)/(R+1)),U=y(null===I?[G,H]:[I,J],[C,D],e,T,o),V=y([E,F],[G,H],e,T,o);p===T?(u=1-o^x(U[1][0],U[1][1],V[1][0],V[1][1]),oc(b,U[0],U[1],T,0,s),oc(b,U[1],V[1],e,u,o),oc(b,V[1],V[0],T,0,s)):oc(b,U[0],V[0],T,1,s)}else b.moveTo(C,D);if(null!==I){var W=Math.min(p,(d-S)/(R-1)),X=y([C,D],[I,J],d,-W,o),Y=y([G,H],null===E?[C,D]:[E,F],d,-W,o);b.lineTo(Y[0][0],Y[0][1]),p===W?(u=o^x(Y[1][0],Y[1][1],X[1][0],X[1][1]),b.lineTo(Y[0][0],Y[0][1]),oc(b,Y[0],Y[1],W,0,s),oc(b,Y[1],X[1],d,u,1-o),oc(b,X[1],X[0],W,0,s)):oc(b,Y[0],X[0],W,0,s)}else b.lineTo(G,H)}else null!==E&&oc(b,[C,D],[E,F],e,w,o),b.lineTo(G,H),null!==I&&oc(b,[G,H],[I,J],d,v,1-o);b.closePath()}var b,c=s,f=t,g=d,h=Jb,i=u,j=v,k=w;return a.context=function(c){return arguments.length?(b=c,a):b},a.innerRadius=function(b){return arguments.length?(c=e(b),a):c},a.outerRadius=function(b){return arguments.length?(f=e(b),a):f},a.cornerRadius=function(b){return arguments.length?(g=e(b),a):g},a.padRadius=function(b){return arguments.length?(h=b==Jb?Jb:e(b),a):h},a.startAngle=function(b){return arguments.length?(i=e(b),a):i},a.endAngle=function(b){return arguments.length?(j=e(b),a):j},a.padAngle=function(b){return arguments.length?(k=e(b),a):k},a.centroid=function(){var b=(+c.apply(a,arguments)+f.apply(a,arguments))/2,d=(+i.apply(a,arguments)+j.apply(a,arguments))/2-hc;return[Math.cos(d)*b,Math.sin(d)*b]},a};var oc=a.canvas.drawArc=function(a,b,c,d,e,f){var g=b[0]-c[0],h=b[1]-c[1],i=g*g+h*h,j=Math.sqrt(i),k=.5*(b[0]+c[0]),l=.5*(b[1]+c[1]),m=Math.sqrt(d*d-.25*i);f>0?(k+=m*h/j,l-=m*g/j):(k-=m*h/j,l+=m*g/j);var n=Math.atan2(b[1]-l,b[0]-k),o=Math.atan2(c[1]-l,c[0]-k);a.arc(k,l,d,n,o,0>=f)};a.canvas.area=function(){return K(c)},a.canvas.axis=function(){function b(a){a.each(function(){var a,b=this.getContext("2d"),m=(this.__chart__||d,this.__chart__=d.copy()),n=null===k?m.ticks?m.ticks.apply(m,j):m.domain():k,o=null===l?m.tickFormat?m.tickFormat.apply(m,j):c:l,p=Math.max(f,0)+i,q="top"===e||"left"===e?-1:1,r=g(m);"bottom"===e||"top"===e?(b.textBaseline=0>q?"bottom":"top",b.textAlign="center",b.moveTo(r[0],0),b.lineTo(r[1],0),b.moveTo(r[0],0),b.lineTo(r[0],q*h),b.moveTo(r[1],0),b.lineTo(r[1],q*h),n.forEach(function(c){a=m(c),b.moveTo(a,0),b.lineTo(a,q*f),b.fillText(o(c),a,q*p)})):(b.textBaseline="middle",b.textAlign=0>q?"end":"start",b.moveTo(0,r[0]),b.lineTo(0,r[1]),b.moveTo(0,r[0]),b.lineTo(q*h,r[0]),b.moveTo(0,r[1]),b.lineTo(q*h,r[1]),n.forEach(function(c){a=m(c),b.moveTo(0,a),b.lineTo(q*f,a),b.fillText(o(c),q*p,a)}))})}var d=a.scale.linear(),e=pc,f=6,h=6,i=3,j=[10],k=null,l=null;return b.scale=function(a){return arguments.length?(d=a,b):d},b.orient=function(a){return arguments.length?(e=a in qc?a+"":pc,b):e},b.ticks=function(){return arguments.length?(j=arguments,b):j},b.tickValues=function(a){return arguments.length?(k=a,b):k},b.tickFormat=function(a){return arguments.length?(l=a,b):l},b.tickSize=function(a){var c=arguments.length;return c?(f=+a,h=+arguments[c-1],b):f},b.innerTickSize=function(a){return arguments.length?(f=+a,b):f},b.outerTickSize=function(a){return arguments.length?(h=+a,b):h},b.tickPadding=function(a){return arguments.length?(i=+a,b):i},b.tickSubdivide=function(){return arguments.length&&b},b};var pc="bottom",qc={top:1,right:1,bottom:1,left:1};a.canvas.brush=function(){function b(b){b.each(function(){a.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",j).on("touchstart.brush",j).on("mousemove.brushover",i),p.brushstart.call(this),p.brush.call(this),p.brushend.call(this),c(this.getContext("2d"))})}function c(a){m&&(d(a),a.fillStyle=m,a.fill())}function d(a){var b,c;a.beginPath(),q&r?(b=q(extent[0][0]),c=r(extent[1][0])):q?(b=s[0],a.rect(b+x[0],x[1],s[1]-b,x[3]||a.canvas.height)):r&&a.rect(0,extent[0][0],a.canvas.width,extent[0][1]-extent[0][0])}function f(){}function h(a,b){var c=s[b];a.beginPath(),a.rect(c-z+x[0],x[1],2*z,x[3]||a.canvas.height)}function i(){var b=a.select(this),c=this.getContext("2d"),e=a.canvas.mouse(this),f=e[0],g=e[1],i="";r&&(n(c,0),c.isPointInPath(f,g)?i="s":(n(c,1),c.isPointInPath(f,g)&&(i="n"))),q&&(o(c,0),c.isPointInPath(f,g)?i+="w":(h(c,1),c.isPointInPath(f,g)&&(i+="e"))),d(c),i?b.style("cursor",Kb[i]).datum(i).classed("extent",!1):c.isPointInPath(f,g)?b.style("cursor","move").classed("extent",!0).datum(""):b.style("cursor","crosshair").classed("extent",!1).datum("")}function j(){function b(){32==a.event.keyCode&&(A||(i=null,o[0]-=s[1],o[1]-=t[1],A=2),a.event.preventDefault())}function d(){32==a.event.keyCode&&2==A&&(o[0]+=s[1],o[1]+=t[1],A=0,a.event.preventDefault())}function e(){var b=a.canvas.mouse(m);a.canvas.clear(n),j&&(b[0]+=j[0],b[1]+=j[1]),A||(a.event.altKey?(i||(i=[(s[0]+s[1])/2,(t[0]+t[1])/2]),o[0]=s[+(b[0]<i[0])],o[1]=t[+(b[1]<i[1])]):i=null);var d={type:"brush"};(y&&f(b,q,0)||z&&f(b,r,1))&&(d.mode=A?"move":"resize"),p.brush.call(n,{type:"brush",mode:A?"move":"resize"}),c(n)}function f(a,b,c){var d,e,f=g(b),h=f[0],j=f[1],m=o[c],n=c?t:s,p=n[1]-n[0];return A&&(h-=m,j-=p+m),d=(c?v:u)?Math.max(h,Math.min(j,a[c])):a[c],A?e=(d+=m)+p:(i&&(m=Math.max(h,Math.min(j,2*i[c]-d))),d>m?(e=d,d=m):e=m),n[0]!=d||n[1]!=e?(c?l=null:k=null,n[0]=d,n[1]=e,!0):void 0}function h(){e(),a.select("body").style("cursor",null),B.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),p.brushend.call(n,{type:"brushend"})}var i,j,m=this,n=m.getContext("2d"),o=a.canvas.mouse(m),w=a.select(m),x=w.datum(),y=!/^(n|s)$/.test(x)&&q,z=!/^(e|w)$/.test(x)&&r,A=w.classed("extent"),B=a.select(window).on("keydown.brush",b).on("keyup.brush",d);if(a.event.changedTouches?B.on("touchmove.brush",e).on("touchend.brush",h):B.on("mousemove.brush",e).on("mouseup.brush",h),w.interrupt().selectAll("*").interrupt(),A)o[0]=s[0]-o[0],o[1]=t[0]-o[1];else if(x){var C=+/w$/.test(x),D=+/^n/.test(x);j=[s[1-C]-o[0],t[1-D]-o[1]],o[0]=s[C],o[1]=t[D]}else a.event.altKey&&(i=o.slice());a.select("body").style("cursor",w.style("cursor")),p.brushstart({type:"brushstart"}),e()}var k,l,m,n,o,p=a.dispatch("brushstart","brush","brushend"),q=null,r=null,s=[0,0],t=[0,0],u=!0,v=!0,w=Lb[0],x=[0,0,0,0],y=window.devicePixelRatio||1,z=3*y;return b.draw_sn=function(a){return arguments.length?(n=e(a),b):n},b.draw_we=function(a){return arguments.length?(o=e(a),b):o},b.fillStyle=function(a){return arguments.length?(m=a,b):m},b.rect=function(a){return arguments.length?(x=a,b):x},b.x=function(a){return arguments.length?(q=a,w=Lb[!q<<1|!r],b):q},b.y=function(a){return arguments.length?(r=a,w=Lb[!q<<1|!r],b):r},b.clamp=function(a){return arguments.length?(q&&r?(u=!!a[0],v=!!a[1]):q?u=!!a:r&&(v=!!a),b):q&&r?[u,v]:q?u:r?v:null},b.extent=function(a){var c,d,e,f,g;return arguments.length?(q&&(c=a[0],d=a[1],r&&(c=c[0],d=d[0]),k=[c,d],q.invert&&(c=q(c),d=q(d)),c>d&&(g=c,c=d,d=g),(c!=s[0]||d!=s[1])&&(s=[c,d])),r&&(e=a[0],f=a[1],q&&(e=e[1],f=f[1]),l=[e,f],r.invert&&(e=r(e),f=r(f)),e>f&&(g=e,e=f,f=g),(e!=t[0]||f!=t[1])&&(t=[e,f])),b):(q&&(k?(c=k[0],d=k[1]):(c=s[0],d=s[1],q.invert&&(c=q.invert(c),d=q.invert(d)),c>d&&(g=c,c=d,d=g))),r&&(l?(e=l[0],f=l[1]):(e=t[0],f=t[1],r.invert&&(e=r.invert(e),f=r.invert(f)),e>f&&(g=e,e=f,f=g))),q&&r?[[c,e],[d,f]]:q?[c,d]:r&&[e,f])},b.clear=function(){return b.empty()||(s=[0,0],t=[0,0],k=l=null),b},b.empty=function(){return!!q&&s[0]==s[1]||!!r&&t[0]==t[1]},b.draw_sn(f).draw_we(h),a.rebind(b,p,"on")},a.canvas.pixelRatio=window.devicePixelRatio||1,a.canvas.clear=function(a){a.beginPath(),a.closePath(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,a.canvas.width,a.canvas.height)},a.canvas.retinaScale=function(b,c,d){return b.canvas.width=c,b.canvas.height=d,window.devicePixelRatio&&(b.canvas.style.width=c+"px",b.canvas.style.height=d+"px",b.canvas.width=c*window.devicePixelRatio,b.canvas.height=d*window.devicePixelRatio,b.scale(window.devicePixelRatio,window.devicePixelRatio)),a.canvas.clear(b),a.canvas.pixelRatio},a.canvas.resize=function(b,c,d){return b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,b.canvas.width,b.canvas.height),a.canvas.retinaScale(b,c,d)},a.canvas.drawPolygon=function(a,b,c){c>0&&(b=M(b,c));var d,e,f=b.length;for(a.beginPath(),d=0;f>d;d++)e=b[d],0===d?a.moveTo(e[0],e[1]):a.lineTo(e[0],e[1]),c>0&&a.quadraticCurveTo(e[2],e[3],e[4],e[5]);a.closePath()},a.canvas.rgba=function(b,c){if(1>c){var d=a.rgb(b);return"rgba("+d.r+","+d.g+","+d.b+","+c+")"}return b},a.canvas.mouse=function(b){var c=a.mouse(b);return b.getContext&&window.devicePixelRatio&&(c[0]*=window.devicePixelRatio,c[1]*=window.devicePixelRatio),c},a.canvas.line=function(){return O(c)};var rc=a.map({linear:Q,"linear-closed":R,step:S,"step-before":T,"step-after":U,basis:V,"basis-open":W,"basis-closed":X,bundle:Y,cardinal:Z,"cardinal-open":$,"cardinal-closed":_,monotone:ab});T.reverse=U,U.reverse=T,a.canvas.symbol=function(){function b(a,d){return(sc.get(f.call(b,a,d))||db)(c,g.call(b,a,d))}var c,d=a.svg.symbol(),f=d.type(),g=d.size();return b.type=function(a){return arguments.length?(f=e(a),b):f},b.size=function(a){return arguments.length?(g=e(a),b):g},b.context=function(a){return arguments.length?(c=a,b):c},b};var sc=a.map({circle:db,cross:function(a,b){var c=Math.sqrt(b/5)/2,d=3*c;a.beginPath(),a.moveTo(-d,-c),a.lineTo(-c,-c),a.lineTo(-c,-d),a.lineTo(c,-d),a.lineTo(c,-c),a.lineTo(d,-c),a.lineTo(d,c),a.lineTo(c,c),a.lineTo(c,d),a.lineTo(-c,d),a.lineTo(-c,c),a.lineTo(-d,c),a.closePath()},diamond:function(a,b){var c=Math.sqrt(b/(2*uc)),d=c*uc;a.beginPath(),a.moveTo(0,-c),a.lineTo(d,0),a.lineTo(0,c),a.lineTo(-d,0),a.closePath()},square:function(a,b){var c=Math.sqrt(b);a.beginPath(),a.rect(-.5*c,-.5*c,c,c),a.closePath()},"triangle-down":function(a,b){var c=Math.sqrt(b/tc),d=c*tc/2;a.beginPath(),a.moveTo(0,d),a.lineTo(c,-d),a.lineTo(-c,-d),a.closePath()},"triangle-up":function(a,b){var c=Math.sqrt(b/tc),d=c*tc/2;a.beginPath(),a.moveTo(0,-d),a.lineTo(c,d),a.lineTo(-c,d),a.closePath()}});a.canvas.symbolTypes=sc.keys();var tc=Math.sqrt(3),uc=Math.tan(30*ic);a.canvas.transition=function(b,c){var d=a.transition(b,c);return d},Fb.defaults={},Fb.defaults.axis={tickSize:"6px",outerTickSize:"6px",tickPadding:"3px",lineWidth:1,min:null,max:null},Fb.defaults.transition={duration:0,ease:"easeInOutCubic"},Fb.defaults.paper={type:"svg",resizeDelay:200,resize:!0,margin:{top:20,right:20,bottom:20,left:20},xaxis:Pb({position:"bottom"},Fb.defaults.axis),yaxis:{position:"left",min:null,max:null},yaxis2:{position:"right",min:null,max:null},colors:a.scale.category10().range(),colorIndex:0,css:null,activeEvents:["mousemove","touchstart","touchmove","mouseout"],line:{interpolate:"cardinal",colorOpacity:1,fillOpacity:.4,lineWidth:2,transition:Pb({},Fb.defaults.transition),fill:"color"},point:{symbol:"circle",size:"8px",fill:!0,fillOpacity:1,colorOpacity:1,lineWidth:2,active:{fill:"darker",color:"brighter",size:"150%"},transition:Pb({},Fb.defaults.transition)},bar:{width:"auto",color:null,fill:!0,fillOpacity:1,colorOpacity:1,lineWidth:1,radius:4,active:{fill:"darker",color:"brighter"},transition:Pb({},Fb.defaults.transition)},pie:{lineWidth:1,padAngle:0,cornerRadius:0,fillOpacity:.7,colorOpacity:1,innerRadius:0,startAngle:0,active:{fill:"darker",color:"brighter",fillOpacity:1},transition:Pb({},Fb.defaults.transition)},font:{color:"#444",size:"11px",weight:"normal",lineHeight:13,style:"normal",family:"sans-serif",variant:"small-caps"}},Fb.defaults.viz=Pb({onInit:null,events:["build","change","start","tick","end"],contextmenu:[{label:"Open Image",callback:function(a){window.open(a.image())}}]}),Fb.constants={DEFAULT_VIZ_GROUP:"default_viz_group",WIDTH:400,HEIGHT:300,leaflet:"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"},Fb.gradient=function(){function b(b){b.each(function(){if("canvas"===this.tagName.toLowerCase()){var b=this.getContext("2d");"linear"===k?d(b):radial_canvas(b)}else{var e=a.select(this),f=A(e),g="grad-"+f,h=B(e);h.select("#"+g).remove();var i="linear"===k?c(h):radialsvg(h);i.attr("id",g),e.attr("fill","url(#"+g+")")}})}function c(a){var b=a.append("linearGradient").attr("x1","0%").attr("y1","0%");return"x"===j?b.attr("x2","100%").attr("y2","0%"):b.attr("y2","100%").attr("x2","0%"),e.forEach(function(a){b.append("stop").attr("offset",a.offset+"%").attr("stop-color",a.color).attr("stop-opacity",void 0===a.opacity?1:a.opacity)}),b}function d(a){var b;b="x"===j?a.createLinearGradient(f,h,g,h):a.createLinearGradient(f,h,f,i),e.forEach(function(a){b.addColorStop(.01*a.offset,a.color)}),a.fillStyle=b,a.fill()}var e=[{color:"#000",opacity:1,offset:0},{color:"#fff",opacity:1,offset:100}],f=0,g=200,h=0,i=200,j="y",k="linear";return b.direction=function(a){return arguments.length?(j=a,b):j},b.colors=function(a){return arguments.length?(e=a,b):e},b.y1=function(a){return arguments.length?(h=a,b):h},b.y2=function(a){return arguments.length?(i=a,b):i},b};var vc=0;Fb.paper=function(b,c){function d(a){return a||(a={}),a.yaxis&&1!==a.yaxis?2===a.yaxis&&(a.yaxis=c.yaxis2):a.yaxis=c.yaxis,Qb(c,a)}var e=a.dispatch.apply({},Ub(["change"],c.activeEvents)),f=++vc,g=!1;e.group=function(a){a=d(a);var b,f=Fb.group[a.type](e,a);f.element().classed(c.giotto,!0);for(var g=0;g<Fb.paper.plugins.length;++g)b=Fb.paper.plugins[g][a.type],b&&b(f,a);return f},e.uid=function(){return f},e.size=function(){return[c.size[0],c.size[1]]},e.select=function(a){var b,d=e.svg().selectAll("."+c.giotto);return a&&(d=d.filter(a)),(b=d.node())?b.__group__:(d=e.canvas().selectAll("."+c.giotto),a&&(d=d.filter(a)),b=d.node(),b?b.__group__:void 0)},e.each=function(a,b){return 1===arguments.length&&(b=a,a="*"),e.svg().selectAll(a).each(function(){this.__group__&&b.call(this.__group__)}),e.canvas().selectAll(a).each(function(){this.__group__&&b.call(this.__group__)}),e},e.clear=function(){return e.svg().remove(),e.canvas().remove(),e.canvasOverlay().remove(),c.colorIndex=0,e},e.render=function(){var b=e.canvasBackground().node(),c=e.canvasOverlay().node();return b&&a.canvas.clear(b.getContext("2d")),c&&a.canvas.clear(c.getContext("2d")),e.each(function(){this.render()}),e},e.element=function(){return a.select(b)},e.classGroup=function(a,b){var c=e.select("."+a);return c||(c=e.group(b),c.element().classed(a,!0)),c},e.resize=function(a){g=!0,a||(a=e.boundingBox()),(c.size[0]!==a[0]||c.size[1]!==a[1])&&(c.size[0]=a[0],c.size[1]=a[1],e.canvasOverlay(),e.canvasBackground(!1,!0),e.each(function(){this.resize()}),e.change()),g=!1},e.boundingBox=function(){var b,d=c.elwidth?C(c.elwidth):c.size[0];return b=c.height_percentage?a.round(d*c.height_percentage,0):c.elheight?D(c.elheight):c.size[1],c.min_height&&(b=Math.max(b,c.min_height)),[d,b]},e.pickColor=function(b,d){0===arguments.length&&(b=c.colorIndex++);for(var e=1,f=0;b>=c.colors.length;)b-=c.colors.length,f+=e;var g=c.colors[b];return d&&(g=a.rgb(g).darker(d).toString()),f&&(g=a.rgb(g).brighter(f).toString()),g},e.options=function(){return c},e.svg=function(a){var b=e.element().select("svg.giotto");return!b.node()&&a&&(b=e.element().append("svg").attr("class","giotto").attr("width",c.size[0]).attr("height",c.size[1])),c.resize||b.attr("viewBox","0 0 "+c.size[0]+" "+c.size[1]),b},e.svgBackground=function(a){var b=e.svg();if(b.size()){var c=b.select(".giotto-background");return!c.size()&&a&&(c=b.insert("g","*").classed("giotto-background",!0)),c}},e.canvas=function(a){var b=e.element().select("div.canvas-container");return!b.node()&&a&&(b=e.element().append("div").attr("class","canvas-container").style("position","relative")),b},e.canvasBackground=function(b,d){var f=e.canvas();if(f.size()){var g=f.select(".giotto-background"),h=g.node();return!h&&b&&(f.selectAll("*").style({position:"absolute",top:"0",left:"0"}),g=f.insert("canvas","*").classed("giotto-background",!0),a.canvas.retinaScale(g.node().getContext("2d"),c.size[0],c.size[1])),h&&d&&a.canvas.resize(h.getContext("2d"),c.size[0],c.size[1]),g}return f},e.canvasOverlay=function(){var b=e.element().select(".canvas-overlay"),d=b.node();return!d&&e.canvas().node()?(b=e.element().append("canvas").attr("class","canvas-overlay").style({position:"absolute",top:"0",left:"0"}),d=b.node(),a.canvas.retinaScale(d.getContext("2d"),c.size[0],c.size[1])):d&&a.canvas.resize(d.getContext("2d"),c.size[0],c.size[1]),b},e.canvasDataAtPoint=function(a){var b=[];return e.canvas().selectAll("*").each(function(){this.__group__&&this.__group__.dataAtPoint(a,b)}),b},e.encodeSVG=function(){var a=e.svg();return a.node()?btoa(unescape(encodeURIComponent(a.attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML))):void 0},e.imageSVG=function(){var a=e.encodeSVG();return a?"data:image/svg+xml;charset=utf-8;base64,"+a:void 0},e.imagePNG=function(){var a=e.canvas();if(a.node()){var b,c=e.group({type:"canvas",margin:{left:0,right:0,top:0,bottom:0}}),d=c.context();a.selectAll("*").each(function(){this.__group__!==c&&(b=new Image,b.src=this.getContext("2d").canvas.toDataURL(),d.drawImage(b,0,0,d.canvas.width,d.canvas.height))});var f=d.canvas.toDataURL();return c.remove(),f}},e.image=function(){return"svg"===c.type?e.imageSVG():e.imagePNG()},Vb(b)&&(c=b,b=null),b||(b=document.createElement("div")),c=Cb(b,c);var h=c.type;return e.type=function(){return h},c.css&&_b("#giotto-paper-"+e.uid(),c.css),c.resize&&a.select(window).on("resize.paper"+e.uid(),function(){g||(c.resizeDelay?(g=!0,a.timer(function(){return e.resize(),!0},c.resizeDelay)):e.resize())}),e},Fb.paper.plugins=[],Fb.paper.plugin=function(a,b){Fb.defaults.paper[a]=b.defaults,Fb.paper.plugins.push(b)},Fb.group=function(b,c,d,e){var f=[],g=1,h=!1,i=!1,j=d.type,k=a[j],l=k.axis(),m=k.axis(),n={};l.options=function(){return d.xaxis},m.options=function(){return d.yaxis},c.__group__=n,n.type=function(){return j},n.element=function(){return a.select(c)},n.options=function(){return d},n.xaxis=function(){return l},n.yaxis=function(){return m},n.paper=function(){return b},n.width=function(){return g*d.size[0]},n.height=function(){return g*d.size[1]},n.factor=function(a){return arguments.length?(g=+a,n.resetAxis()):g},n.size=function(){return[n.width(),n.height()]},n.innerWidth=function(){return g*(d.size[0]-d.margin.left-d.margin.right)},n.innerHeight=function(){return g*(d.size[1]-d.margin.top-d.margin.bottom)},n.aspectRatio=function(){return n.innerHeight()/n.innerWidth()},n.marginLeft=function(){return g*d.margin.left},n.marginRight=function(){return g*d.margin.right},n.marginTop=function(){return g*d.margin.top},n.marginBottom=function(){return g*d.margin.bottom},n.add=function(a){return Xb(a)&&(a=eb(n,a)),f.push(a),a},n.each=function(a){for(var b=0;b<f.length;++b)a.call(f[b]);return n},n.render=function(){if(!h){h=!0;for(var a=0;a<f.length;++a)f[a].render();return h=!1,n}},n.rendering=function(){return h},n.remove=function(a){for(var b,c=0;c<f.length;++c)if(b=f[c],a){if(b.name()===a)return b.remove(),f.splice(c,1)}else b.remove();return a||(f=[],n.clear()),n},n.resize=function(a){return i=!0,e.resize(n,a),i=!1,n},n.resizing=function(){return i},n.path=function(a,c){return c||(c={}),Ab(n,c),yb(b,Qb(d.line,c)),n.add(e.path(n)).size(Bc).data(a).options(c)},n.points=function(a,c){return c||(c={}),Ab(n,c),yb(b,Qb(d.point,c)),n.add(e.points).size(Bc).options(c).dataConstructor(o).data(a)},n.barchart=function(a,c){return c||(c={}),Ab(n,c),yb(b,Qb(d.bar,c)),n.add(e.barchart).size(Cc).options(c).dataConstructor(p).data(a)},n.pie=function(b,c){return c||(c={}),Ab(n,c),Qb(d.pie,c),n.add(eb(n,function(){var b,c,d=n.innerWidth(),f=n.innerHeight(),g=this.options(),h=.5*Math.min(d,f),i=g.innerRadius*h,j=n.scale(n.dim(g.cornerRadius)),l=this.y(),m=this.data(),o=a.layout.pie().value(function(a){return l(a.data)}).padAngle(ic*g.padAngle).startAngle(ic*g.startAngle)(m);this.arc=k.arc().cornerRadius(j).innerRadius(function(a){return a.innerRadius}).outerRadius(function(a){return a.outerRadius});for(var p=0;p<o.length;++p)b=o[p],c=b.data,c.set("innerRadius",i),c.set("outerRadius",h),delete b.data,m[p]=Pb(c,b);return e.pie(this,d,f)})).options(c).dataConstructor(q).data(b)},n.drawXaxis=function(){return n.add(e.axis(n,l,"x-axis")).options(d.xaxis)},n.drawYaxis=function(){return n.add(e.axis(n,m,"y-axis")).options(d.yaxis)},n.scalex=function(a){return l.scale()(a)},n.scaley=function(a){return m.scale()(a)},n.scale=function(a){var b=l.scale();return Math.max(0,b(a)-b(0))},n.xfromPX=function(a){var b=l.scale().invert;return b(g*a)-b(0)},n.yfromPX=function(a){var b=m.scale().invert;return b(g*a)-b(0)},n.dim=function(a){if(!a)return 0;var b=+a;if(isNaN(b))return n.xfromPX(a.substring(0,a.length-2));var c=n.xaxis().scale().domain();return b*(c[c.length-1]-c[0])},n.x=function(a){var b=l.scale().domain();return a*(b[b.length-1]-b[0])+b[0]},n.y=function(a){var b=m.scale().domain();return a*(b[b.length-1]-b[0])+b[0]},n.resetAxis=function(){return l.scale().range([0,n.innerWidth()]),m.scale().range([n.innerHeight(),0]),[l,m].forEach(function(a){var b=a.options(),c=n.scale(n.dim(b.tickSize)),d=n.scale(n.dim(b.outerTickSize)),e=n.scale(n.dim(b.tickPadding));a.tickSize(c,d).tickPadding(e).orient(b.position),(Zb(b.min)||Zb(b.max))&&(b.auto=!0)}),n};var o=function(a){for(var b=this.group(),c=b.scale(b.dim(this.options().size)),d=[],f=0;f<a.length;f++)d.push(e.point(this,a[f],c));return d},p=function(b){var c=this.group(),d=this,f=this.options(),g=[],h=f.width;"auto"===h&&(h=function(){return a.round(.8*(c.innerWidth()/d.data().length))});for(var i=0;i<b.length;i++)g.push(e.bar(this,b[i],h));return g},q=function(a){for(var b=[],c=0;c<a.length;c++)b.push(e.pieslice(this,a[c]));return b};return n.resetAxis()};var wc={circle:.7,cross:.7,diamond:.7,"triangle-up":.6,"triangle-down":.6},xc=["fill","color","fillOpacity","colorOpacity","lineWidth"],yc=Ub(["size","symbol"],xc),zc=Ub(["innerRadius","outerRadius"],xc),Ac=function(a){return a.size},Bc=function(a){var b=+a.size;if(isNaN(b)){var c=a.group();b=c.scale(c.xfromPX(a.size.substring(0,a.size.length-2)))}return b*b*(wc[a.symbol]||1)},Cc=function(a){var b=a.size;return"function"==typeof b&&(b=b()),b};Fb.group.svg=function(a,b){var c=a.svg(!0),d=b.before?c.insert("g",b.before):c.append("g"),e=Db(a,b);delete b.before,d.attr("transform","translate("+b.margin.left+","+b.margin.top+")");var f=Fb.group(a,d.node(),b,e);return f.clear=function(){return f.element().selectAll("*").remove(),f},f.setBackground=function(a,b){return b?(Vb(a)&&(void 0!==a.fillOpacity&&b.attr("fill-opacity",a.fillOpacity),a=a.fill),Wb(a)&&b.attr("fill",a),f):void 0},f},Fb.group.canvas=function(b,c){var d=b.canvas(!0),e=c.before?d.insert("canvas",c.before):d.append("canvas"),f=e.node().getContext("2d"),g=qb(b,c);delete c.before,d.selectAll("*").style({position:"absolute",top:"0",left:"0"}),d.select("*").style({position:"relative"});var h=Fb.group(b,e.node(),c,g),i=h.render;return h.render=function(){a.canvas.clear(f);var b=h.factor();return f.translate(b*c.margin.left,b*c.margin.top),i()},h.clear=function(){return a.canvas.clear(f),h},h.context=function(){return f},h.dataAtPoint=function(a,b){var c,d=a[0],e=a[1];h.each(function(){this.each(function(){c=this.inRange(d,e),c===!0?b.push(this):c&&b.push(c)})})},h.transform=function(a){var b=h.factor();return a.setTransform(1,0,0,1,0,0),a.translate(b*c.margin.left,b*c.margin.top),h},h.setBackground=function(b,c){return c=c||f,Vb(b)?c.fillStyle=a.canvas.rgba(b.fill,b.fillOpacity):Wb(b)&&(c.fillStyle=b),h},h.factor(g.scale(h))},Fb.viz={},Fb.vizplugins=[],Fb.vizplugin=function(a){Fb.vizplugins.push(a)},Fb.createviz=function(b,c,d){var e=[],f=function(b,c){Vb(b)&&(c=b,b=null),c=Pb({},f.defaults,c);var g,h={},i=++vc,j=a.dispatch.apply(a,c.events),k=0,l=!1;for(c.event=j,h.vizType=function(){return f},h.vizName=function(){return f.vizName()},h.uid=function(){return i},h.paper=function(a){return(a||void 0===g)&&(g&&g.clear(),g=Fb.paper(b,c)),g},h.element=function(){return h.paper().element()},h.clear=function(){return h.paper().clear(),h},h.alpha=function(b){return arguments.length?(b=+b,k?k=b>0?b:0:b>0&&(j.start({type:"start",alpha:k=b}),a.timer(h.tick)),h):k},h.resume=function(){return h.alpha(.1)},h.stop=function(){return h.alpha(0)},h.tick=function(){return c.scope&&c.scope.stats&&c.scope.stats.begin(),(k*=.99)<.005?(j.end({type:"end",alpha:k=0}),!0):(j.tick({type:"tick",alpha:k}),void(c.scope&&c.scope.stats&&c.scope.stats.end()))},h.start=function(){return h.resume()},h.render=function(){return g.render(),h},h.loadData=function(b){return c.src&&!l?(l=!0,Fb.log.info("Giotto loading data from "+c.src),a.json(c.src,function(a,c){l=!1,a||h.setData(c,b)})):void 0},h.setData=function(a,b){c.processData&&(a=c.processData(a)),Object(a)===a&&a.data?Pb(c,a):c.data=a,b&&b()},h.options=function(){return c},h.image=function(){return g.image()},h.xyfunction=Fb.math.xyfunction,a.rebind(h,j,"on"),d&&d(h,c),m=0;m<Fb.vizplugins.length;++m)Fb.vizplugins[m](h,c);
for(var m=0;m<e.length;++m)e[m](h,c);if(c.onInit){var n=$b(c.onInit);Xb(n)?n(h,c):Fb.log.error("Could not locate onInit function "+c.onInit)}return h};return Fb.viz[b]=f,f.defaults=Pb({},Fb.defaults.viz,Fb.defaults.paper,c),f.vizName=function(){return b},f.plugin=function(a){e.push(a)},f},Fb.createviz("viz"),Fb.createviz("chart",{margin:{top:30,right:30,bottom:30,left:30},chartTypes:["pie","bar","line","point"],serie:{x:function(a){return a[0]},y:function(a){return a[1]}}},function(a,b){function c(c){var d,h,i,j=Pb({},b.serie);if(c&&!Yb(c)&&(Pb(j,c),c=j.data,delete j.data),c){if(j.index=f.length,f.push(j),j.label||(j.label="serie "+f.length),b.chartTypes.forEach(function(a){var c=j[a];Yb(c)&&!j.data&&(j.data=c,c={}),(c||b[a].show)&&(j[a]=Pb({},b[a],c),i=!0)}),i||(j.line=Pb({},b.line)),b.chartTypes.forEach(function(b){var c=j[b];c&&"pie"!==b&&(h||(h=zb(a.paper(),c)),c.color||(c.color=h))}),!j.pie){void 0===j.yaxis&&(j.yaxis=1),j.axisgroup||(j.axisgroup=1);var k=g[j.axisgroup];k||(j.reference=!0,g[j.axisgroup]=k={}),Vb(j.xaxis)||(j.xaxis=b.xaxis),2===j.yaxis&&(j.yaxis=b.yaxis2),Vb(j.yaxis)||(j.yaxis=b.yaxis)}return j.clear=function(){return d&&d.remove(),d=null,j},j.data=function(a){if(!arguments.length)return c;if(!j.pie){var d,e=g[j.axisgroup],f=e[j.xaxis.position],h=Ec(a,j.x,j.y);a=h.data,f?(f.range[0]=Math.min(f.range[0],h.xrange[0]),f.range[1]=Math.max(f.range[1],h.xrange[1])):(e[j.xaxis.position]=f={range:h.xrange,serie:j},j.drawXaxis=!0),f=e[j.yaxis.position],f?(f.range[0]=Math.min(f.range[0],h.yrange[0]),f.range[1]=Math.max(f.range[1],h.yrange[1])):(e[j.yaxis.position]=f={range:h.yrange,serie:j},j.drawYaxis=!0)}return c=a,b.chartTypes.forEach(function(a){d=j[a],d&&Xb(d.data)&&d.data(c)}),j},j.draw=function(){function c(a){var b=g[j.axisgroup][a.orient()],c=a.options(),e=a.scale();return b.scale=e,c.auto?(e.domain([b.range[0],b.range[1]]).nice(),Zb(c.min)?Zb(c.max)||e.domain([e.domain()[0],c.max]):e.domain([c.min,e.domain()[1]])):e.domain([c.min,c.max]),d}function f(a){var b=g[j.axisgroup][a.orient()];a.scale(b.scale)}var h;return d?(j.drawXaxis?c(d.xaxis()):f(d.xaxis()),j.drawYaxis?c(d.yaxis()):f(d.yaxis())):(b.chartTypes.forEach(function(a){h=j[a],h&&(Xb(h.options)&&(h=h.options()),j[a]=h)}),d=a.paper().classGroup(ac(j.label),Pb({},j)),d.element().classed("chart"+a.uid(),!0),j.reference&&d.element().classed("reference"+a.uid(),!0).classed(e(j.axisgroup),!0),j.drawXaxis?c(d.xaxis()).drawXaxis():j.axisgroup&&f(d.xaxis()),j.drawYaxis?c(d.yaxis()).drawYaxis():j.axisgroup&&f(d.yaxis()),b.chartTypes.forEach(function(a){h=j[a],h&&(j[a]=Dc[a](d,j.data(),h).label(j.label))})),j},j.data(c)}}function d(b){var d=[];return b.forEach(function(b){Xb(b)&&(b=b(a)),b=c(b),b&&d.push(b)}),d}function e(b){return"axisgroup"+a.uid()+"-"+b}var f=[],g={};a.numSeries=function(){return f.length},a.each=function(b){return f.forEach(b),a},a.forEach=a.each,a.addSeries=function(b){return d(b),a},a.addSerie=function(b){return d([b]),a},a.clear=function(){return a.paper().clear(),f=[],a},a.draw=function(c){var e=a.paper();return c=c||b.data,void 0===c&&b.src?(b.data=null,a.loadData(a.draw)):(Xb(c)&&(c=c(a)),b.data=null,(c||b.type!==e.type())&&(c&&d(c),b.type!==e.type()&&(e=a.paper(!0),a.each(function(a){a.clear()}))),a.each(function(a){a.draw()}),a.render())},a.setSerieOption=function(c,d,e){-1!==b.chartTypes.indexOf(c)&&(a.numSeries()?a.each(function(a){a[c]&&a[c].set(d,e)}):b[c][d]=e)},a.axisGroup=function(b){return b&&b.axisgroup?a.paper().select("."+e(b.axisgroup)):void 0},a.on("tick.main",function(){a.stop(),a.draw()})});var Dc={pie:function(a,b,c){return a.pie(b,c)},bar:function(a,b,c){return a.barchart(b,c).x(function(a){return a.x}).y(function(a){return a.y})},line:function(a,b,c){return a.path(b,c).x(function(a){return a.x}).y(function(a){return a.y})},point:function(a,b,c){return a.points(b,c).x(function(a){return a.x}).y(function(a){return a.y})}};Fb.Chart=Fb.viz.Chart;var Ec=function(a,b,c){if(a){a.data||(a={data:a});var d=a.data,e=1/0,f=1/0,g=-1/0,h=-1/0,i=function(a){return e=e>a?a:e,g=a>g?a:g,a},j=function(a){return f=f>a?a:f,h=a>h?a:h,a},k=[];return d.forEach(function(a){k.push({x:i(b(a)),y:j(c(a))})}),a.data=k,a.xrange=[e,g],a.yrange=[f,h],a}};Fb.createviz("force",{theta:.8,friction:.9},function(b,c){function d(a){return a.weight=0,isNaN(a.x)&&(a.x=l(Math.random())),isNaN(a.y)&&(a.y=m(Math.random())),a}var e,f,g,h,i,j=[],k=[],l=a.scale.linear(),m=a.scale.linear();b.nodes=function(a){if(!arguments.length)return j;for(e=null,j=a,h=0;h<j.length;++h)d(j[h]).index=h;return b},b.scalex=function(a){return arguments.length?(l=a,b):l},b.scaley=function(a){return arguments.length?(m=a,b):m},b.addNode=function(a){return a.index=j.length,j.push(d(a)),b},b.theta=function(a){return arguments.length?(c.theta=a,b):+c.theta},b.friction=function(a){return arguments.length?(c.friction=a,b):+c.friction},b.quadtree=function(b){return(!g||b)&&(g=a.geom.quadtree(j)),g},b.addForce=function(a){k.push(a)},b.drawPoints=function(a){var d=c.colors,e=0;for(a||(a=b.paper().classGroup("force")),h=0;h<j.length;h++)j[h].fill||(j[h].fill=d[e%d.length],e++);return a.points(j)},b.drawQuadTree=function(a){return b.paper().drawQuadTree(b.quadtree,a)},b.on("tick.main",function(){for(g=null,h=-1;++h<j.length;)i=j[h],i.px=i.x,i.py=i.y;for(h=0;h<k.length;++h)k[h]();for(f=b.friction(),h=-1;++h<j.length;)i=j[h],i.fixed?(i.x=i.px,i.y=i.py):(i.x-=(i.px-i.x)*f,i.y-=(i.py-i.y)*f)})}),Fb.viz.force.plugin(function(a,b){function c(){var c=b.linkDistance,h=b.linkStrength,i=a.nodes();if(d=[],e=[],n.length){for(f=0;f<n.length;++f)g=n[f],"number"==typeof g.source&&(g.source=i[g.source]),"number"==typeof g.target&&(g.target=i[g.target]),++g.source.weight,++g.target.weight;if("function"==typeof c)for(f=0;f<n.length;++f)d[f]=+c.call(a,n[f],f);else for(f=0;f<n.length;++f)d[f]=c;if("function"==typeof h)for(f=0;f<n.length;++f)e[f]=+h.call(a,n[f],f);else for(f=0;f<n.length;++f)e[f]=h}}var d,e,f,g,h,i,j,l,m,n=[];Fb._.copyMissing({linkStrength:1,linkDistance:20},b),a.linkStrength=function(c){return arguments.length?(b.linkStrength="function"==typeof c?c:+c,a):b.linkStrength},a.linkDistance=function(c){return arguments.length?(b.linkDistance="function"==typeof c?c:+c,a):b.linkDistance},a.addForce(function(){for(d||c(),f=0;f<n.length;++f)g=n[f],h=g.source,i=g.target,j=i.x-h.x,l=i.y-h.y,m=j*j+l*l,m&&(m=b.alpha*e[f]*((m=Math.sqrt(m))-d[f])/m,j*=m,l*=m,i.x-=j*(k=h.weight/(i.weight+h.weight)),i.y-=l*k,h.x+=j*(k=1-k),h.y+=l*k)})}),Fb.viz.force.plugin(function(a,b){var c,d,e,f;void 0===b.gravity&&(b.gravity=.05),a.gravity=function(c){return arguments.length?(b.gravity=c,a):+b.gravity},a.addForce(function(){d=a.alpha()*b.gravity,f=a.nodes();var g=a.scalex()(.5),h=a.scaley()(.5);for(c=0;c<f.length;++c)e=f[c],e.fixed||(e.x+=(g-e.x)*d,e.y+=(h-e.y)*d)})}),Fb.viz.force.plugin(function(a,b){function c(){if(a.chargeDistance(b.chargeDistance),g=a.charge(),h=a.nodes(),f=[],"function"==typeof g)for(j=0;j<h.length;++j)f[j]=+g.call(a,h[j],j);else for(j=0;j<h.length;++j)f[j]=g}function d(b){var c=a.theta(),d=c*c;return function(a,c,e,f){if(a.point!==b&&a.charge){var g=a.cx-b.x,h=a.cy-b.y,i=f-c,j=g*g+h*h;if(j>i*i/d)return m>j&&(k=a.charge/j,b.px-=g*k,b.py-=h*k),!0;a.point&&j&&m>j&&(k=a.pointCharge/j,b.px-=g*k,b.py-=h*k)}return!a.charge}}function e(b,c,d){var f=a.scalex(),g=a.scaley(),h=0,i=0;if(b.charge=0,!b.leaf)for(var j,k=b.nodes,l=k.length,m=-1;++m<l;)j=k[m],j&&(e(j,c,d),b.charge+=j.charge,h+=j.charge*j.cx,i+=j.charge*j.cy);if(b.point){b.leaf||(b.point.x+=f(Math.random())-f(.5),b.point.y+=g(Math.random())-g(.5));var n=c*d[b.point.index];b.charge+=b.pointCharge=n,h+=n*b.point.x,i+=n*b.point.y}b.cx=b.charge?h/b.charge:0,b.cy=b.charge?i/b.charge:0}var f,g,h,i,j,k,l,m;Fb._.copyMissing({charge:-30,chargeDistance:1/0},b),a.charge=function(d){return arguments.length?(b.charge=d,f&&c(),a):"function"==typeof b.charge?b.charge:+b.charge},a.chargeDistance=function(c){return arguments.length?(b.chargeDistance2=+c,m=c*c,a):+b.chargeDistance},a.addForce(function(){if(h=a.nodes(),g=a.charge(),g&&h.length)for(f||c(),e(i=a.quadtree(),a.alpha(),f),j=-1;++j<h.length;)l=h[j],l.fixed||i.visit(d(l))})}),Fb.createviz("map",{tile:null,center:[41.898582,12.476801],zoom:4,maxZoom:18,zoomControl:!0,wheelZoom:!0},function(a,b){a.start=function(){},a.innerMap=function(){},a.addLayer=function(){},b.tile&&Fb.viz.map.tileProviders[b.tile](a,b)}).tileProviders={},Fb.viz.map.tileProviders.leaflet=function(b,c){function d(a,b){var c=e.latLngToLayerPoint(new L.LatLng(b,a));this.stream.point(c.x,c.y)}var e,f=[];b.start=function(){"undefined"==typeof L?(Fb._.loadCss(Fb.constants.leaflet),Fb.require(["leaflet"],function(){b.start()})):(e=new L.map(b.element().node(),{center:c.center,zoom:c.zoom}),c.zoomControl?c.wheelZoom||e.scrollWheelZoom.disable():(e.dragging.disable(),e.touchZoom.disable(),e.doubleClickZoom.disable(),e.scrollWheelZoom.disable(),e.tap&&e.tap.disable()),e.on("viewreset",function(){for(var a=0;a<f.length;++a)f[a]()}),b.resume())},b.innerMap=function(){return e},b.addLayer=function(a,b){e&&L.tileLayer(a,b).addTo(e)},b.addOverlay=function(b,c){var g=a.geo.transform({point:d}),h=a.geo.path().projection(g),i=e?a.select(e.getPanes().overlayPane).append("svg"):null,j=i?i.append("g").attr("class","leaflet-zoom-hide"):null,k=function(){var a=h.bounds(b),d=a[0],e=a[1];i.attr("width",e[0]-d[0]).attr("height",e[1]-d[1]).style("left",d[0]+"px").style("top",d[1]+"px"),j.attr("transform","translate("+-d[0]+","+-d[1]+")"),c&&c(h)};return f.push(k),{element:j,collection:b,path:h,draw:k}}},Fb.createviz("sunburst",{labels:!0,addorder:!1,transition:750,scale:"sqrt",initNode:null},function(b,c){function d(d,h){var j=.5*m.innerWidth(),y=.5*m.innerHeight(),z=m.element().attr("transform","translate("+j+","+y+")");k=d[0],o=Math.min(j,y),n=f(),u=a.scale.linear().range([0,2*Math.PI]),v=e(o),w=a[m.type()].arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,u(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,u(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,v(a.y))}).outerRadius(function(a){return Math.max(0,v(a.y+a.dy))}),z.selectAll("*").remove(),t=z.selectAll("path").data(d).enter().append("path").attr("d",w).style("fill",function(a){var b=(a.children?a:a.parent).name;return x[b]||(x[b]=l.pickColor()),x[b]}),c.labels&&(s=[],p=z.append("g").attr("class","text").selectAll("g").data(t.data()).enter().append("g"),q=p.append("path").attr("d",w).attr("opacity",0).on("click",function(a){g(a)}),r=p.append("text").text(function(a){return void 0!==c.addorder&&void 0!==a.order?a.order+" - "+a.name:a.name}),i(r)),b.select(h,0)||c.event.change({type:"change",viz:b})}function e(b){return"linear"===c.scale?a.scale.linear().range([0,b]):a.scale.sqrt().range([0,b])}function f(){var a=Math.min(m.innerWidth(),m.innerHeight());return 400>a?Math.round(100-.15*(500-a)):100}function g(d,e){function f(a){return a.x>=d.x&&a.x<d.x+d.dx}if(d!==k){void 0===e&&(e=+c.transition),r&&r.transition().attr("opacity",0);var g=j(d);return t.transition().duration(e).attrTween("d",g).each("end",function(a){d===a&&(k=a,c.event.change({type:"change",viz:b}))}),r&&(s=[],q.transition().duration(e).attrTween("d",g).each("end",function(b){b.depth>=k.depth&&f(b)&&i(a.select(this.parentNode).select("text").transition().duration(e).attr("opacity",1))})),!0}}function h(a){function b(a){var b=c-a;b>=0&&e>b?(c+=e,d=!0):0>b&&b>-e&&(c-=e-b,d=!0)}for(var c=u(a.x+a.dx/2),d=!0,e=Math.PI/40;d;)d=!1,s.forEach(b);return s.push(c),c}function i(a){var b,c=k.depth;return a.attr("x",function(a){return a.depth===c?0:(b=h(a,u,v),this.__data__.angle=b,b>Math.PI?-v(a.y):v(a.y))}).attr("dx",function(a){return a.depth===c?0:a.angle>Math.PI?-6:6}).attr("dy",function(a){return a.depth===c?a.depth?40:0:".35em"}).attr("transform",function(a){return b=0,a.depth>c&&(b=a.angle,b>Math.PI&&(b-=Math.PI),b-=Math.PI/2),"rotate("+b/Math.PI*180+")"}).attr("text-anchor",function(a){return b=a.angle,a.depth===c?"middle":b&&b>Math.PI?"end":"start"}).style("font-size",function(a){var b=a.depth-c,d=n;return b?b>0&&(d=Math.max(1.2*d-20*b,30)):d*=1.2,Math.round(d)+"%"})}function j(b){var c=a.interpolate(u.domain(),[b.x,b.x+b.dx]),d=a.interpolate(v.domain(),[b.y,1]),e=a.interpolate(v.range(),[b.y?20:0,o]);return function(a,b){return b?function(){return w(a)}:function(b){return u.domain(c(b)),v.domain(d(b)).range(e(b)),w(a)}}}var k,l,m,n,o,p,q,r,s,t,u,v,w,x={};b.on("tick.main",function(){b.stop(),b.draw()}),b.select=function(a,b){if(k){if(Yb(a)){a=k;for(var c=a,d=0;d<c.length;++d){var e=c[d];if(!a.children)break;for(var f=0;f<=a.children.length;++f)if(a.children[f]&&a.children[f].name===e){a=a.children[f];break}}}return g(a,b)}},b.scale=function(a){return arguments.length?(c.scale=a,b):c.scale},b.draw=function(e){return e=e||c.data,void 0===e&&c.src?(c.data=null,b.loadData(b.draw)):(c.data=null,l&&c.type===m.type()||(l=b.paper(!0),m=l.group(),m.element().classed("sunburst",!0)),e&&(e=a.layout.partition().value(function(a){return a.size}).sort(function(a){return void 0===a.order?a.size:a.order}).nodes(e),k=c.initNode||e[0],m.add(function(){d(e,k)})),void b.render())}}),Fb.createviz("trianglify",{bleed:100,fillOpacity:1,strokeOpacity:1,noiseIntensity:0,gradient:null,cellsize:100,cellpadding:0,x_gradient:null,y_gradient:null},function(a,b){function c(){var e=+b.cellsize,f=(+b.cellpadding,+b.fillOpacity),g=+b.strokeOpacity,h=+b.noiseIntensity,i=a.gradient(b.gradient),j=a.gradient(b.x_gradient)||i,k=a.gradient(b.y_gradient)||i,l=a.paper(),m=l.element(),n=l.size();d||(l.on("change.trianglify"+l.uid(),c),l.image=function(){var a=o.dataUrl;return a.substring(4,a.length-1)},d=new Trianglify),d.options.fillOpacity=Math.min(1,Math.max(f,0)),d.options.strokeOpacity=Math.min(1,Math.max(g,0)),d.options.noiseIntensity=Math.min(1,Math.max(h,0)),j&&(d.options.x_gradient=j),k&&(d.options.y_gradient=k),e>0&&(d.options.cellsize=e,d.options.bleed=+b.bleed);var o=d.generate(n[0],n[1]),p=m.select(".trianglify-background");if(!p.node()){for(var q=m.node(),r=document.createElement("div"),s=q.childNodes;s.length;)r.appendChild(s[0]);r.className="trianglify-background",q.appendChild(r),p=m.select(".trianglify-background")}p.style("min-height","100%").style("background-image",o.dataUrl)}var d;a.gradient=function(a){if(a&&"string"==typeof a){var b=a.split("-");if(2===b.length){var c=Trianglify.colorbrewer[b[0]],d=+b[1];if(c)return c[d]}}},a.on("tick.main",function(){a.stop(),void 0===a.Trianglify&&"undefined"==typeof Trianglify?Fb.require(["trianglify"],function(b){a.Trianglify=b||null,a.resume()}):(void 0===a.Trianglify&&(a.Trianglify=Trianglify),c())})}),Fb.paper.plugin("brush",{defaults:{axis:null,fill:"#000",fillOpacity:.125},svg:kb,canvas:kb}),Fb.viz.chart.plugin(function(a,b){var c,d;a.addBrush=function(){c=b.brush;var e=c.start,f=c.move,g=c.end;return c.start=function(){e&&e(a)},c.move=function(){a.each(function(b){var c=a.axisGroup(b),d=c?c.brush():null;d&&(b.point&&d.selectDraw(b.point),b.bar&&d.selectDraw(b.bar))}),f&&f(a)},c.end=function(){g&&g(a)},a.paper().each(".reference"+a.uid(),function(){this.addBrush(d).render()}),a},a.on("tick.brush",function(){b.brush&&b.brush.axis&&a.addBrush()})}),Fb.viz.force.plugin(function(a,b){function c(a,b){var c,d,e,f=a.size+b,g=a.x-f,h=a.x+f,i=a.y-f,j=a.y+f;return function(b,k,l,m,n){return b.point&&b.point!==a&&(c=a.x-b.point.x,d=a.y-b.point.y,e=Math.sqrt(c*c+d*d),f=a.size+b.point.size,f>e&&(e=.5*(f-e)/e,c*=e,d*=e,a.fixed||b.point.fixed?a.fixed?(b.point.x-=2*c,b.point.y-=2*d):(a.x+=2*c,a.y+=2*d):(a.x+=c,a.y+=d,b.point.x-=c,b.point.y-=d))),k>h||g>m||l>j||i>n}}Fb._.copyMissing({collidePadding:.002,collideBuffer:.02},b),a.collide=function(){for(var d=a.nodes(),e=a.scalex(),f=(a.scaley(),e(b.collideBuffer)),g=(e(b.collidePadding),a.quadtree()),h=0;h<d.length;++h)g.visit(c(d[h],f))}}),Fb.paper.plugin("grid",{defaults:{color:"#333",colorOpacity:.3,fill:"#c6dbef",fillOpacity:.2,lineWidth:.5,zoomx:!1,zoomy:!1,scaleExtent:[1,10]},svg:lb,canvas:lb}),Fb.viz.chart.plugin(function(a,b){b.grid=Pb({show:!1},b.grid),a.showGrid=function(){return a.paper().each(".reference"+a.uid(),function(){this.showGrid()}),a},a.hideGrid=function(){return a.paper().each(".reference"+a.uid(),function(){this.hideGrid()}),a},a.on("tick.grid",function(){b.grid.show?a.showGrid():a.hideGrid()})}),Fb.contextMenu=function(){function b(){!l&&k&&27===a.event.keyCode&&f()}function c(){var b=a.event;(!l&&k&&2!==b.button||b.target!==i)&&f()}function d(b){return function(){if(!l){var c=a.event;c.preventDefault(),c.stopPropagation(),f(),i=this,e(c,b)}}}function e(a,b){b&&b(j),j.classed("open",!0);var c=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0),d=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||0),e=j.node().scrollWidth,f=j.node().scrollHeight,g=document.clientWidth+c,h=document.clientHeight+d,i=e+a.pageX,l=f+a.pageY,m=Math.max(a.pageX-c,0),n=Math.max(a.pageY-d,0);i>g&&(m-=i-g),l>h&&(n-=l-h),j.style({top:n+"px",left:m+"px",position:"fixed"}),k=!0}function f(){j.classed("open",!1),k&&m.close(),k=!1}function g(){j||(j=a.select(document.createElement("div")).attr("class","giotto-menu"),f(),document.body.appendChild(j.node()),a.select(document).on("keyup.gmenu",b).on("click.gmenu",c).on("contextmenu.gmenu",c))}var h={},i=null,j=null,k=!1,l=!1,m=a.dispatch("open","close");return h.bind=function(a,e){g(),a.on("keyup.gmenu",b),a.on("click.gmenu",c),a.on("contextmenu.gmenu",d(e))},h.disabled=function(a){return arguments.length?(l=a?!0:!1,h):l},a.rebind(h,m,"on"),h},Fb.contextmenu=Fb.contextMenu(),Fb.vizplugin(function(a,b){a.contextmenu=function(c){c.append("ul").attr("class","dropdown-menu").attr("role","menu").selectAll("li").data(b.contextmenu).enter().append("li").append("a").attr("role","menuitem").text(function(a){return a.label}).attr("href","#").on("click",function(b){b.callback&&b.callback(a)})},b.contextmenu&&Fb.contextmenu.bind(a.element(),function(b){return a.contextmenu(b)})});var Fc;Fb.paper.plugin("tooltip",{defaults:{className:"d3-tip",show:!1,interact:!0,fill:"#333",fillOpacity:.8,color:"#fff",padding:"5px",radius:"3px",offset:[20,20],template:function(a){return"<p><span style='color:"+a.c+"'>"+a.l+"</span>  <strong>"+a.x+": </strong><span>"+a.y+"</span></p>"},font:{size:"14px"}},svg:ob,canvas:ob}),Fb.tip=function(){function b(){return"n"}function c(){return" "}function d(){return{top:m.n.y-q.offsetHeight-o[1],left:m.n.x-q.offsetWidth/2}}function e(){return{top:m.s.y+o[1],left:m.s.x-q.offsetWidth/2}}function f(){return{top:m.e.y-q.offsetHeight/2,left:m.e.x+o[0]}}function g(){return{top:m.w.y-q.offsetHeight/2,left:m.w.x-q.offsetWidth-o[0]}}function h(){return{top:m.nw.y-q.offsetHeight-o[1],left:m.nw.x-q.offsetWidth-o[0]}}function i(){return{top:m.ne.y-q.offsetHeight-o[1],left:m.ne.x+o[0]}}function j(){return{top:m.sw.y+o[1],left:m.sw.x-q.offsetWidth-o[0]}}function k(){return{top:m.se.y+o[1],left:m.e.x+o[0]}}function l(){var b=a.select(document.createElement("div"));return b.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),b.node()}var m,n=b,o=[0,0],p=c,q=l(),r={};document.body.appendChild(q),r.show=function(){var b,c=p.call(r),d=n.call(r),e=a.select(q),f=t.length,g=document.documentElement.scrollTop||document.body.scrollTop,h=document.documentElement.scrollLeft||document.body.scrollLeft;for(e.html(c).style({opacity:1,"pointer-events":"all"});f--;)e.classed(t[f],!1);return b=s.get(d).apply(this),e.classed(d,!0).style({top:b.top+g+"px",left:b.left+h+"px"}),r},r.hide=function(){return a.select(q).style({opacity:0,"pointer-events":"none"}),r},r.attr=function(b){if(arguments.length<2&&"string"==typeof b)return a.select(q).attr(b);var c=Array.prototype.slice.call(arguments);return a.selection.prototype.attr.apply(a.select(q),c),r},r.style=function(b){if(arguments.length<2&&"string"==typeof b)return a.select(q).style(b);var c=Array.prototype.slice.call(arguments);return a.selection.prototype.style.apply(a.select(q),c),r},r.bbox=function(a){return arguments.length?(m=a,r):m},r.direction=function(b){return arguments.length?(n=null===b?b:a.functor(b),r):n},r.offset=function(a){return arguments.length?(o=a,r):o},r.html=function(b){return arguments.length?(p=null===b?b:a.functor(b),r):p};var s=a.map({n:d,s:e,e:f,w:g,nw:h,ne:i,sw:j,se:k}),t=s.keys();return r};var Gc={"d3-tip:after":{}};Fb.viz.force.plugin(function(a,b){function c(a){return function(){return a}}var d=0,e=1;void 0===b.velocity&&(b.velocity=0),a.velocity=function(c){return arguments.length?(b.velocity=c,a):"function"==typeof b.velocity?b.velocity:+b.velocity},a.velocity_x=function(b){return arguments.length?(d=b,a):d},a.velocity_y=function(b){return arguments.length?(e=b,a):e},a.addForce(function(){var f=a.velocity();if(f){var g,h,i=a.nodes();"function"!=typeof b.velocity&&(f=c(f));for(var j=0;j<i.length;++j)g=i[j],g.fixed||(h=f(g),g.x+=h[d],g.y+=h[e])}})}),Fb.angular=function(){var a,b={};return b.module=function(c,d,e){return arguments.length?(a||(d=d||"giotto",e=e||[],a=c.module(d,e),a.config(["$compileProvider",function(b){a.directive=function(a,c){return b.directive(a,c),this}}]).directive("jstats",function(){return{link:function(a,b,d){var e=d.mode?+d.mode:1;Fb.require(["stats"],function(){var d=new Stats;d.setMode(e),a.stats=d,b.append(c.element(d.domElement))})}}})),b):a},b.directive=function(b,c,d){function e(a,d,e){e.scope=a;var f=b(d[0],e);e=f.options(),d.data(c,f),Ob.isFunction(e.angular)&&e.angular(f,e),a.$emit("giotto-viz",f),f.start()}return a?(d=d?d.slice():[],c||(c=b.vizName(),c=a.name.toLowerCase()+c.substring(0,1).toUpperCase()+c.substring(1)),d.push(function(){return{restrict:"AE",link:function(a,b,d){var f=b.data(c);if(!f){var g=Sb(d),h=g.require;h?(Fb._.isArray(h)||(h=[h]),Fb.require(h,function(c){Pb(g,c),e(a,b,g)})):e(a,b,g)}}}}),a.directive(c,d)):void Fb.log.warn("No angular module, cannot add directive")},b.addAll=function(a){return Fb.log.info("Adding giotto visualization directives"),angular.forEach(Fb.viz,function(b){Fb.angular.directive(b,null,a)}),b},b}(),Fb.crossfilter=function(a){function b(){if(!Fb.crossfilter.lib)throw Error("Could not find crossfilter library");c.data=Fb.crossfilter.lib(a.data),Fb._.isArray(a.dimensions)&&a.dimensions.forEach(function(a){c.addDimension(a)}),a.callback&&a.callback(c)}var c={dims:{},tolerance:void 0===a.tolerance?Fb.crossfilter.tolerance:a.tolerance};if(c.addDimension=function(a,b){b||(b=function(b){return b[a]}),c.dims[a]=c.data.dimension(b)},c.reduceDensity=function(a,b,d,e){var f,g=c.dims[a];if(!g)throw Error('Cross filter dimension "'+a+'"" not available. Add it with the addDimension method');void 0===d&&(d=null),void 0===e&&(e=null),f=null===d&&null===e?g.filter():g.filter(function(a){return null!==d&&d>a||null!==e&&a>e?void 0:!0});var h=f.bottom(1/0);if(h.length>c.tolerance*b){var i,j,k,l=Fb.math.kmeans(),m=[],n=[],o=[],p=h.length/b;for(j=0;j<h.length;j++)n.push([h[j][a]]);for(j=0;b>j;j++)o.push(n[Math.round(j*p)]);l.centroids(o).maxIters(10),n=l.cluster(n).sort(function(a,b){return a.centroid[0]-b.centroid[0]}),n.forEach(function(a){for(i=a.indices[0],k=a.points[0],j=1;j<a.points.length;++j)a.points[j]>k&&(i=a.indices[j],k=a.points[j]);m.push(h[i])}),h=m}return h},void 0===Fb.crossfilter.lib){if("undefined"==typeof crossfilter)return Fb.require(["crossfilter"],function(a){Fb.crossfilter.lib=a||null,b()}),c;Fb.crossfilter.lib=crossfilter}return b(),c},Fb.crossfilter.tolerance=1.1;var Hc=a.canvas.rgba,Ic=[!0,"none","color"];return a});