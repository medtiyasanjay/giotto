!function(a){var b;b="object"==typeof module&&module.exports?module.exports:window,"function"==typeof define&&define.amd?define(["d3"],function(){return a(d3,b)}):"object"==typeof module&&module.exports&&a(d3,b)}(function(a,b){"use strict";function c(){}function d(a){return h(a,"width")}function e(a){return h(a,"height")}function f(a){return i(a,"width")}function g(a){return i(a,"height")}function h(a,b){for(var c,d=a.node();d&&"BODY"!==d.tagName&&!(c=d.getBoundingClientRect()[b]);)d=d.parentNode;return c}function i(b,c){for(var d,e=b.node();e&&"BODY"!==e.tagName;){if(d=e.getBoundingClientRect()[c])return a.select(e);e=e.parentNode}}function j(a){if(E(a)){if(E(a[0])&&2===a[0].length){var b=[];return a.forEach(function(a){b.push({x:a[0],y:a[1]})}),b}return a}}function l(b,c){return q.paper.types[c.type](b,c),b.xAxis().scale().range([0,c.size[0]]),b.yaxis(2).yAxis().scale().range([0,c.size[1]]),b.yaxis(1).yAxis().scale().range([0,c.size[1]]),a.rebind(b,c.event,"on")}function m(b,c){var h,i;c?(h=c.width,i=c.height,c=B(c,function(a,b){return void 0!==q.defaults.paper[b]?a:void 0})):c={};var j=y({},q.defaults.paper,c);return h||(h=d(b),h?j.elwidth=f(b):h=q.constants.WIDTH),i?"string"==typeof i&&i.indexOf("%")===i.length-1&&(j.height_percentage=.01*parseFloat(i),i=a.round(j.height_percentage*h)):(i=e(b),i?j.elheight=g(b):i=q.constants.HEIGHT),j.size=[h,i],j.event=a.dispatch("refresh"),j}function n(a,b,c){a.attr("transform",function(a){var d=b(a);return"translate("+(isFinite(d)?d:c(a))+",0)"})}function o(a,b,c){a.attr("transform",function(a){var d=b(a);return"translate(0,"+(isFinite(d)?d:c(a))+")"})}var p={version:"0.1.0",d3:a,math:{}},q=p;a.giotto=p,a.canvas={},q.require=function(a,c){return b.rcfg&&b.rcfg.min&&(a=b.rcfg.min(a)),require(a,c),q},q.angular={module:function(a,b,c){return b=b||"giotto",c=c||[],a.module(b,c).directive("jstats",function(){return{link:function(b,c,d){var e=d.mode?+d.mode:1;require(rcfg.min(["stats"]),function(){var d=new Stats;d.setMode(e),b.stats=d,c.append(a.element(d.domElement))})}}})},directive:function(a,b,c,d,e){d=d||"giotto",e=e?e.slice():[];var f=d.toLowerCase()+b.substring(0,1).toUpperCase()+b.substring(1);e.push(function(){return{restrict:"AE",link:function(a,b,d){var e=b.data(f);if(!e){var g=A(d);g.scope=a,e=c(b[0],g),b.data(f,e),a.$emit("giotto-viz",e),e.start()}}}}),a.module(d).directive(f,e)},addAll:function(a,b,c,d){q.angular.module(a,b,c),a.forEach(q.viz,function(c,e){q.angular.directive(a,e,c,b,d)})}};var r=/xyz/.test(function(){})?/\b_super\b/:/.*/,s=function(a,b,c,d){return"function"==typeof c&&"function"==typeof d[b]&&r.test(c)?a.new_attr(b,function(){var a=this._super;this._super=d[b];var e=c.apply(this,arguments);return this._super=a,e}):a.new_attr(b,c)},t=q.Type=function(a){return a.new_class=function(a,b){var c=this,d=a===c,e=d?a:a.prototype;a.initialising=!0;var f=new a;delete a.initialising;for(var g in b)"Metaclass"!==g&&(f[g]=s.call(a,c,g,b[g],e));if(d){for(g in e)void 0===f[g]&&(f[g]=e[g]);return f}var h=function(){!this.constructor.initialising&&this.init&&this.init.apply(this,arguments)};return h.prototype=f,h.prototype.constructor=h,h.extend=a.extend,h},a.new_attr=function(a,b){return b},a.extend=function(b){return a.new_class(this,b)},a}(function(){}),u=q.Class=function(a){return a.__class__=t,a.extend=function(a){var b=a.Metaclass||this.__class__,c=b.new_class(this,a);return c.__class__=b,c},a}(function(){}),v=function(a){function b(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function d(a){var d=window.console||{},e=d[a]||d.log||c,f=!1;try{f=!!e.apply}catch(g){}return f?function(){for(var a=[],c=0;c<arguments.length;++c)a.push(b(arguments[c]));return e.apply(d,a)}:function(a,b){e(a,null===b?"":b)}}return{log:d("log"),info:d("info"),warn:d("warn"),error:d("error"),debug:function(){var b=d("debug");return function(){a&&b.apply(self,arguments)}}()}};q.log=v(b.debug),q.xyfunction=function(a,b){var c=[];return E(a)&&a.forEach(function(a){c.push([a,b(a)])}),c};var w=Object.prototype.toString,x=q._={},y=q.extend=function(){var a=arguments.length,b=arguments[0];if(!b||2>a)return b;for(var c,d=0;++d<a;)if(c=arguments[d],Object(c)===c)for(var e in c)c.hasOwnProperty(e)&&(b[e]=c[e]);return b},z=x.copyMissing=function(a,b){if(a&&b)for(var c in a)a.hasOwnProperty(c)&&void 0===b[c]&&(b[c]=a[c]);return b},A=function(a){if(a&&"string"==typeof a.options){for(var c=b,d=a.options.split("."),e=0;e<d.length&&(c=c[d[e]],c);++e);"function"==typeof c&&(c=c(q,a)),a=y(a,c)}return a},B=(x.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},x.pick=function(a,b){var c,d={};for(var e in a)a.hasOwnProperty(e)&&(c=b(a[e],e),void 0!==c&&(d[e]=c));return d}),C=x.isObject=function(a){return"[object Object]"===w.call(a)},D=(x.isString=function(a){return"[object String]"===w.call(a)},x.isFunction=function(a){return"[object Function]"===w.call(a)}),E=x.isArray=function(a){return"[object Array]"===w.call(a)},F=x.encodeObject=function(a,b){var c;if("multipart/form-data"===b){var d=new FormData;for(c in a)a.hasOwnProperty(c)&&d.append(c,a[c]);return d}if("application/json"===b)return JSON.stringify(a);var e=[];for(c in a)a.hasOwnProperty(c)&&e.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return e.join("&")},G=x.getObject=function(a){if(x.isString(a)){var c=a.split(".");a=b;for(var d=0;d<c.length&&(a=a[c[d]],a);++d);}return a};q.defaults={},q.defaults.paper={type:"svg",resizeDelay:200,yaxis:1,resize:!0,margin:{top:20,right:20,bottom:20,left:20}},q.defaults.viz=y({onInit:null,events:["build","change","start","tick","end"],lines:{interpolate:"basis"}}),q.constants={DEFAULT_VIZ_GROUP:"default_viz_group",WIDTH:400,HEIGHT:300},q.paper=function(b,c){var f={};return C(b)&&(c=b,b=null),b||(b=document.createElement("div")),b=a.select(b),c=m(b,c),f.destroy=function(){b.selectAll("*").remove()},f.type=function(){return c.type},f.size=function(){return[c.size[0],c.size[1]]},f.width=function(){return c.size[0]},f.height=function(){return c.size[1]},f.aspectRatio=function(){return c.size[1]/c.size[0]},f.element=function(){return b},f.yaxis=function(a){return arguments.length?((1===a||2===a)&&(c.yaxis=a),f):c.yaxis},f.xAxis=function(a){return arguments.length?(c.xAxis=a,f):c.xAxis},f.yAxis=function(a){return arguments.length?(c.yAxis[c.yaxis-1]=a,f):c.yAxis[c.yaxis-1]},f.scale=function(a){var b=c.xAxis.scale();return b(a)-b(0)},f.scalex=function(a){return c.xAxis.scale()(a)},f.scaley=function(a){return f.yAxis().scale()(a)},f.resize=function(a){c._resizing=!0,a||(a=f.boundingBox()),(c.size[0]!==a[0]||c.size[1]!==a[1])&&(q.log.info("Resizing paper"),c.size=a,f.refresh()),c._resizing=!1},f.boundingBox=function(){var b,f=c.elwidth?d(c.elwidth):c.size[0];return b=c.height_percentage?a.round(f*c.height_percentage,0):c.elheight?e(c.elheight):c.size[1],[f,b]},c.resize&&a.select(window).on("resize",function(){c._resizing||(c.resizeDelay?(c._resizing=!0,a.timer(function(){return f.resize(),!0},c.resizeDelay)):f.resize())}),l(f,c)},q.paper.types={},q.paper.types.svg=function(b,c){var d=b.element().append("svg").attr("width",c.size[0]).attr("height",c.size[1]).attr("viewBox","0 0 "+c.size[0]+" "+c.size[1]),e=d;c.xAxis=a.svg.axis(),c.yAxis=[a.svg.axis(),a.svg.axis()],b.refresh=function(){return d.attr("width",c.size[0]).attr("height",c.size[1]),c.event.refresh({type:"refresh",size:c.size.slice(0)}),b},b.clear=function(){return e=d,d.selectAll("*").remove(),b},b.current=function(){return e},b.root=function(){return e=d,b},b.parent=function(){if(e!==d){var c=e.node().parentNode;return c===d.node()?d:a.select(c)}return b},b.group=function(){return e=e.append("g")},b.circle=function(a,c,d){return a=b.scalex(a),c=b.scaley(c),d=b.scale(d),e.append("circle").attr("cx",a).attr("cy",c).attr("r",d)},b.rect=function(a,c,d,f,g){var h=b.scalex(a),i=b.scaley(c);d=b.scalex(a+d)-h,f=b.scalex(c+f)-i;var j=e.append("rect").attr("x",h).attr("y",i).attr("width",d).attr("height",f);if(g){{var k=b.scalex(g)-b.scalex(0);b.scaley(g)-b.scaley(0)}j.attr("rx",k).attr("ry",rt)}return j},b.path=function(b){if(E(b)&&(b={data:b}),b&&b.data){z(this.options.lines,b);var c=a.svg.line().interpolate(b.interpolate).x(function(a){return a.x}).y(function(a){return a.y}),d=j(b.data);return e.append("path").datum(d).attr("d",c)}},b.encode=function(){return btoa(unescape(encodeURIComponent(d.attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML)))},b.downloadSVG=function(c){var d="data:image/svg+xml;charset=utf-8;base64,"+b.encode();a.select(c.target).attr("href",d)},b.downloadPNG=function(c){function d(b,c){if(c&&200===c.status){var d=JSON.parse(c.responseText);a.xhr(d.url).post(F({input:"upload",file:i},"multipart/form-data"),function(a,b){b&&200===b.status&&(d=JSON.parse(b.responseText),e(d))})}}function e(b){a.xhr(b.url,function(a,c){c&&200===c.status&&(b=JSON.parse(c.responseText),"finished"===b.step?g(b.output):"error"===b.step?f(b):e(b))})}function f(){}function g(b){a.select(c.target).attr("href",b.url+"?inline")}if(q.cloudConvertApiKey){var h={apikey:q.cloudConvertApiKey,inputformat:"svg",outputformat:"png"},i=new Blob(["base64,",b.encode()],{type:"image/svg+xml;charset=utf-8"});a.xhr("https://api.cloudconvert.org/process?"+F(h)).header("content-type","multipart/form-data").post(d)}}},q.vizRegistry=function(){function a(a){return a||(a=q.constants.DEFAULT_VIZ_GROUP),b[a]||(b[a]=[]),a}var b={};return{has:function(a){for(var c in b)if(b[c].indexOf(a)>=0)return!0;return!1},register:function(c,d){d=a(d),b[d].push(c)},deregister:function(c,d){d=a(d);for(var e=0;e<b[d].length;e++)if(b[d][e].anchorName()===c.anchorName()){b[d].splice(e,1);break}},clear:function(a){a?delete b[a]:b={}},list:function(a){return a=initializeVisGroup(a),b[a]}}}(),q.registerViz=function(a,b){q.vizRegistry.register(a,b)},q.deregisterViz=function(a,b){q.vizRegistry.deregister(a,b)},q.hasViz=function(a){return q.vizRegistry.has(a)};var H=0,I=q.Viz=u.extend({init:function(b,c){c||Object(b)!==b||(c=b,b=null),b||(b=document.createElement("div")),c=y({},q.defaults.viz,q.defaults.paper,this.defaults,c),b=a.select(b),this.element=b,this.log=v(c.debug),this.uid=++H,this.dispatch=a.dispatch.apply(a,c.events),this.g=q,this.attrs=this.getAttributes(c),c.onInit&&this._executeCallback(c.onInit),c.autoBuild&&this.build()},resize:function(a){this._paper&&this._paper.resize(a)},paper:function(a){if(a||void 0===this._paper){var b=this;this._paper&&this._paper.destroy(),this._paper=q.paper(this.element.node(),this.attrs),this._paper.on("refresh",function(){b._refresh()})}return this._paper},build:function(a){a&&(this.attrs=y(this.attrs,a)),this.d3build(),this.dispatch.build(this)},redraw:function(a){this.build(a)},d3build:function(){},loadData:function(b){var c=this,d=this.attrs.src;return d?a.json(d,function(a,d){a||c.setData(d,b)}):void 0},getAttributes:function(a){return a},setData:function(a,b){this.attrs.processData&&(a=this.attrs.processData(a)),Object(a)===a&&a.data?this.attrs=y(this.attrs,a):this.attrs.data=a,b&&b()},on:function(a,b){return this.dispatch.on(a,b),this},fire:function(a){this.dispatch[a]&&this.dispatch[a].call(this)},_executeCallback:function(a){var c=a;if("string"==typeof a){for(var d=b,e=a.split("."),f=0;f<e.length&&(d=d[e[f]],d);++f);c=d}"function"==typeof c?c.call(this):this.log.error('Cannot execute callback "'+a+'". Not a function')},_refresh:function(){"canvas"===this.paper().type()&&this.build()}});q.isviz=function(a){return a!==I&&a.prototype&&a.prototype instanceof I},q.viz={},q.createviz=function(b,c,d){var e=[],f=function(b,g){C(b)&&(g=b,b=null),g=y({},q.defaults.viz,q.defaults.paper,c,g);var h,i={},j=++H,k=a.dispatch.apply(a,g.events),l=0,m=!1;g.event=k,i.uid=function(){return j},i.vizType=function(){return f},i.vizName=function(){return f.vizName()},i.paper=function(a){return(a||void 0===h)&&(h&&h.destroy(),h=q.paper(b,g),h.on("refresh",function(){i.refresh()})),h},i.element=function(){return i.paper().element()},i.alpha=function(b){return arguments.length?(b=+b,l?l=b>0?b:0:b>0&&(k.start({type:"start",alpha:l=b}),a.timer(i.tick)),i):l},i.resume=function(){return i.alpha(.1)},i.stop=function(){return i.alpha(0)},i.tick=function(){return(l*=.99)<.005?(k.end({type:"end",alpha:l=0}),!0):void k.tick({type:"tick",alpha:l})},i.start=function(){return i.resume()},i.refresh=function(){return h&&"canvas"===h.type()&&this.start(),i},i.loadData=function(b){return g.src&&!m?(m=!0,q.log.info("Giotto loading data from "+g.src),a.json(g.src,function(a,c){m=!1,a||i.setData(c,b)})):void 0},i.setData=function(a,b){g.processData&&(a=g.processData(a)),Object(a)===a&&a.data?y(g,a):g.data=a,b&&b()},i.options=function(){return g},a.rebind(i,k,"on"),d&&d(i,g);for(var n=0;n<e.length;++n)e[n](i,g);if(g.onInit){var o=G(g.onInit);D(o)?o(i):q.log.error("Could not locate onInit function "+g.onInit)}return i};return q.viz[b]=f,f.vizName=function(){return b},f.plugin=function(a){e.push(a)},f},a.canvas.axis=function(){function b(b){b.each(function(){var b,k=a.select(this),l=this.__chart__||d,m=this.__chart__=d.copy(),p=null===j?m.ticks?m.ticks.apply(m,i):m.domain():j,q=null===c?m.tickFormat?m.tickFormat.apply(m,i):d3_identity:c,r=k.selectAll(".tick").data(p,m),s=r.enter().insert("g",".domain").attr("class","tick").style("opacity",ε),t=a.transition(r.exit()).style("opacity",ε).remove(),u=a.transition(r.order()).style("opacity",1),v=Math.max(f,0)+h,w=d3_scaleRange(m),x=k.selectAll(".domain").data([0]),y=(x.enter().append("path").attr("class","domain"),a.transition(x));s.append("line"),s.append("text");var z,A,B,C,D=s.select("line"),E=u.select("line"),F=r.select("text").text(q),G=s.select("text"),H=u.select("text"),I="top"===e||"left"===e?-1:1;if("bottom"===e||"top"===e?(b=n,z="x",B="y",A="x2",C="y2",F.attr("dy",0>I?"0em":".71em").style("text-anchor","middle"),y.attr("d","M"+w[0]+","+I*g+"V0H"+w[1]+"V"+I*g)):(b=o,z="y",B="x",A="y2",C="x2",F.attr("dy",".32em").style("text-anchor",0>I?"end":"start"),y.attr("d","M"+I*g+","+w[0]+"H0V"+w[1]+"H"+I*g)),D.attr(C,I*f),G.attr(B,I*v),E.attr(A,0).attr(C,I*f),H.attr(z,0).attr(B,I*v),m.rangeBand){var J=m,K=J.rangeBand()/2;l=m=function(a){return J(a)+K}}else l.rangeBand?l=m:t.call(b,m,l);s.call(b,l,m),u.call(b,m,m)})}var c,d=a.scale.linear(),e=J,f=6,g=6,h=3,i=[10],j=null;return b.scale=function(a){return arguments.length?(d=a,b):d},b.orient=function(a){return arguments.length?(e=a in K?a+"":J,b):e},b.ticks=function(){return arguments.length?(i=arguments,b):i},b.tickValues=function(a){return arguments.length?(j=a,b):j},b.tickFormat=function(a){return arguments.length?(c=a,b):c},b.tickSize=function(a){var c=arguments.length;return c?(f=+a,g=+arguments[c-1],b):f},b.innerTickSize=function(a){return arguments.length?(f=+a,b):f},b.outerTickSize=function(a){return arguments.length?(g=+a,b):g},b.tickPadding=function(a){return arguments.length?(h=+a,b):h},b.tickSubdivide=function(){return arguments.length&&b},b};var J="bottom",K={top:1,right:1,bottom:1,left:1};q.paper.types.canvas=function(b,c){var d,e,f;c.xAxis=a.canvas.axis(),c.yAxis=[a.canvas.axis(),a.canvas.axis()],b.refresh=function(){return b.destroy(),d=b.element().append("canvas").attr("width",c.size[0]).attr("height",c.size[1]),e=d.node().getContext("2d"),f=e,c.event.refresh({type:"refresh",size:c.size.slice(0)}),b},b.refresh(),b.current=function(){return f},b.clear=function(){return f=e,f.clearRect(0,0,c.size[0],c.size[1]),b}},q.C3=I.extend({c3opts:["data","axis","grid","region","legend","tooltip","subchart","zoom","point","line","bar","pie","donut"],init:function(a,b){b||Object(a)!==a||(b=a,a=null),b&&(b.resize=!1),this._super(a,b)},d3build:function(){var a=this,b=this.attrs;if(!this.c3)return require(["c3"],function(b){a.c3=b,a.d3build()});if(!b.data)return this.loadData(function(){a.d3build()});var c={bindto:this.element.node(),size:{width:this.elwidth?null:b.width,height:this.elheight?null:b.height}};a.c3opts.forEach(function(a){b[a]&&(c[a]=b[a])});this.c3.generate(c)}}),q.createviz("force",{nodes:0,minRadius:.02,maxRadius:.08,theta:.8,friction:.9},function(b,c){function d(a){var b=a.radius+.05,c=a.x-b,d=a.x+b,e=a.y-b,f=a.y+b;return function(b,g,h,i,j){if(b.point&&b.point!==a){var k=a.x-b.point.x,l=a.y-b.point.y,m=Math.sqrt(k*k+l*l),n=a.radius+b.point.radius;n>m&&(m=(m-n)/m*.5,a.x-=k*=m,a.y-=l*=m,b.point.x+=k,b.point.y+=l)}return g>d||c>i||h>f||e>j}}function e(a){return a.weight=0,isNaN(a.x)&&(a.x=Math.random()),isNaN(a.y)&&(a.y=Math.random()),isNaN(a.px)&&(a.px=a.x),isNaN(a.py)&&(a.py=a.y),a}var f,g,h,i,j,k=[];b.nodes=function(a){if(!arguments.length)return k;for(f=null,k=a,i=0;i<k.length;++i)e(k[i]).index=i;return b},b.addNode=function(a){a.index=k.length,k.push(e(a))},b.theta=function(a){return arguments.length?(c.theta=a,b):+c.theta},b.friction=function(a){return arguments.length?(c.friction=a,b):+c.friction},b.quadtree=function(){return h||(h=a.geom.quadtree(k)),h},b.randomNode=function(){var a=+c.minRadius,b=+c.maxRadius,d=b>a?b-a:0;return{radius:Math.random()*d+a}},b.drawCircles=function(c){c||(c=a.scale.category10());var d=b.paper(),e=c.range().length;if("svg"===d.type()){var f=d.clear().current();return f.selectAll("circle").data(k).enter().append("svg:circle").attr("r",function(a){var b=d.scale(a.radius);return b>2?b-2:0}).attr("cx",function(a){return d.scalex(a.x)}).attr("cy",function(a){return d.scaley(a.y)}).style("fill",function(a,b){return c(b%e)})}},b.on("tick.main",function(){for(h=null,b.quadtree(),g=b.friction(),i=-1;++i<k.length;)j=k[i],j.fixed?(j.x=j.px,j.y=j.py):(j.x-=(j.px-(j.px=j.x))*g,j.y-=(j.py-(j.py=j.y))*g),h.visit(d(k[i]))}),+c.nodes&&b.nodes(a.range(+c.nodes).map(function(){return b.randomNode()}))}),q.viz.force.plugin(function(a,b){function c(){var c=b.linkDistance,h=b.linkStrength,i=a.nodes();if(d=[],e=[],n.length){for(f=0;f<n.length;++f)g=n[f],"number"==typeof g.source&&(g.source=i[g.source]),"number"==typeof g.target&&(g.target=i[g.target]),++g.source.weight,++g.target.weight;if("function"==typeof c)for(f=0;f<n.length;++f)d[f]=+c.call(a,n[f],f);else for(f=0;f<n.length;++f)d[f]=c;if("function"==typeof h)for(f=0;f<n.length;++f)e[f]=+h.call(a,n[f],f);else for(f=0;f<n.length;++f)e[f]=h}}var d,e,f,g,h,i,j,l,m,n=[];q._.copyMissing({linkStrength:1,linkDistance:20},b),a.linkStrength=function(c){return arguments.length?(b.linkStrength="function"==typeof c?c:+c,a):b.linkStrength},a.linkDistance=function(c){return arguments.length?(b.linkDistance="function"==typeof c?c:+c,a):b.linkDistance},a.on("tick.links",function(){for(d||c(),f=0;f<n.length;++f)g=n[f],h=g.source,i=g.target,j=i.x-h.x,l=i.y-h.y,m=j*j+l*l,m&&(m=b.alpha*e[f]*((m=Math.sqrt(m))-d[f])/m,j*=m,l*=m,i.x-=j*(k=h.weight/(i.weight+h.weight)),i.y-=l*k,h.x+=j*(k=1-k),h.y+=l*k)})}),q.viz.force.plugin(function(a,b){var c,d,e,f;void 0===b.gravity&&(b.gravity=.05),a.gravity=function(c){return arguments.length?(b.gravity=c,a):+b.gravity},a.on("tick.gravity",function(){if(d=a.alpha()*b.gravity,f=a.nodes(),d)for(c=0;c<f.length;++c)e=f[c],e.fixed||(e.x+=(.5-e.x)*d,e.y+=(.5-e.y)*d)})}),q.viz.force.plugin(function(a,b){function c(){if(a.chargeDistance(b.chargeDistance),g=a.charge(),h=a.nodes(),f=[],"function"==typeof g)for(j=0;j<h.length;++j)f[j]=+g.call(a,h[j],j);else for(j=0;j<h.length;++j)f[j]=g}function d(b){var c=a.theta(),d=c*c;return function(a,c,e,f){if(a.point!==b){var g=a.cx-b.x,h=a.cy-b.y,i=f-c,j=g*g+h*h;if(j>i*i/d)return m>j&&(k=a.charge/j,b.px-=g*k,b.py-=h*k),!0;a.point&&j&&m>j&&(k=a.pointCharge/j,b.px-=g*k,b.py-=h*k)}return!a.charge}}function e(a,b,c){var d=0,f=0;if(a.charge=0,!a.leaf)for(var g,h=a.nodes,i=h.length,j=-1;++j<i;)g=h[j],g&&(e(g,b,c),a.charge+=g.charge,d+=g.charge*g.cx,f+=g.charge*g.cy);if(a.point){a.leaf||(a.point.x+=Math.random()-.5,a.point.y+=Math.random()-.5);var k=b*c[a.point.index];a.charge+=a.pointCharge=k,d+=k*a.point.x,f+=k*a.point.y}a.cx=d/a.charge,a.cy=f/a.charge}var f,g,h,i,j,k,l,m;q._.copyMissing({charge:-30,chargeDistance:1/0},b),a.charge=function(c){return arguments.length?(b.charge=c,a):"function"==typeof b.charge?b.charge:+b.charge},a.chargeDistance=function(c){return arguments.length?(b.chargeDistance2=+c,m=c*c,a):+b.chargeDistance},a.on("tick.charge",function(){if(h=a.nodes(),g=a.charge(),g&&h.length)for(f||c(),e(i=a.quadtree(),a.alpha(),f),j=-1;++j<h.length;)(l=h[j]).fixed||i.visit(d(l))})}),q.Leaflet=I.extend({defaults:{center:[41.898582,12.476801],zoom:4,maxZoom:18,zoomControl:!0,wheelZoom:!0},getAttributes:function(a){return a.resize=!1,a},d3build:function(){var a=this.attrs,b=this.element.node();if("undefined"==typeof L){var c=this;require(["leaflet"],function(){c.d3build()})}else{var d=this.attrs,e=this.map=new L.map(b,{center:a.center,zoom:a.zoom});d.zoomControl?d.wheelZoom||e.scrollWheelZoom.disable():(e.dragging.disable(),e.touchZoom.disable(),e.doubleClickZoom.disable(),e.scrollWheelZoom.disable(),e.tap&&e.tap.disable()),a.buildMap&&a.buildMap.call(this)}},addLayer:function(a,b){this.map&&L.tileLayer(a,b).addTo(this.map)},addSvgLayer:function(b,c){function d(a,b){var c=g.latLngToLayerPoint(new L.LatLng(b,a));this.stream.point(c.x,c.y)}var e=a.geo.transform({point:d}),f=a.geo.path().projection(e),g=this.map,h=g?a.select(g.getPanes().overlayPane).append("svg"):null,i=h?h.append("g").attr("class","leaflet-zoom-hide"):null;if(g){var j={svg:h,g:i,collection:b,path:f,draw:function(){var a=f.bounds(b),d=a[0],e=a[1];h.attr("width",e[0]-d[0]).attr("height",e[1]-d[1]).style("left",d[0]+"px").style("top",d[1]+"px"),i.attr("transform","translate("+-d[0]+","+-d[1]+")"),c&&c(j)}};return g.on("viewreset",j.draw),j}}}),q.createviz("sunBurst",{labels:!0,addorder:!1,padding:10,transition:750,scale:"sqrt",initNode:null},function(b,c){function d(){var a=u.size(),b=Math.min(a[0],a[1]);return 400>b?Math.round(100-.15*(500-b)):100}function e(c){function d(a){return a.x>=c.x&&a.x<c.x+c.dx}if(c!==l){q&&q.transition().attr("opacity",0);var e=k(c);return s=c.depth,t.transition().duration(x).attrTween("d",e).each("end",function(a){c===a&&(b.current=a,b.fire("change"))}),q&&(r=[],p.transition().duration(x).attrTween("d",e).each("end",function(b){b.depth>=s&&d(b)&&j(a.select(this.parentNode).select("text").transition().duration(x).attr("opacity",1))})),!0}}function f(){var d=u.clear().size(),e=d[0]/2,f=d[1]/2,i=a.layout.partition().value(function(a){return a.size}).sort(function(a){return void 0===a.order?a.size:a.order}),k=u.group().attr("transform","translate("+e+","+f+")"),v=k.append("g").attr("class","sunburst");n=Math.min(e,f)-c.padding,m=g(n),s=0,l=c.data;m(0),m(n);if(t=v.selectAll("path").data(i.nodes(l)).enter().append("path").attr("d",z).style("fill",function(a){return w((a.children?a:a.parent).name)}),c.labels){var x=t.data();r=[],o=k.append("g").attr("class","text").selectAll("g").data(x).enter().append("g"),p=o.append("path").attr("d",z).attr("opacity",0).on("click",h),q=o.append("text").text(function(a){return void 0!==c.addorder&&void 0!==a.order?a.order+" - "+a.name:a.name}),j(q)}b.select(c.initNode)||c.event.change({type:"change",viz:b})}function g(b){return"linear"===c.scale?a.scale.linear().range([0,b]):a.scale.sqrt().range([0,b])}function h(d){function e(a){return a.x>=d.x&&a.x<d.x+d.dx}s!==d.depth&&(q&&q.transition().attr("opacity",0),s=d.depth,t.transition().duration(x).attrTween("d",k(d)).each("end",function(a){a.depth===s&&e(a)&&(b.current=a,c.event.change({type:"change",viz:b}))}),q&&(r=[],p.transition().duration(x).attrTween("d",k(d)).each("end",function(b){b.depth>=s&&e(b)&&j(a.select(this.parentNode).select("text").transition().duration(x).attr("opacity",1))})))}function i(a){function b(a){var b=c-a;b>=0&&e>b?(c+=e,d=!0):0>b&&b>-e&&(c-=e-b,d=!0)}for(var c=y(a.x+a.dx/2),d=!0,e=Math.PI/40;d;)d=!1,r.forEach(b);return r.push(c),c}function j(a){var b;return a.attr("x",function(a){return a.depth===s?0:(b=i(a),this.__data__.angle=b,b>Math.PI?-m(a.y):m(a.y))}).attr("dx",function(a){return a.depth===s?0:a.angle>Math.PI?-6:6}).attr("dy",function(a){return a.depth===s?a.depth?40:0:".35em"}).attr("transform",function(a){return b=0,a.depth>s&&(b=a.angle,b>Math.PI&&(b-=Math.PI),b-=Math.PI/2),"rotate("+b/Math.PI*180+")"}).attr("text-anchor",function(a){return b=a.angle,a.depth===s?"middle":b&&b>Math.PI?"end":"start"}).style("font-size",function(a){var b=a.depth-s,c=v;return b?b>0&&(c=Math.max(1.2*c-20*b,30)):c*=1.2,Math.round(c)+"%"})}function k(b){var c=a.interpolate(y.domain(),[b.x,b.x+b.dx]),d=a.interpolate(m.domain(),[b.y,1]),e=a.interpolate(m.range(),[b.y?20:0,n]);return function(a,b){return b?function(){return z(a)}:function(b){return y.domain(c(b)),m.domain(d(b)).range(e(b)),z(a)}}}var l,m,n,o,p,q,r,s,t,u=b.paper(),v=d(),w=a.scale.category20c(),x=+c.transition,y=a.scale.linear().range([0,2*Math.PI]),z=a.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,y(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,y(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,m(a.y))}).outerRadius(function(a){return Math.max(0,m(a.y+a.dy))});b.on("tick.main",function(){return c.data?(f(),void b.alpha(0)):b.loadData()}),b.select=function(a){if(l){var b=c.data;if(a&&a.length)for(var d=0;d<a.length;++d){var f=a[d];if(!b.children)break;for(var g=0;g<=b.children.length;++g)if(b.children[g]&&b.children[g].name===f){b=b.children[g];break}}return e(b)}},b.scale=function(a){return arguments.length?(c.scale!==a&&(c.scale=a,b.resume()),b):c.scale}}),q.Trianglify=I.extend({defaults:{bleed:150,fillOpacity:1,strokeOpacity:1,noiseIntensity:0,gradient:null,x_gradient:null,y_gradient:null},d3build:function(){if(void 0===this.Trianglify&&"undefined"==typeof Trianglify){var a=this;return q.require(["trianglify"],function(b){a.Trianglify=b||null,a.d3build()})}void 0===this.Trianglify&&(this.Trianglify=Trianglify);var b=this._t,c=this.attrs,d=c.cellsize?+c.cellsize:0,e=(c.cellpadding?+c.cellpadding:0,c.fillOpacity?+c.fillOpacity:1),f=c.strokeOpacity?+c.strokeOpacity:1,g=c.noiseIntensity?+c.noiseIntensity:0,h=this.gradient(c.gradient),i=this.gradient(c.x_gradient)||h,j=this.gradient(c.y_gradient)||h;this._t||(this._t=b=new Trianglify),b.options.fillOpacity=Math.min(1,Math.max(e,0)),b.options.strokeOpacity=Math.min(1,Math.max(f,0)),b.options.noiseIntensity=Math.min(1,Math.max(g,0)),i&&(b.options.x_gradient=i),j&&(b.options.y_gradient=j),d>0&&(b.options.cellsize=d,b.options.bleed=+c.bleed);var k=b.generate(this.attrs.width,this.attrs.height),l=this.element.select(".trianglify-background");if(!l.node()){for(var m=this.element.node(),n=document.createElement("div"),o=m.childNodes;o.length;)n.appendChild(o[0]);n.className="trianglify-background",m.appendChild(n),l=this.element.select(".trianglify-background")}l.style("min-height","100%").style("background-image",k.dataUrl)},gradient:function(a){if(a&&"string"==typeof a){var b=a.split("-");if(2===b.length){var c=Trianglify.colorbrewer[b[0]],d=+b[1];if(c)return c[d]}}}}),q.Chart=I.extend({serieDefaults:{lines:{show:!0},points:{show:!0}},defaults:{},build:function(){var a=this,b=this.attrs,c=b.data||[];c.forEach(function(b){D(b)&&(b=b(a)),a.addSerie(b)})},addSerie:function(a){a&&(E(a)&&(a={data:a}),a.data&&(this.log.info("Add new serie to chart"),z(this.serieDefaults,a),a.lines.show&&this.paper().drawLine(a.data,a.lines)))}});var M=52,N=2<<51,O=21201,P=["d       s       a       m_i","2       1       0       1","3       2       1       1 3","4       3       1       1 3 1","5       3       2       1 1 1","6       4       1       1 1 3 3","7       4       4       1 3 5 13","8       5       2       1 1 5 5 17","9       5       4       1 1 5 5 5","10      5       7       1 1 7 11 1"];return q.math.sobol=function(a){if(1>a||a>O)throw new Error("Out of range dimension");var b,c,d={},e=0,f=[],g=[],h=[];d.next=function(){var b=[];if(0===e)return e++,h.slice();for(var d=1,i=e-1;1==(1&i);)i>>=1,d++;for(c=0;a>c;c++)g[c]^=f[c][d],b[c]=g[c]/N;return e++,b},d.dimension=function(){return a},d.count=function(){return e};var i=[];for(c=0;M>=c;c++)i.push(0);for(c=0;a>c;c++)f[c]=i.slice(),g[c]=0,h[c]=0;if(a>P.length)throw new Error("Out of range dimension");for(b=P,c=1;M>=c;c++)f[0][c]=1<<M-c;for(var j=1;a>j;j++){var k=b[j].split(/\s+/),l=+k[1],m=+k[2],n=[0];for(c=0;l>c;c++)n.push(+k[3+c]);for(c=1;l>=c;c++)f[j][c]=n[c]<<M-c;for(c=l+1;M>=c;c++){f[j][c]=f[j][c-l]^f[j][c-l]>>l;for(var o=1;l-1>=o;o++)f[j][c]^=(m>>l-1-o&1)*f[j][c-o]}}return d},a});